<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='TomcatËá™1998Âπ¥ÈóÆ‰∏ñ‰ª•Êù•Âõ†‰∏∫ÂÖ∂È´òÊÄßËÉΩÔºåÂÖçË¥πÁ≠âÁâπÁÇπÂπøÂèóJavaÁà±Â•ΩËÄÖÁöÑÂñúÁà±Ôºå‰ΩÜÂú®SpringbootÁ≠âÂæÆÊúçÂä°Ê°ÜÊû∂Êàê‰∏∫ÊäÄÊúØ‰∏ªÊµÅÂêéÁöÑ‰ªäÂ§©Ôºåtomcat‰ºº‰πéÈÄêÊ∏ê&amp;quot;Ê∂àÂ§±&amp;quot;Âú®Â§ß‰ºóÁöÑËßÜÁ∫ø‰∏≠Ôºå‰Ω†ËøòÂú®Áî®tomcatÂêóÔºüÊàëÁõ∏‰ø°ÂØπ‰∫éÂ§ßÈÉ®ÂàÜjava web developerÊù•ËØ¥Ëøô‰∏™ÈóÆÈ¢òÁöÑÁ≠îÊ°àÊòØYes, Âõ†‰∏∫Springboot web starterÈªòËÆ§ÈõÜÊàêÁöÑÂ∞±ÊòØtomcat„ÄÇ
Êú¨ÊñáÂ∞ùËØï‰ªé&amp;quot;‰∏∫‰ªÄ‰πàÊµèËßàÂô®ÂèëÂá∫ÁöÑHTTPËØ∑Ê±ÇÂèØ‰ª•Âà∞ËææÊàë‰ª¨ÁöÑController&amp;quot;Ëøô‰∏ÄÂü∫Êú¨ÈóÆÈ¢òÂá∫ÂèëÔºåÁî±ÊµÖÂÖ•Ê∑±ÔºåÁî±ÁÇπÂà∞Èù¢ÁöÑÊñπÂºèÂÖà‰ªéÊï¥‰ΩìÁöÑËßíÂ∫¶Êù•Ê¢≥ÁêÜtomcatÁöÑÊû∂ÊûÑÂéüÁêÜÔºåÂÜçÂà∞‰ª•‰∏Ä‰∏™HTTP/1.1 ËØ∑Ê±Ç‰∏∫‰æãÊù•ÂàÜÊûêtomcat‰Ωú‰∏∫‰∏Ä‰∏™HTTP webÊúçÂä°Âô®ÂíåServletÂÆπÂô®ÂÆÉÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºåÊúÄÂêéÂõûÂΩíËøô‰∏™ÈóÆÈ¢òÊ¢≥ÁêÜspringbootÊòØÂ¶Ç‰Ωï‰∏étomcatÈõÜÊàêÁöÑ„ÄÇÂÖ∂‰∏≠Ê∂âÂèäÂ§ßÈáèÁöÑÊ∫êÁ†ÅËß£ÊûêÔºåËØ∑ÁïôÊÑèÊ∂âÂèäÊ∫êÁ†ÅËß£ÊûêÁöÑÈÉ®ÂàÜÈÉΩÊòØÂü∫‰∫étomcat 10.x Êù•ËøõË°å„ÄÇÂ∏åÊúõËÉΩÁªôÈÇ£‰∫õÂØπtomcatÂéüÁêÜÊÑüÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶Êèê‰æõ‰∏Ä‰∫õËßÜËßíÂíåÂèÇËÄÉ„ÄÇ
'>
<title>tomcatÊû∂ÊûÑÂéüÁêÜËß£Êûê</title>

<link rel='canonical' href='http://localhost:1313/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/'>

<link rel="stylesheet" href="/scss/style.min.876ff6cde480707ded0466265c1f084444129bedc60fe81e5f83398e4410d786.css"><meta property='og:title' content='tomcatÊû∂ÊûÑÂéüÁêÜËß£Êûê'>
<meta property='og:description' content='TomcatËá™1998Âπ¥ÈóÆ‰∏ñ‰ª•Êù•Âõ†‰∏∫ÂÖ∂È´òÊÄßËÉΩÔºåÂÖçË¥πÁ≠âÁâπÁÇπÂπøÂèóJavaÁà±Â•ΩËÄÖÁöÑÂñúÁà±Ôºå‰ΩÜÂú®SpringbootÁ≠âÂæÆÊúçÂä°Ê°ÜÊû∂Êàê‰∏∫ÊäÄÊúØ‰∏ªÊµÅÂêéÁöÑ‰ªäÂ§©Ôºåtomcat‰ºº‰πéÈÄêÊ∏ê&amp;quot;Ê∂àÂ§±&amp;quot;Âú®Â§ß‰ºóÁöÑËßÜÁ∫ø‰∏≠Ôºå‰Ω†ËøòÂú®Áî®tomcatÂêóÔºüÊàëÁõ∏‰ø°ÂØπ‰∫éÂ§ßÈÉ®ÂàÜjava web developerÊù•ËØ¥Ëøô‰∏™ÈóÆÈ¢òÁöÑÁ≠îÊ°àÊòØYes, Âõ†‰∏∫Springboot web starterÈªòËÆ§ÈõÜÊàêÁöÑÂ∞±ÊòØtomcat„ÄÇ
Êú¨ÊñáÂ∞ùËØï‰ªé&amp;quot;‰∏∫‰ªÄ‰πàÊµèËßàÂô®ÂèëÂá∫ÁöÑHTTPËØ∑Ê±ÇÂèØ‰ª•Âà∞ËææÊàë‰ª¨ÁöÑController&amp;quot;Ëøô‰∏ÄÂü∫Êú¨ÈóÆÈ¢òÂá∫ÂèëÔºåÁî±ÊµÖÂÖ•Ê∑±ÔºåÁî±ÁÇπÂà∞Èù¢ÁöÑÊñπÂºèÂÖà‰ªéÊï¥‰ΩìÁöÑËßíÂ∫¶Êù•Ê¢≥ÁêÜtomcatÁöÑÊû∂ÊûÑÂéüÁêÜÔºåÂÜçÂà∞‰ª•‰∏Ä‰∏™HTTP/1.1 ËØ∑Ê±Ç‰∏∫‰æãÊù•ÂàÜÊûêtomcat‰Ωú‰∏∫‰∏Ä‰∏™HTTP webÊúçÂä°Âô®ÂíåServletÂÆπÂô®ÂÆÉÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºåÊúÄÂêéÂõûÂΩíËøô‰∏™ÈóÆÈ¢òÊ¢≥ÁêÜspringbootÊòØÂ¶Ç‰Ωï‰∏étomcatÈõÜÊàêÁöÑ„ÄÇÂÖ∂‰∏≠Ê∂âÂèäÂ§ßÈáèÁöÑÊ∫êÁ†ÅËß£ÊûêÔºåËØ∑ÁïôÊÑèÊ∂âÂèäÊ∫êÁ†ÅËß£ÊûêÁöÑÈÉ®ÂàÜÈÉΩÊòØÂü∫‰∫étomcat 10.x Êù•ËøõË°å„ÄÇÂ∏åÊúõËÉΩÁªôÈÇ£‰∫õÂØπtomcatÂéüÁêÜÊÑüÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶Êèê‰æõ‰∏Ä‰∫õËßÜËßíÂíåÂèÇËÄÉ„ÄÇ
'>
<meta property='og:url' content='http://localhost:1313/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/'>
<meta property='og:site_name' content='Ê∏ÖÈú≤Êô®ÊµÅ, Êñ∞Ê°êÂàùÂºï'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:published_time' content='2024-01-10T11:28:33&#43;08:00'/><meta property='article:modified_time' content='2024-01-10T11:28:33&#43;08:00'/><meta property='og:image' content='http://localhost:1313/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/IMG_1890.png' />
<meta name="twitter:title" content="tomcatÊû∂ÊûÑÂéüÁêÜËß£Êûê">
<meta name="twitter:description" content="TomcatËá™1998Âπ¥ÈóÆ‰∏ñ‰ª•Êù•Âõ†‰∏∫ÂÖ∂È´òÊÄßËÉΩÔºåÂÖçË¥πÁ≠âÁâπÁÇπÂπøÂèóJavaÁà±Â•ΩËÄÖÁöÑÂñúÁà±Ôºå‰ΩÜÂú®SpringbootÁ≠âÂæÆÊúçÂä°Ê°ÜÊû∂Êàê‰∏∫ÊäÄÊúØ‰∏ªÊµÅÂêéÁöÑ‰ªäÂ§©Ôºåtomcat‰ºº‰πéÈÄêÊ∏ê&amp;quot;Ê∂àÂ§±&amp;quot;Âú®Â§ß‰ºóÁöÑËßÜÁ∫ø‰∏≠Ôºå‰Ω†ËøòÂú®Áî®tomcatÂêóÔºüÊàëÁõ∏‰ø°ÂØπ‰∫éÂ§ßÈÉ®ÂàÜjava web developerÊù•ËØ¥Ëøô‰∏™ÈóÆÈ¢òÁöÑÁ≠îÊ°àÊòØYes, Âõ†‰∏∫Springboot web starterÈªòËÆ§ÈõÜÊàêÁöÑÂ∞±ÊòØtomcat„ÄÇ
Êú¨ÊñáÂ∞ùËØï‰ªé&amp;quot;‰∏∫‰ªÄ‰πàÊµèËßàÂô®ÂèëÂá∫ÁöÑHTTPËØ∑Ê±ÇÂèØ‰ª•Âà∞ËææÊàë‰ª¨ÁöÑController&amp;quot;Ëøô‰∏ÄÂü∫Êú¨ÈóÆÈ¢òÂá∫ÂèëÔºåÁî±ÊµÖÂÖ•Ê∑±ÔºåÁî±ÁÇπÂà∞Èù¢ÁöÑÊñπÂºèÂÖà‰ªéÊï¥‰ΩìÁöÑËßíÂ∫¶Êù•Ê¢≥ÁêÜtomcatÁöÑÊû∂ÊûÑÂéüÁêÜÔºåÂÜçÂà∞‰ª•‰∏Ä‰∏™HTTP/1.1 ËØ∑Ê±Ç‰∏∫‰æãÊù•ÂàÜÊûêtomcat‰Ωú‰∏∫‰∏Ä‰∏™HTTP webÊúçÂä°Âô®ÂíåServletÂÆπÂô®ÂÆÉÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºåÊúÄÂêéÂõûÂΩíËøô‰∏™ÈóÆÈ¢òÊ¢≥ÁêÜspringbootÊòØÂ¶Ç‰Ωï‰∏étomcatÈõÜÊàêÁöÑ„ÄÇÂÖ∂‰∏≠Ê∂âÂèäÂ§ßÈáèÁöÑÊ∫êÁ†ÅËß£ÊûêÔºåËØ∑ÁïôÊÑèÊ∂âÂèäÊ∫êÁ†ÅËß£ÊûêÁöÑÈÉ®ÂàÜÈÉΩÊòØÂü∫‰∫étomcat 10.x Êù•ËøõË°å„ÄÇÂ∏åÊúõËÉΩÁªôÈÇ£‰∫õÂØπtomcatÂéüÁêÜÊÑüÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶Êèê‰æõ‰∏Ä‰∫õËßÜËßíÂíåÂèÇËÄÉ„ÄÇ
"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://localhost:1313/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/IMG_1890.png' />
    <link rel="shortcut icon" href="/favicon.svg" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu13ebfac54b51a4b7ee52e30ffb590fe7_360247_300x0_resize_box_3.png" width="300"
                            height="400" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üçö</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Ê∏ÖÈú≤Êô®ÊµÅ, Êñ∞Ê°êÂàùÂºï</a></h1>
            <h2 class="site-description">The only way of humans have figured out of getting somewhere is to leave something behind.</h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li  class='current' >
            <a href='/posts/' >
                
                
                
                    <svg t="1709175193721" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2392"
     width="200" height="200">
    <path d="M811.008 860.672H308.736c-30.72 0-55.296-27.648-55.296-61.44v-675.84c0-33.792 24.576-61.44 55.296-61.44h330.752c8.704 0 15.36 6.656 15.36 15.36s-6.656 15.36-15.36 15.36H308.736c-13.312 0-24.576 13.824-24.576 30.72v675.84c0 16.896 11.264 30.72 24.576 30.72h502.272c13.312 0 24.576-13.824 24.576-30.72V305.664L691.2 136.192c-5.632-6.656-4.608-16.384 1.536-21.504 6.656-5.632 16.384-4.608 21.504 1.536l147.968 173.568c2.56 2.56 3.584 6.144 3.584 9.728V798.72c0.512 34.304-24.064 61.952-54.784 61.952z"
          p-id="2393"></path>
    <path d="M715.264 964.608H212.992c-30.72 0-55.296-27.648-55.296-61.44v-675.84c0-8.704 6.656-15.36 15.36-15.36s15.36 6.656 15.36 15.36v675.84c0 16.896 11.264 30.72 24.576 30.72h502.272c8.704 0 15.36 6.656 15.36 15.36s-6.656 15.36-15.36 15.36z"
          p-id="2394"></path>
    <path d="M734.208 522.752H369.664c-8.704 0-15.36-6.656-15.36-15.36s6.656-15.36 15.36-15.36h364.544c8.704 0 15.36 6.656 15.36 15.36s-6.656 15.36-15.36 15.36zM734.208 603.648H369.664c-8.704 0-15.36-6.656-15.36-15.36s6.656-15.36 15.36-15.36h364.544c8.704 0 15.36 6.656 15.36 15.36s-6.656 15.36-15.36 15.36zM648.192 685.056H369.664c-8.704 0-15.36-6.656-15.36-15.36s6.656-15.36 15.36-15.36h278.528c8.704 0 15.36 6.656 15.36 15.36s-6.656 15.36-15.36 15.36zM586.752 441.344H369.664c-8.704 0-15.36-6.656-15.36-15.36s6.656-15.36 15.36-15.36h217.088c8.704 0 15.36 6.656 15.36 15.36s-6.656 15.36-15.36 15.36zM791.04 315.392h-151.552c-8.704 0-15.36-6.656-15.36-15.36V77.312c0-8.704 6.656-15.36 15.36-15.36s15.36 6.656 15.36 15.36v207.36h136.192c8.704 0 15.36 6.656 15.36 15.36s-6.656 15.36-15.36 15.36z"
          p-id="2395"></path>
</svg>
                
                <span>Posts</span>
            </a>
        </li>
        
        
        <li >
            <a href='/page/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/page/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">

            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">



        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#tomcatÁöÑÊ†∏ÂøÉÂäüËÉΩ">TomcatÁöÑÊ†∏ÂøÉÂäüËÉΩ</a></li>
    <li><a href="#ÁêÜËß£http-ËØ∑Ê±ÇÁöÑÊú¨Ë¥®">ÁêÜËß£HTTP ËØ∑Ê±ÇÁöÑÊú¨Ë¥®</a></li>
    <li><a href="#ÊâãÂÜôÊúÄÁÆÄÁâàtomcat">ÊâãÂÜôÊúÄÁÆÄÁâàTomcat</a>
      <ul>
        <li><a href="#Â¶Ç‰ΩïÂèëËµ∑httpËØ∑Ê±Ç">Â¶Ç‰ΩïÂèëËµ∑HTTPËØ∑Ê±ÇÔºü</a></li>
        <li><a href="#Â¶Ç‰ΩïÊé•Êî∂Âπ∂Â§ÑÁêÜhttp-ËØ∑Ê±Ç">Â¶Ç‰ΩïÊé•Êî∂Âπ∂Â§ÑÁêÜHTTP ËØ∑Ê±Ç?</a></li>
      </ul>
    </li>
    <li><a href="#‰ªÄ‰πàÊòØservlet">‰ªÄ‰πàÊòØServlet</a></li>
  </ul>

  <ul>
    <li><a href="#tomcatÊû∂ÊûÑ">TomcatÊû∂ÊûÑ</a>
      <ul>
        <li><a href="#tomcat-ÁöÑÂêØÂä®ËøáÁ®ã">Tomcat ÁöÑÂêØÂä®ËøáÁ®ã</a></li>
      </ul>
    </li>
    <li><a href="#ËØ∑Ê±ÇÊé•Êî∂ÂíåÂ§ÑÁêÜ">ËØ∑Ê±ÇÊé•Êî∂ÂíåÂ§ÑÁêÜ</a>
      <ul>
        <li><a href="#connectorÁöÑÂàõÂª∫">ConnectorÁöÑÂàõÂª∫</a></li>
        <li><a href="#ÁõëÂê¨ÁΩëÁªúÁ´ØÂè£ÂíåÊé•Êî∂ËøûÊé•ËØ∑Ê±Ç">ÁõëÂê¨ÁΩëÁªúÁ´ØÂè£ÂíåÊé•Êî∂ËøûÊé•ËØ∑Ê±Ç</a></li>
        <li><a href="#Ëß£ÊûêËØ∑Ê±ÇÊï∞ÊçÆ">Ëß£ÊûêËØ∑Ê±ÇÊï∞ÊçÆ</a></li>
        <li><a href="#Â§ÑÁêÜËØ∑Ê±Ç">Â§ÑÁêÜËØ∑Ê±Ç</a></li>
        <li><a href="#Â∞èÁªì">Â∞èÁªì</a></li>
      </ul>
    </li>
    <li><a href="#servlet-ÂíåËØ∑Ê±ÇÁöÑmapping">Servlet ÂíåËØ∑Ê±ÇÁöÑMapping</a></li>
    <li><a href="#ÂìçÂ∫îËøáÁ®ã">ÂìçÂ∫îËøáÁ®ã</a></li>
    <li><a href="#pipeline-Âíå-valve">Pipeline Âíå Valve</a>
      <ul>
        <li><a href="#pipeline">Pipeline</a></li>
        <li><a href="#valve">Valve</a></li>
        <li><a href="#valveÊòØÊÄé‰πàÊ∑ªÂä†ÁöÑ">ValveÊòØÊÄé‰πàÊ∑ªÂä†ÁöÑ</a></li>
        <li><a href="#valve-‰ªÄ‰πàÊó∂ÂÄô‰ºöËøêË°å">Valve ‰ªÄ‰πàÊó∂ÂÄô‰ºöËøêË°å</a></li>
      </ul>
    </li>
    <li><a href="#tomcatÁöÑÁ±ªÂä†ËΩΩÊú∫Âà∂">TomcatÁöÑÁ±ªÂä†ËΩΩÊú∫Âà∂</a>
      <ul>
        <li><a href="#jdkÁ±ªÂä†ËΩΩÂô®‰∏éÂèå‰∫≤ÂßîÊ¥æÊ®°Âûã">JDKÁ±ªÂä†ËΩΩÂô®‰∏éÂèå‰∫≤ÂßîÊ¥æÊ®°Âûã</a></li>
        <li><a href="#tomcatÁöÑÁ±ªÂä†ËΩΩÂô®">TomcatÁöÑÁ±ªÂä†ËΩΩÂô®</a></li>
        <li><a href="#tomcat-ÊòØÂ¶Ç‰ΩïÊâìÁ†¥Âèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÁöÑ">Tomcat ÊòØÂ¶Ç‰ΩïÊâìÁ†¥Âèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÁöÑÔºü</a></li>
      </ul>
    </li>
    <li><a href="#tomcat-Âíåspringboot">Tomcat ÂíåSpringboot</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">
                <img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/IMG_1890_hufea3e9ca65cfbc42e503dcb755cb462c_15847402_800x0_resize_box_3.png"
                        srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/IMG_1890_hufea3e9ca65cfbc42e503dcb755cb462c_15847402_800x0_resize_box_3.png 800w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/IMG_1890_hufea3e9ca65cfbc42e503dcb755cb462c_15847402_1600x0_resize_box_3.png 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post tomcatÊû∂ÊûÑÂéüÁêÜËß£Êûê" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/tomcat/" style="background-color: #2a9d8f; color: #fff;">
                tomcat
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">tomcatÊû∂ÊûÑÂéüÁêÜËß£Êûê</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 10, 2024</time>
            </div>
        

        
            <div>
                <svg t="1709719417939" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3290" width="200" height="200"><path d="M851.123506 952.605578V656.828685h71.394422v367.171315H1.52988V99.952191h469.163347v71.394423H72.924303v781.258964h778.199203zM922.007968 0.50996v272.318725h-71.394422V0.50996z" fill="#666666" p-id="3291"></path><path d="M750.151394 100.972112h272.318726v71.394422H750.151394z" fill="#666666" p-id="3292"></path><path d="M430.97753 618.252239c7.366884-7.595347 14.733769-11.39251 25.783586-18.988876 7.365865-7.595347 14.732749-11.39251 22.098613-18.988877 7.366884-3.797163 14.733769-11.39251 22.099634-18.987857 7.366884-7.595347 11.049817-15.190693 14.733768-22.786039 3.681912-7.596367 7.365865-18.988876 7.365865-34.17957 0-11.39251-3.682932-22.78604-7.365865-30.382406-3.683952-11.39251-11.049817-18.987857-18.416701-22.78502-7.366884-7.596367-14.732749-11.39353-25.783585-15.191714-11.048797-3.797163-18.415681-7.595347-29.465498-7.595346-14.732749 0-25.782566 3.798183-36.832383 7.595346-11.049817 3.798183-22.099633 11.39251-29.465498 22.78604-7.366884 7.595347-14.733769 18.988876-18.416701 30.382407-3.682932 11.39251-3.682932 15.190693-3.682932 30.381386h47.882199v-11.39251c0-7.596367 3.682932-11.39353 7.365864-18.988876 3.683952-3.798183 7.366884-11.39353 11.049817-15.191713 3.683952-3.797163 11.049817-3.797163 18.416701-3.797164 11.049817 0 18.415681 3.797163 25.783586 11.39251 7.365865 7.596367 11.048797 15.191713 11.048797 26.584223 0 7.595347 0 15.190693-3.682932 18.988877-3.683952 11.39251-11.049817 15.190693-14.733769 18.988876l-14.732749 15.190693c-7.365865 3.797163-14.732749 7.595347-18.415682 11.39251-11.049817 7.595347-22.099633 11.39353-29.465498 18.988877-11.050837 7.595347-18.416701 15.190693-25.783585 26.584223-7.366884 7.595347-11.049817 18.988876-14.732749 30.381386-3.683952 11.39251-7.366884 22.78604-7.366885 37.977753h176.796048v-45.573099H416.244781c3.682932-11.39251 7.366884-18.988876 14.732749-22.78604zM305.812908 690.972558V436.525896h-47.883219c0 7.595347-3.681912 18.988876-7.365864 26.584224l-14.733769 15.190693c-7.365865 3.797163-14.732749 7.595347-22.098614 7.595346-7.366884 0-11.049817 3.798183-18.416701 0v41.774917h62.614948v159.503299h47.882199v3.798183zM692.419825 690.972558c11.049817-3.798183 22.099633-7.595347 29.465498-15.190693 7.366884-7.595347 14.733769-15.190693 18.416701-26.584224 3.682932-11.39251 3.682932-22.78604 3.682932-37.976733 0-15.190693 0-22.78706-7.365864-34.179569-7.366884-11.39251-18.416701-15.190693-33.149451-18.988877 11.049817-3.797163 18.416701-11.39251 25.783586-18.988876 7.365865-7.595347 7.365865-18.987857 7.365865-30.381387 0-11.39251-3.682932-22.78604-7.366885-30.381386-3.682932-7.595347-11.049817-15.190693-18.415681-22.78604-7.366884-7.595347-14.733769-11.39251-25.783586-15.190693C674.004143 436.525896 666.637259 436.525896 655.587442 436.525896s-22.099633 3.798183-33.14945 7.595347c-11.049817 3.798183-18.416701 11.39251-25.783586 18.988877-7.365865 7.595347-14.731729 15.190693-18.415681 26.584223-3.682932 11.39251-7.365865 26.583203-7.365864 37.976733h47.882199c0-11.39251 3.682932-26.584223 7.365864-34.17957 7.366884-7.595347 14.733769-11.39251 29.465498-11.39251 7.367904 0 18.416701 3.797163 22.100654 7.595347 7.365865 3.797163 11.049817 15.190693 11.049816 22.78502 0 7.596367 0 11.39353-3.683952 15.191713l-11.049816 11.39251c-3.681912 3.798183-11.048797 3.798183-18.415682 3.798183h-18.416701v34.17957h22.099634c7.366884 0 11.049817 0 18.416701 3.797163 7.365865 3.798183 11.049817 7.595347 14.732749 11.39353 3.682932 3.798183 3.682932 11.39251 3.682932 22.78604 0 11.39251-3.681912 22.78604-11.049817 30.382406-7.365865 7.595347-18.415681 11.39251-29.465498 11.39251-7.366884 0-14.732749 0-18.416701-3.797163-3.682932-3.798183-11.049817-7.595347-14.732749-11.39353-3.682932-3.798183-7.366884-11.39251-7.366884-15.190693-3.681912-7.595347-3.681912-15.190693-3.681913-22.78604H563.505976c0 15.190693 0 30.381386 7.366885 41.774916 3.681912 11.39251 11.049817 18.987857 18.415681 26.583203 7.366884 7.595347 18.416701 15.190693 29.465498 18.988877 11.050837 3.798183 25.783586 3.798183 36.833402 3.798183 14.732749-3.798183 25.783586 0 36.832383-3.798183z" fill="#666666" p-id="3293"></path></svg>
                <time class="article-time--reading">
                    5270 words
                </time>

                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    25 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>TomcatËá™1998Âπ¥ÈóÆ‰∏ñ‰ª•Êù•Âõ†‰∏∫ÂÖ∂È´òÊÄßËÉΩÔºåÂÖçË¥πÁ≠âÁâπÁÇπÂπøÂèóJavaÁà±Â•ΩËÄÖÁöÑÂñúÁà±Ôºå‰ΩÜÂú®SpringbootÁ≠âÂæÆÊúçÂä°Ê°ÜÊû∂Êàê‰∏∫ÊäÄÊúØ‰∏ªÊµÅÂêéÁöÑ‰ªäÂ§©Ôºåtomcat‰ºº‰πéÈÄêÊ∏ê&quot;Ê∂àÂ§±&quot;Âú®Â§ß‰ºóÁöÑËßÜÁ∫ø‰∏≠Ôºå‰Ω†ËøòÂú®Áî®tomcatÂêóÔºüÊàëÁõ∏‰ø°ÂØπ‰∫éÂ§ßÈÉ®ÂàÜjava web developerÊù•ËØ¥Ëøô‰∏™ÈóÆÈ¢òÁöÑÁ≠îÊ°àÊòØYes, Âõ†‰∏∫Springboot web starterÈªòËÆ§ÈõÜÊàêÁöÑÂ∞±ÊòØtomcat„ÄÇ</p>
<p>Êú¨ÊñáÂ∞ùËØï‰ªé&quot;‰∏∫‰ªÄ‰πàÊµèËßàÂô®ÂèëÂá∫ÁöÑHTTPËØ∑Ê±ÇÂèØ‰ª•Âà∞ËææÊàë‰ª¨ÁöÑController&quot;Ëøô‰∏ÄÂü∫Êú¨ÈóÆÈ¢òÂá∫ÂèëÔºåÁî±ÊµÖÂÖ•Ê∑±ÔºåÁî±ÁÇπÂà∞Èù¢ÁöÑÊñπÂºèÂÖà‰ªéÊï¥‰ΩìÁöÑËßíÂ∫¶Êù•Ê¢≥ÁêÜtomcatÁöÑÊû∂ÊûÑÂéüÁêÜÔºåÂÜçÂà∞‰ª•‰∏Ä‰∏™HTTP/1.1 ËØ∑Ê±Ç‰∏∫‰æãÊù•ÂàÜÊûêtomcat‰Ωú‰∏∫‰∏Ä‰∏™HTTP webÊúçÂä°Âô®ÂíåServletÂÆπÂô®ÂÆÉÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºåÊúÄÂêéÂõûÂΩíËøô‰∏™ÈóÆÈ¢òÊ¢≥ÁêÜspringbootÊòØÂ¶Ç‰Ωï‰∏étomcatÈõÜÊàêÁöÑ„ÄÇÂÖ∂‰∏≠Ê∂âÂèäÂ§ßÈáèÁöÑÊ∫êÁ†ÅËß£ÊûêÔºåËØ∑ÁïôÊÑèÊ∂âÂèäÊ∫êÁ†ÅËß£ÊûêÁöÑÈÉ®ÂàÜÈÉΩÊòØÂü∫‰∫é<strong>tomcat 10.x</strong> Êù•ËøõË°å„ÄÇÂ∏åÊúõËÉΩÁªôÈÇ£‰∫õÂØπtomcatÂéüÁêÜÊÑüÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶Êèê‰æõ‰∏Ä‰∫õËßÜËßíÂíåÂèÇËÄÉ„ÄÇ</p>
<h1 id="‰ªÄ‰πàÊòØtomcat">‰ªÄ‰πàÊòØTomcat</h1>
<h2 id="tomcatÁöÑÊ†∏ÂøÉÂäüËÉΩ">TomcatÁöÑÊ†∏ÂøÉÂäüËÉΩ</h2>
<p><strong>tomcatÊòØ‰∏Ä‰∏™==webÂ∫îÁî®ÊúçÂä°Âô®==Âíå==ServletÂÆπÂô®==ÔºåÂÆÉËøòÊòØ Jakarta Servlet„ÄÅJakarta Server Pages„ÄÅJakarta Expression Language„ÄÅJakarta WebSocket„ÄÅJakarta Annotations Âíå Jakarta Authentication ËßÑËåÉÁöÑÂºÄÊ∫êÂÆûÁé∞</strong>„ÄÇ</p>
<p>ËøôÈáåÊúâ‰∏§‰∏™ÈáçÁÇπÔºåwebÂ∫îÁî®ÊúçÂä°Âô®ÂíåServletÂÆπÂô®„ÄÇÂàÜÂà´ÂØπÂ∫î‰∫ÜÂÆÉÁöÑ‰∏§‰∏™Ê†∏ÂøÉÂäüËÉΩÔºö</p>
<blockquote>
<p>‰ªÄ‰πàÊòØWebÊúçÂä°Âô®, ËØ¥ÁôΩ‰∫ÜÔºåÂÆÉÁöÑ‰ΩúÁî®Â∞±ÊòØÂ∞Ü‰∏ªÊú∫‰∏äÁöÑÊüê‰∏™ËµÑÊ∫êÊò†Â∞ÑÊàê‰∏Ä‰∏™URL‰æõÂ§ñÁïåËÆøÈóÆ„ÄÇ</p>
</blockquote>
<ul>
<li>Â§ÑÁêÜ <code>Socket</code> ËøûÊé•ÔºåË¥üË¥£ÁΩëÁªúÂ≠óËäÇÊµÅ‰∏é <code>Request</code> Âíå <code>Response</code> ÂØπË±°ÁöÑËΩ¨Âåñ„ÄÇ</li>
<li>Âä†ËΩΩÂπ∂ÁÆ°ÁêÜ <code>Servlet</code> ÔºåÂπ∂Â∞ÜËØ∑Ê±Ç‰∫§ÁªôServletÂ§ÑÁêÜ„ÄÇ</li>
</ul>
<p>‰ΩÜ<code>webÊúçÂä°Âô®</code> Âíå<code>servletÂÆπÂô®</code>‰æùÊóßÊòæÁöÑÊúâ‰∫õÊäΩË±°Ôºå‰ªñ‰ª¨Âà∞Â∫ïÊòØ‰ªÄ‰πàÔºü</p>
<p>ÁêÜËß£‰ªÄ‰πàÊòØtomcat Â∞±ÊòØÁêÜËß£tomcatÂà∞Â∫ïÂ∏ÆÊàë‰ª¨ÂÅö‰∫Ü‰ªÄ‰πà„ÄÇÊàë‰ª¨Âú®‰∏äÊâãÂÅöJava webÈ°πÁõÆÊó∂ÂæÄÂæÄÈÉΩÊòØÂü∫‰∫éÊ°ÜÊû∂ÊØîÂ¶Çspringboot,Êù•‰∏ìÊ≥®‰∫é‰∏öÂä°‰ª£Á†ÅÂºÄÂèëÔºåÊàë‰ª¨Áü•ÈÅìÊåâÁÖßspringboot ÁöÑËßÑÂàôÊù•ÂÆö‰πâ‰∏Ä‰∫õcontroller, Â∞±ÂèØ‰ª•Êé•Êî∂Âà∞‰ªéÊµèËßàÂô®ÂèëËøáÊù•ÁöÑHTTPËØ∑Ê±Ç„ÄÇ</p>
<p>‰ΩÜÊòØÔºå==<strong>‰∏∫‰ªÄ‰πàcontrollerÂèØ‰ª•Êî∂Âà∞Âπ∂Â§ÑÁêÜÂÆ¢Êà∑Á´ØÂèëËøáÊù•ÁöÑËØ∑Ê±Ç</strong>==?</p>
<p>Á≠îÊ°àÊòØÂõ†‰∏∫gradle ÊàñËÄÖmaven ‰∏≠Êúâ<code>spring-boot-starter-web</code> Ëøô‰∏™‰æùËµñÔºåËÄåËøô‰∏™‰æùËµñÈªòËÆ§Â∏ÆÊàë‰ª¨ÈõÜÊàê‰∫ÜTomcat„ÄÇÂú®Ëøõ‰∏ÄÊ≠•ÁêÜËß£tomcatÊòØÊÄé‰πàÂ∏ÆÊàëÊé•Êî∂Âπ∂Ëß£ÊûêHTTPËØ∑Ê±Ç‰πãÂâçÔºåÊàë‰ª¨ÂÖàËÆæÊÉ≥ÔºåÂ¶ÇÊûúÊ≤°ÊúâÊ°ÜÊû∂ÔºåÁ´ôÂú®tomcatÂºÄÂèëËÄÖÁöÑËßíÂ∫¶Êù•ÊÄùËÄÉÊàë‰ª¨Ë¶ÅËá™Â∑±ÂÆûÁé∞‰∏ãÈù¢ËøôÊ†∑ÁöÑÂäüËÉΩÂ∫îËØ•Ë¶ÅÊÄé‰πàÂÅö„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gherkin" data-lang="gherkin"><span class="line"><span class="cl"><span class="k">Scenario:</span><span class="nf"> Receive and Process HTTP Request
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">
</span></span></span><span class="line"><span class="cl"><span class="k">Given </span><span class="nf">the system is running
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">When </span><span class="nf">a valid HTTP request is received
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">Then </span><span class="nf">the system should successfully parse the HTTP request
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">And </span><span class="nf">extract the request path, parameters, method, and body if present
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">And </span><span class="nf">generate an appropriate HTTP response
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">And </span><span class="nf">include the correct HTTP status code indicating successful processing
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">And </span><span class="nf">include the expected response body format and data if applicable
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">And </span><span class="nf">include the appropriate HTTP headers in the response (e.g., Content-Type)
</span></span></span></code></pre></div><h2 id="ÁêÜËß£http-ËØ∑Ê±ÇÁöÑÊú¨Ë¥®">ÁêÜËß£HTTP ËØ∑Ê±ÇÁöÑÊú¨Ë¥®</h2>
<p>HTTPËØ∑Ê±ÇÊòØÂÆ¢Êà∑Á´ØÂú®ÂêëÊúçÂä°Á´ØËØ∑Ê±ÇÊüê‰∏™ËµÑÊ∫êÊó∂ÔºåÂêëÊúçÂä°Á´ØÂèëÈÄÅÁöÑÁ¨¶ÂêàHTTPÂçèËÆÆËßÑËåÉÁöÑÊï∞ÊçÆÔºå‰∏ãÈù¢ÁªôÂá∫‰∏Ä‰∏™ÂÆåÊï¥ÁöÑGET ËØ∑Ê±ÇÁ§∫‰æã</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">GET /sample HTTP/1.1 
</span></span><span class="line"><span class="cl">Host: www.example.com
</span></span><span class="line"><span class="cl">Accept: application/json
</span></span></code></pre></div><h2 id="ÊâãÂÜôÊúÄÁÆÄÁâàtomcat">ÊâãÂÜôÊúÄÁÆÄÁâàTomcat</h2>
<h3 id="Â¶Ç‰ΩïÂèëËµ∑httpËØ∑Ê±Ç">Â¶Ç‰ΩïÂèëËµ∑HTTPËØ∑Ê±ÇÔºü</h3>
<p>ÂèëËµ∑HTTPËØ∑Ê±ÇÂÖ∂ÂÆûÂ∞±ÊÑèÂë≥ÁùÄÊàë‰ª¨Ë¶ÅÊääËøôÈÉ®ÂàÜÊï∞ÊçÆÂèëÈÄÅÁªôÊúçÂä°Á´Ø„ÄÇ</p>
<p>ÈÇ£Êàë‰ª¨Ë¶ÅÊÄé‰πàÊääËøôÈÉ®ÂàÜÊï∞ÊçÆÂèëÈÄÅÁªôÊúçÂä°Âô®Âë¢ÔºüËøôÂÖ∂ÂÆûÊ∂âÂèäËÆ°ÁÆóÊú∫ÁΩëÁªúÁöÑÂü∫Á°ÄÔºåËÆ°ÁÆóÊú∫‰πãÈó¥ÊòØÂ¶Ç‰ΩïÈÄö‰ø°ÁöÑ„ÄÇ</p>
<p>ÂÅáËÆæÊúâ‰∏Ä‰∏™‰∏ªÊú∫AÔºåÊúâ‰∏Ä‰∏™‰∏ªÊú∫BÔºåAÈúÄË¶ÅÈÄöËøáÊµèËßàÂô®ÂèëÈÄÅHTTPËØ∑Ê±ÇÁªôBÁöÑJava ËøõÁ®ã„ÄÇÈÇ£‰πàÁªèÂéÜÂ¶Ç‰∏ãÊ≠•È™§Ôºö</p>
<p>1.<strong>HTTP ÊòØÂ∫îÁî®Â±ÇÂçèËÆÆÔºåÂú®ÂèëÈÄÅÊï∞ÊçÆ‰πãÂâçÔºåA‰∏≠ÁöÑÊµèËßàÂô®ÈúÄË¶ÅÂíåB‰∏≠ÁöÑJava ËøõÁ®ãÂª∫Á´ã‰∏Ä‰∏™TCP ÈìæÊé•„ÄÇ</strong></p>
<p>ÈÇ£Êàë‰ª¨Â¶Ç‰ΩïÂª∫Á´ãTCP ÈìæÊé•Âë¢ÔºåÂÖ∂ÂÆûËøôÈÉ®ÂàÜÂ∑•‰ΩúÊòØÁî±Â∫îÁî®Â±ÇÁöÑÂ∫ïÂ±ÇÂ∫ìÂéªÂ∏ÆÊàë‰ª¨Êù•ÂÅöÁöÑ„ÄÇ‰ª•Java ‰∏∫‰æãÔºåËøô‰∏™Á±ªÂ∫ìÂ∞±Âè´ÂÅöSocket„ÄÇÂÆÉ‰πüÊòØÂú®ÁΩëÁªúÈÄö‰ø°‰∏≠ÁöÑ‰∏Ä‰∏™ÁßçÊäΩË±°Ê¶ÇÂøµÔºå‰ªéJavaÁöÑËßíÂ∫¶Êù•ÁêÜËß£Âª∫Á´ã‰∏Ä‰∏™TCP ÈìæÊé•ÂÖ∂ÂÆûÂ∞±ÊòØÁîüÊàê‰∫Ü‰∏Ä‰∏™Socket ÂØπË±°Ôºå‰∏ãÈù¢ÊòØ‰∏Ä‰∏™Âª∫Á´ãTCPÈìæÊé•Á§∫‰æãÔºö</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">socket</span> <span class="p">=</span> <span class="n">Socket</span><span class="p">(</span><span class="s2">&#34;google.com&#34;</span><span class="p">,</span> <span class="m">443</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">println</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">isConnected</span><span class="p">)</span>
</span></span></code></pre></div><p>ÂΩì‰∏äËø∞‰ª£Á†ÅËæìÂá∫<code>true</code> Â∞±Ë°®ÊòéÂ∑≤ÁªèÂª∫Á´ã‰∫ÜÈìæÊé•ÔºåËøôÂ∫ïÂ±ÇÁî±JDK Ë∞ÉÁî®Êìç‰ΩúÁ≥ªÁªüAPI Êù•ÂÆûÁé∞„ÄÇ</p>
<p>2.<strong>ÈìæÊé•Âª∫Á´ãÂêéÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÊµÅÂºèÁöÑ‰º†ËæìÊï∞ÊçÆÔºåÂèëËµ∑HTTPËØ∑Ê±ÇÂÖ∂ÂÆûÂ∞±ÊòØÂêë‰∏Ä‰∏™Âú∞ÊñπÂéªÂÜôÁ¨¶ÂêàHTTPËßÑËåÉÊï∞ÊçÆ</strong>„ÄÇ</p>
<p>ÂêëÂì™ÈáåÂÜôÔºü‰æùÊóß‰ª•Java ‰∏∫‰æãÔºå‰∏äÈù¢ËØ¥Âà∞Âú®ÁΩëÁªú‰∏≠ÁöÑÈÄö‰ø°Êàë‰ª¨Êúâ‰∏™ÊäΩË±°ÁöÑ‰∏úË•øÂè´Socket, ËÄåJDK Á±ªÂ∫ìÂ∏ÆÊàë‰ª¨ÂÅö‰∫ÜÂ∫ïÂ±ÇÂÆûÁé∞ÔºåÂõ†Ê≠§Êàë‰ª¨ÂÜôÊï∞ÊçÆËØªÊï∞ÊçÆËøòÊòØÈù¢ÂêëSocket„ÄÇ‰∏ãÈù¢ÊòØÂêësocket Êï∞ÊçÆÁöÑÁ§∫‰æãÔºö</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="err">#</span> <span class="n">ÂÜôÂÖ•‰∏Ä‰∏™Â≠óËäÇÊï∞ÁªÑ</span>
</span></span><span class="line"><span class="cl"><span class="n">socket</span><span class="p">.</span><span class="n">getOutputStream</span><span class="p">().</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;Ping!&#34;</span><span class="p">.</span><span class="n">toByteArray</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span><span class="n">‰πüÂèØ‰ª•ÂÜôÂÖ•Âçï‰∏™Â≠óËäÇ</span>
</span></span><span class="line"><span class="cl"><span class="n">socket</span><span class="p">.</span><span class="n">getOutputStream</span><span class="p">().</span><span class="n">write</span><span class="p">(</span><span class="m">71</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>ËøôÈáåÁöÑbyte,71Ê†πÊçÆÂ≠óÁ¨¶ÁºñÁ†ÅÂèØ‰ª•Ëß£ÊûêÊàêÂØπÂ∫îÁöÑÂ≠óÁ¨¶Ôºå71ÈÄöÂ∏∏ÂØπÂ∫îÁöÑÊòØÂ≠óÊØçG,  ÂÖ≥‰∫éÂ≠óÁ¨¶ÁºñÁ†ÅËØ∑ÂèÇËÄÉÊàëÁöÑÂè¶‰∏ÄÁØáÁ¨îËÆ∞Ôºö<a class="link" href="https://woaihuangfan.github.io/posts/ascii-unicode-and-charset/"  target="_blank" rel="noopener"
    >ASCII„ÄÅUnicodeÂíåUTF-8‰∏éÂ≠óÁ¨¶ÁºñÁ†Å</a></p>
</blockquote>
<p>3.<strong>Êàë‰ª¨ÂêëSocketÂÜôÂÖ•Êï∞ÊçÆÂêéÔºåÂâ©‰∏ãÁöÑ‰πü‰ºöÁî±jvmÂíåÊìç‰ΩúÁ≥ªÁªüÂ∏ÆÊàë‰ª¨Â§ÑÁêÜÔºåÈÄöËøáÈÄö‰ø°ÁΩëÁªú‰º†ËæìÂà∞‰∏ªÊú∫B‰∏ä</strong>„ÄÇ</p>
<p>Ëá≥Ê≠§ÔºåÊàë‰ª¨Â∑≤ÁªèÁü•ÈÅì‰∫ÜÂÆ¢Êà∑Á´ØÂèëËµ∑‰∏Ä‰∏™HTTPËØ∑Ê±ÇÁöÑÊó∂ÂÄôÂπ≤‰∫Ü‰ªÄ‰πàÔºå‰∏çÂêåÁöÑÂ∫îÁî®Á®ãÂ∫èÂ∫ïÂ±ÇÂØπ‰∫éSocketÂèØËÉΩÊúâ‰∏çÂêåÂÆûÁé∞, ‰ΩÜËøôÈÉ®ÂàÜÂ∫ïÂ±ÇÁªÜËäÇÂÖ∂ÂÆûÂæÄÂæÄ‰∏çÁî®Êàë‰ª¨ÊìçÂøÉÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÁü•ÈÅìÂèëËµ∑HTTPËØ∑Ê±ÇÂ∞±ÊòØÂèëÈÄÅ‰∫Ü‰∏ÄÊÆµÁ¨¶ÂêàHTTPÂçèËÆÆËßÑËåÉÁöÑÊï∞ÊçÆÂà∞ÊúçÂä°Á´Ø„ÄÇÂÖ≥‰∫éÊõ¥Â§öHTTP ÂçèËÆÆÁöÑÂÜÖÂÆπËØ∑ÂèÇÈòÖÁõ∏ÂÖ≥ÊñáÊ°£„ÄÇ</p>
<h3 id="Â¶Ç‰ΩïÊé•Êî∂Âπ∂Â§ÑÁêÜhttp-ËØ∑Ê±Ç">Â¶Ç‰ΩïÊé•Êî∂Âπ∂Â§ÑÁêÜHTTP ËØ∑Ê±Ç?</h3>
<h4 id="Á´ØÂè£ÁõëÂê¨">Á´ØÂè£ÁõëÂê¨</h4>
<p>‰∏äÈù¢ËØ¥Âà∞ÂèëËµ∑HTTP ËØ∑Ê±ÇÂÖ∂ÂÆûÂ∞±ÊòØÂèëÈÄÅ‰∏ÄÊÆµÊï∞ÊçÆÁªôÊúçÂä°Á´ØÔºåÈÇ£‰∏∫‰ªÄ‰πàÂèØ‰ª•ÂèëÈÄÅÊï∞ÊçÆÂë¢ÔºüÂõ†‰∏∫Êàë‰ª¨Âú®ÂèëÈÄÅÊï∞ÊçÆ‰πãÂâçÂª∫Á´ã‰∫ÜTCP ÈìæÊé•ÔºåËÄåTCP ÊòØ‰∏ÄÁßçÈù¢ÂêëÈìæÊé•ÁöÑÂèØÈù†ÁöÑÂçèËÆÆÔºåÈÇ£‰∏∫‰ªÄ‰πàÂèØ‰ª•Âª∫Á´ãTCPÈìæÊé•Ôºü<code>Socket(&quot;google.com&quot;, 443)</code> ËøôÊÆµ‰ª£Á†Å‰∏≠ÁöÑ‰∏§‰∏™ÂèÇÊï∞ÊòØ‰ªÄ‰πàÂê´‰πâÔºü</p>
<p>ÂüüÂêç‰ºöË¢´DNSÊúçÂä°Âô®Ëß£ÊûêÊàêip, Áî®Êù•Âú®ÁΩëÁªú‰º†Ëæì‰∏≠ÊâæÂà∞ÂØπÂ∫îÁöÑ‰∏ªÊú∫ÔºåËÄå443ÂàôË°®Á§∫ÊúçÂä°Âô®Ê≠£Âú®ÁõëÂê¨ÁöÑÁ´ØÂè£Ôºå Ê≥®ÊÑè‰∏Ä‰∏™ËøõÁ®ãÂèØËÉΩ‰ºöÁî®Âà∞Â§ö‰∏™Á´ØÂè£„ÄÇ</p>
<p>‰∏ãÈù¢Êàë‰ª¨ÁúãÊÄé‰πàÂú®Java ‰∏≠ÂºÄÂêØËøôÊ†∑ÁöÑÁ´ØÂè£ÁõëÂê¨„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">serverSocket</span> <span class="p">=</span> <span class="n">ServerSocket</span><span class="p">(</span><span class="m">8080</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">println</span><span class="p">(</span><span class="s2">&#34;Server started successfully, listening on port: 8080&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>Êàë‰ª¨Áî®Âà∞‰∫Ü<code>ServerSocket</code>Ëøô‰∏™Á±ªÔºåÂÆÉÊèê‰æõ‰∫Ü‰∏ÄÁßçÊú∫Âà∂Ôºå‰ΩøÂæóJavaÂ∫îÁî®Á®ãÂ∫èËÉΩÂ§üÁõëÂê¨ÂÆ¢Êà∑Á´ØÁöÑËøûÊé•ËØ∑Ê±ÇÔºåÂπ∂Âú®ËøûÊé•Âª∫Á´ãÂêéËøõË°åÈÄö‰ø°„ÄÇËÄåËøôÂ∫ïÂ±Ç‰πüÊòØÊúâJDKË∞ÉÁî®Êìç‰ΩúÁ≥ªÁªüAPI ÂÆûÁé∞„ÄÇ</p>
<p>1.ÂÆÉÂª∫Á´ã‰∫Ü‰∏Ä‰∏™‰∏ìÈó®‰æ¶Âê¨ÊüêÁ´ØÂè£ÁöÑsocket</p>
<p>2.ÊØèÊ¨°ÊàêÂäü‰∏éÂÆ¢Êà∑Á´ØÊè°ÊâãÂêé,‰ºöÂàõÂª∫‰∏Ä‰∏™ÈíàÂØπÂΩìÂâçÂÆ¢Êà∑ÁöÑÊñ∞socket</p>
<p>3.ÂêéÁª≠Á®ãÂ∫èÈÄöËøáËøô‰∏™socket‰∏éÂÆ¢Êà∑Á´ØËøõË°åÊï∞ÊçÆ‰∫§‰∫í</p>
<h4 id="ËØªÂèñÊï∞ÊçÆÂπ∂Ëß£ÊûêÊàêhttp-ËØ∑Ê±Ç">ËØªÂèñÊï∞ÊçÆÂπ∂Ëß£ÊûêÊàêHTTP ËØ∑Ê±Ç</h4>
<p>ÂÜçÊ¨°ËØ¥Âà∞ÂèëËµ∑‰∏Ä‰∏™HTTPËØ∑Ê±ÇÂ∞±ÊòØÂèëÈÄÅ‰∫Ü‰∏ÄÊÆµÊï∞ÊçÆÁªôÊúçÂä°Âô®ÔºåÊàë‰ª¨ÁúãÊÄé‰πàÊ†∑ËØªÂèñËøô‰ªΩÊï∞ÊçÆ„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="err">#</span> <span class="n">Âª∫Á´ãServerSocketÂêéË∞ÉÁî®accept</span> <span class="n">ÊñπÊ≥ïÊù•Êé•Êî∂ËØ∑Ê±Ç</span><span class="err">Ôºå</span><span class="n">Âú®ÊúâËØ∑Ê±ÇÂà∞Êù•‰πãÂâçËøô‰∏™ÊñπÊ≥ï‰ºö‰∏ÄÁõ¥ÈòªÂ°û</span><span class="err">Ôºå</span><span class="n">Âπ∂‰∏î‰∏∫‰∫ÜÂ§ÑÁêÜÂ§öÊ¨°ËØ∑Ê±Ç</span><span class="err">Ôºå</span><span class="n">‰∏ÄËà¨‰ºöÂæ™ÁéØË∞ÉÁî®</span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="py">socket</span> <span class="p">=</span> <span class="n">serverSocket</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="n">‰∏äËø∞ÊñπÊ≥ïËøîÂõû‰∫ÜSocket</span><span class="p">,</span> <span class="n">ËøôÂíåÊàë‰ª¨‰ªéÂÆ¢Êà∑Á´ØÂª∫Á´ãÈìæÊé•Êó∂ÁúãÂà∞ÁöÑSocket</span> <span class="n">ÊòØ‰∏ÄÊ†∑ÁöÑ</span><span class="err">Ôºå</span><span class="n">Âõ†‰∏∫ËØ¥‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÁΩëÁªú‰∏äÁöÑÈÄö‰ø°Êàë‰ª¨ÈÉΩÊòØÈù¢ÂêëSocket</span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="py">bytes</span> <span class="p">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">getInputStream</span><span class="p">().</span><span class="n">let</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">bytes</span> <span class="p">=</span> <span class="n">ByteArray</span><span class="p">(</span><span class="k">it</span><span class="p">.</span><span class="n">available</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">it</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">bytes</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">println</span><span class="p">(</span><span class="n">bytes</span><span class="p">.</span><span class="n">decodeToString</span><span class="p">())</span>
</span></span></code></pre></div><p>Âú®10Ë°åËøêË°åÂÆåÂêéÊàë‰ª¨ÂèØ‰ª•Âú®ÊéßÂà∂Âè∞ÁúãÂà∞Á±ª‰ºº‰∏ãÈù¢ËøôÊ†∑ÁöÑËæìÂá∫Ôºö</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">GET /sample HTTP/1.1 
</span></span><span class="line"><span class="cl">Host: www.example.com
</span></span><span class="line"><span class="cl">Accept: application/json
</span></span></code></pre></div><p>ËøôÊ≠£ÊòØÊàë‰ª¨Âú®ÂÆ¢Êà∑Á´ØÂèëËµ∑ÁöÑHTTP ËØ∑Ê±ÇÔºÅ</p>
<p>ÁÑ∂ÂêéÊàë‰ª¨Â∞±ÂèØ‰ª•ÂéªËß£ÊûêËøôÊÆµÊñáÊú¨ÔºåÂåÖÊã¨ÂéªËß£ÊûêËØ∑Ê±ÇË°åÔºåËØ∑Ê±ÇÂ§¥ÔºåËØ∑Ê±Ç‰ΩìÁ≠âÂü∫‰∫éÂ≠óÁ¨¶‰∏≤Êìç‰ΩúÂéªËøõË°åÂÖ∑‰ΩìÁöÑ‰∏öÂä°Â§ÑÁêÜ„ÄÇ</p>
<h4 id="Â¶Ç‰ΩïÂìçÂ∫î">Â¶Ç‰ΩïÂìçÂ∫î</h4>
<p>ÂìçÂ∫îÊòØÁî±ÊúçÂä°Á´ØÂêëÂÆ¢Êà∑Á´ØÂìçÂ∫îÔºåÂìçÂ∫îÂ∞±ÊòØÂõû‰º†Êª°Ë∂≥HTTP ÂçèËÆÆÁöÑËßÑËåÉÊï∞ÊçÆÔºåÂêåÊ†∑ÊòØÈù¢ÂØπsocket ÂØπË±°ËøõË°åÔºåJDK ÂíåÊìç‰ΩúÁ≥ªÁªü‰ºöÂ∏ÆÊàë‰ª¨Â§ÑÁêÜÂ∫ïÂ±ÇÂíåÂâ©‰∏ãÁöÑ‰∫ã„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="n">socket</span><span class="p">.</span><span class="n">getOutputStream</span><span class="p">().</span><span class="n">write</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;HTTP/1.1 200 OK</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Type: text/plain</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Length: 25</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Hello, World and /sample!&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">).</span><span class="n">toByteArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>ÂÆ¢Êà∑Á´ØÊé•Êî∂Âà∞Ëøô‰ªΩÊï∞ÊçÆÂêé‰æøÂèØ‰ª•Ê†πÊçÆÊ†πÊçÆHTTP ÂçèËÆÆËß£ÊûêÊï∞ÊçÆÁÑ∂Âêé‰ΩúÂØπÂ∫îÂ§ÑÁêÜ„ÄÇ</p>
<p>‰ª•‰∏äÂ∞±ÊòØËá™Â∑±ÂéªÂÆûÁé∞Ëøô‰∏™ÈúÄÊ±ÇË¶ÅÂÅöÁöÑ‰∫ãÔºåÁÑ∂ËÄåÊàë‰ª¨Âπ≥Êó∂Âú®‰ΩøÁî®springbootÂºÄÂèëÊó∂Âá†‰πé‰∏çÈúÄË¶ÅÂÖ≥ÂøÉËøô‰∫õÔºåÂõ†‰∏∫ÈõÜÊàêÁöÑtomcat‰ºöÂ∏ÆÊàë‰ª¨Â§ÑÁêÜÔºåËøôÊ≠£ÊòØTomcat ÁöÑÊ†∏ÂøÉÂäüËÉΩ‰πã‰∏ÄÔºö</p>
<p>==<strong>Â§ÑÁêÜ <code>Socket</code> ËøûÊé•ÔºåË¥üË¥£ÁΩëÁªúÂ≠óËäÇÊµÅ‰∏é <code>Request</code> Âíå <code>Response</code> ÂØπË±°ÁöÑËΩ¨Âåñ</strong>==„ÄÇ</p>
<h4 id="ÊúÄÁÆÄÁâàtomcat">ÊúÄÁÆÄÁâà<strong>Tomcat</strong></h4>
<p>Â∞Ü‰ª•‰∏äÊ≠•È™§ÂÜç‰∏≤Ëµ∑Êù•Êàë‰ª¨Â∞±ÂèØ‰ª•Ëá™Â∑±ÂéªÂÆûÁé∞tomcatÔºå Ê≥®ÊÑèÔºåÁúüÊ≠£ÁöÑtomcatÂÆûÁé∞ÂíåÂäüËÉΩË¶ÅÊØîËøô‰∏™Â§çÊùÇÁöÑÂ§öÔºå‰ΩÜÁêÜËß£ËøôÈÉ®ÂàÜÂÜÖÂÆπÂØπ‰∫éÊàë‰ª¨ÁêÜËß£‰ªÄ‰πàÊòØTomcatÂæàÈáçË¶ÅÔºåÂõ†‰∏∫<strong>tomcatÂú®ÂÅöÁùÄÁ±ª‰ººÁöÑ‰∫ãÊÉÖ</strong>„ÄÇ</p>
<p><strong>ÊµãËØïÂÖàË°å</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">`should successfully process valid HTTP request`</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Given
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">MyHttpServer</span><span class="p">(</span><span class="n">TEST_PORT</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// When
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÂèëËµ∑HTTP ËØ∑Ê±Ç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">val</span> <span class="py">socket</span> <span class="p">=</span> <span class="n">sendRequest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Then
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">assertEquals</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;HTTP/1.1 200 OK</span><span class="se">\r\n</span><span class="s2">Content-Type: text/plain</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="p">+</span> <span class="s2">&#34;Content-Length: 25</span><span class="se">\r\n\r\n</span><span class="s2">Hello, World and /sample!&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">decodeResponse</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 1.Âª∫Á´ãsocketËøûÊé•
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2.Âêësocket‰∏≠ÂÜôÂÖ•Á¨¶ÂêàHTTPËßÑËåÉÁöÑÊï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 3.ËøîÂõûsocket
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">fun</span> <span class="nf">sendRequest</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">httpRequest</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="s2">&#34;GET /sample HTTP/1.1</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="p">+</span> <span class="s2">&#34;Host: localhost</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="p">+</span> <span class="s2">&#34;Accept: application/json</span><span class="se">\r\n\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span> <span class="n">Socket</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">socket</span> <span class="p">=</span> <span class="n">Socket</span><span class="p">(</span><span class="nc">Constants</span><span class="p">.</span><span class="n">LOCAL_HOST</span><span class="p">,</span> <span class="nc">Constants</span><span class="p">.</span><span class="n">TEST_PORT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">socket</span><span class="p">.</span><span class="n">getOutputStream</span><span class="p">().</span><span class="n">write</span><span class="p">(</span><span class="n">httpRequest</span><span class="p">.</span><span class="n">toByteArray</span><span class="p">(</span><span class="nc">Charset</span><span class="p">.</span><span class="n">defaultCharset</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">socket</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>SampleHttpServerÁ±ª</strong></p>
<ul>
<li>Ë¥üË¥£ÂàõÂª∫ServerSocketÁõëÂê¨Á´ØÂè£</li>
<li>Êé•Êî∂ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÔºå‰ªéSocket ‰∏≠ËØªÂèñÊï∞ÊçÆËß£ÊûêÊàêRequestÂØπË±°</li>
<li>ÊûÑÂª∫Response ÂØπË±°Âπ∂ÂêëSocket‰∏≠ÂÜôÂÖ•Êï∞ÊçÆ</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">package</span> <span class="nn">com.fan</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">java.net.ServerSocket</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">java.net.Socket</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">java.net.SocketException</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">java.nio.charset.StandardCharsets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SampleHttpServer</span><span class="p">(</span><span class="k">private</span> <span class="k">val</span> <span class="py">port</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">serverSocket</span><span class="p">:</span> <span class="n">ServerSocket</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">var</span> <span class="py">isRunning</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">createServerSocket</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">${currentThreadName()}</span><span class="s2">Server started successfully, listening on port </span><span class="si">$port</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">Thread</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="p">(</span><span class="n">isRunning</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">val</span> <span class="py">clientSocket</span> <span class="p">=</span> <span class="n">acceptClientConnection</span><span class="p">(</span><span class="n">serverSocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">clientSocket</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">handleClientRequest</span><span class="p">(</span><span class="n">clientSocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">closeSocket</span><span class="p">(</span><span class="n">clientSocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">closeSocket</span><span class="p">(</span><span class="n">clientSocket</span><span class="p">:</span> <span class="n">Socket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">checkIfSocketClosed</span><span class="p">(</span><span class="n">clientSocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(!</span><span class="n">clientSocket</span><span class="p">.</span><span class="n">isClosed</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">clientSocket</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">checkIfSocketClosed</span><span class="p">(</span><span class="n">clientSocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">checkIfSocketClosed</span><span class="p">(</span><span class="n">clientSocket</span><span class="p">:</span> <span class="n">Socket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">${currentThreadName()}</span><span class="s2">client socket closed? </span><span class="si">${clientSocket.isClosed}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">createServerSocket</span><span class="p">(</span><span class="n">port</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">serverSocket</span> <span class="p">=</span> <span class="n">ServerSocket</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">acceptClientConnection</span><span class="p">(</span><span class="n">serverSocket</span><span class="p">:</span> <span class="n">ServerSocket</span><span class="p">):</span> <span class="n">Socket</span><span class="p">?</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">clientSocket</span> <span class="p">=</span> <span class="n">serverSocket</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">println</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">${currentThreadName()}</span><span class="s2">Accepted client connection from: </span><span class="si">${clientSocket.inetAddress}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">clientSocket</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">SocketException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//socket maybe closed from client, ignore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">println</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">${currentThreadName()}</span><span class="s2"> </span><span class="si">${e.message}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">handleClientRequest</span><span class="p">(</span><span class="n">clientSocket</span><span class="p">:</span> <span class="n">Socket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">requestBytes</span> <span class="p">=</span> <span class="n">readBytesFromSocketInputStream</span><span class="p">(</span><span class="n">clientSocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">${currentThreadName()}</span><span class="s2">Received bytes from client:</span><span class="si">${requestBytes.contentToString()}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">httpRequest</span> <span class="p">=</span> <span class="n">parseBytesToHttpRequest</span><span class="p">(</span><span class="n">requestBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">httpResponse</span> <span class="p">=</span> <span class="n">buildResponse</span><span class="p">(</span><span class="n">httpRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sendResponseToClient</span><span class="p">(</span><span class="n">httpResponse</span><span class="p">,</span> <span class="n">clientSocket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">readBytesFromSocketInputStream</span><span class="p">(</span><span class="n">socket</span><span class="p">:</span> <span class="n">Socket</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">socket</span><span class="p">.</span><span class="n">getInputStream</span><span class="p">().</span><span class="n">let</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">bytes</span> <span class="p">=</span> <span class="n">ByteArray</span><span class="p">(</span><span class="k">it</span><span class="p">.</span><span class="n">available</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="k">it</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">bytes</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">parseBytesToHttpRequest</span><span class="p">(</span><span class="n">bytes</span><span class="p">:</span> <span class="n">ByteArray</span><span class="p">):</span> <span class="n">Request</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">plainRequest</span> <span class="p">=</span> <span class="n">String</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span> <span class="nc">StandardCharsets</span><span class="p">.</span><span class="n">UTF_8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">${currentThreadName()}</span><span class="s2">Received request:</span><span class="se">\r\n</span><span class="s2">--------------</span><span class="se">\r\n</span><span class="si">$plainRequest</span><span class="se">\r\n</span><span class="s2">--------------&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">httpMethod</span> <span class="p">=</span> <span class="n">extractHttpMethod</span><span class="p">(</span><span class="n">plainRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">uri</span> <span class="p">=</span> <span class="n">extractUri</span><span class="p">(</span><span class="n">plainRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">protocol</span> <span class="p">=</span> <span class="n">extractProtocol</span><span class="p">(</span><span class="n">plainRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span><span class="n">httpMethod</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">extractHttpMethod</span><span class="p">(</span><span class="n">plainRequest</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">plainRequest</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">plainRequest</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">extractUri</span><span class="p">(</span><span class="n">plainRequest</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">start</span> <span class="p">=</span> <span class="n">plainRequest</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">)</span> <span class="p">+</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">end</span> <span class="p">=</span> <span class="n">plainRequest</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&#34;HTTP&#34;</span><span class="p">)</span> <span class="p">-</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">plainRequest</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">extractProtocol</span><span class="p">(</span><span class="n">plainRequest</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">start</span> <span class="p">=</span> <span class="n">plainRequest</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&#34;HTTP&#34;</span><span class="p">)</span> <span class="p">+</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">end</span> <span class="p">=</span> <span class="n">plainRequest</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">plainRequest</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">buildResponse</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">body</span> <span class="p">=</span> <span class="s2">&#34;Hello, World and </span><span class="si">${request.uri}</span><span class="s2">!&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">statusLine</span> <span class="p">=</span> <span class="s2">&#34;HTTP/1.1 200 OK&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">headers</span> <span class="p">=</span> <span class="s2">&#34;Content-Type: text/plain</span><span class="se">\r\n</span><span class="s2">Content-Length: </span><span class="si">${body.length}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">body</span> <span class="p">=</span> <span class="n">body</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">sendResponseToClient</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Response</span><span class="p">,</span> <span class="n">socket</span><span class="p">:</span> <span class="n">Socket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">responseBytes</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">toString</span><span class="p">().</span><span class="n">toByteArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">socket</span><span class="p">.</span><span class="n">getOutputStream</span><span class="p">().</span><span class="n">write</span><span class="p">(</span><span class="n">responseBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">${currentThreadName()}</span><span class="s2">Response sent to client.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">currentThreadName</span><span class="p">()</span> <span class="p">=</span> <span class="s2">&#34;[</span><span class="si">${Thread.currentThread().name}</span><span class="s2">] &#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">stop</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">isRunning</span> <span class="p">=</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">::</span><span class="n">serverSocket</span><span class="p">.</span><span class="n">isInitialized</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">serverSocket</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Request Âíå Response</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">package</span> <span class="nn">com.fan</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="k">class</span> <span class="nc">Request</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">method</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">protocol</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">uri</span><span class="p">:</span> <span class="n">String</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="k">class</span> <span class="nc">Response</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">statusLine</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">headers</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">body</span><span class="p">:</span> <span class="n">String</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="n">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">statusLine</span> <span class="p">+</span> <span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="p">+</span> <span class="n">headers</span> <span class="p">+</span> <span class="s2">&#34;</span><span class="se">\r\n\r\n</span><span class="s2">&#34;</span> <span class="p">+</span> <span class="n">body</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>Ê∫êÁ†ÅÂú∞ÂùÄ: <a class="link" href="https://github.com/woaihuangfan/how-tomcat-works.git"  target="_blank" rel="noopener"
    >https://github.com/woaihuangfan/how-tomcat-works.git</a></p>
</blockquote>
<p>ËøôÊòØÈááÁî®Â§ßÈÉ®ÂàÜ‰∫∫ËæÉ‰∏∫ÁÜüÊÇâBIOÁöÑÁöÑÂÆûÁé∞ÊñπÂºèÔºåËÄå‰ªétomcat 8.0ÂºÄÂßã‰ºöÈªòËÆ§‰ΩøÁî®NIOÁöÑÊñπÂºèÊù•Â§ÑÁêÜËØ∑Ê±ÇÔºåÂÖ≥‰∫éNIOÁöÑdemoËØ∑Âú®Ê∫êÁ†Å‰∏≠ÂØªÊâæ<code>NioHttpServer</code>„ÄÇ</p>
<h2 id="‰ªÄ‰πàÊòØservlet">‰ªÄ‰πàÊòØServlet</h2>
<p>webÂºÄÂèëÔºåÊàë‰ª¨ÂÖ∂ÂÆû‰∏ªË¶ÅÂ§ÑÁêÜ‰∏â‰ª∂‰∫ãÔºö</p>
<ol>
<li>Êé•Êî∂ËØ∑Ê±ÇÔºö ‰ªésocket ‰∏≠ËØªÂèñÊï∞ÊçÆ</li>
<li>Â§ÑÁêÜËØ∑Ê±ÇÔºöÂÖ∑‰ΩìÁöÑ‰∏öÂä°ÈÄªËæëÔºåÊØîÂ¶ÇÈíàÂØπÊï∞ÊçÆÂ∫ìÁöÑcurd</li>
<li>ÂìçÂ∫î: Âêësocket ‰∏≠ÂÜôÂÖ•Êï∞ÊçÆ</li>
</ol>
<p>#1Âíå#3Êìç‰ΩúÊòØÂü∫Á°ÄÊìç‰ΩúÔºåÂ§ßÂÆ∂ÈÉΩË¶ÅÂπ≤Ëøô‰∫ã‰∏îÂπ≤ÁöÑÊñπÂºèÂü∫Êú¨ÈÉΩ‰∏ÄÊ†∑ÔºåÊó†ÈùûÂ∞±ÊòØÈíàÂØπsocketÁöÑÁΩëÁªúÁºñÁ®ãÔºå‰ΩÜÊòØÂ§ÑÁêÜËØ∑Ê±ÇÁöÑÈÉ®ÂàÜÊòØ‰∏çÂêåÁöÑÔºåÂõ†‰∏∫‰∏öÂä°ÈÄªËæëÂçÉÂ∑Æ‰∏áÂà´‰∏áÂà´„ÄÇ</p>
<p>#1‰∏≠ËØªÂèñÂà∞Êï∞ÊçÆÂêéÔºåÈúÄË¶Å‰∫§Áªô‰∏Ä‰∏™‰∏úË•ø(ÂØπË±°)ËÆ©2#Êù•Â§ÑÁêÜËØ∑Ê±ÇÔºåËøô‰∏™‰∏úË•øÂ§ÑÁêÜÂÆåËØ∑Ê±ÇÂêéËøòË¶ÅÁîüÊàêÂìçÂ∫î‰∫§Áªô#3Ôºå Êàë‰ª¨ÊääËøô‰∏™‰∏úË•ø(ÂØπË±°) Âè´<strong>Servlet</strong>„ÄÇServlet Â∞±ÊòØ#1 Âíå#2Ôºå #2Âíå#3‰πãÈó¥ÁöÑËøô‰∏™‰∏≠Èó¥Â±Ç„ÄÇ</p>
<blockquote>
<p>‰∏Ä‰∏™ÊúâÊÑèÊÄùÁöÑÈóÆÈ¢òÊòØÔºåÂ§ÑÁêÜËØ∑Ê±ÇÊó∂Âè™ËÉΩÁî®‰∏Ä‰∏™ÂØπË±°ÂêóÔºüÂΩìÁÑ∂‰∏çÊòØÔºåÊàë‰ª¨Â§ÑÁêÜËØ∑Ê±ÇÂèØËÉΩÈúÄË¶ÅÁî®Âà∞Â§ö‰∏™ÂØπË±°ÔºàÊØîÂ¶ÇcontrollerÔºåservice),  ‰ΩÜËøô‰∫õcontroller service ÂØπË±°ËÉΩÂè´servletÂêóÔºü„ÄÇ</p>
</blockquote>
<p>ÊâÄ‰ª•Ëøô‰∏â‰ª∂‰∫ãÂÜçÂÖ∑‰Ωì‰∏ÄÁÇπÊÄªÁªì‰∏ãÂ∞±ÊòØÔºö</p>
<ol>
<li>Êé•Êî∂ËØ∑Ê±ÇÔºö ‰ªésocket ‰∏≠ËØªÂèñÊï∞ÊçÆÔºå ==Âπ∂ÊääÊï∞ÊçÆ‰∫§ÁªôServlet==</li>
<li>Â§ÑÁêÜËØ∑Ê±ÇÔºöServletÂ§ÑÁêÜÂÖ∑‰ΩìÁöÑ‰∏öÂä°ÈÄªËæëÔºåÊØîÂ¶ÇÈíàÂØπÊï∞ÊçÆÂ∫ìÁöÑcurdÔºåÁÑ∂ÂêéÁîüÊàêÂìçÂ∫î</li>
<li>ÂìçÂ∫î: Ëé∑ÂèñServletÁîüÊàêÁöÑÂìçÂ∫îÂπ∂Âêësocket ‰∏≠ÂÜôÂÖ•Êï∞ÊçÆ</li>
</ol>
<p>1Âíå3ÁöÑÊìç‰ΩúÂ§ßÂÆ∂ÂèØ‰ª•ÂÖ±Áî®ÔºåÂõ†Ê≠§ÂèØ‰ª•ÊîæÂà∞Ê°ÜÊû∂ÈáåÔºå#2ÈúÄË¶ÅÊàë‰ª¨Ëá™Â∑±ÂéªÂÆûÁé∞ÔºåÁé∞Âú®ÈóÆÈ¢òÊù•‰∫ÜÔºåÊàë‰ª¨Áü•ÈÅìË¶ÅÂÜôServlet ÂéªÂ§ÑÁêÜËØ∑Ê±ÇÔºå‰ΩÜÊòØÊàëÊÄé‰πàÁü•ÈÅìËØ•ÊÄé‰πàÂÜôÔºüÊØîÂ¶ÇÈúÄÁî®‰ªÄ‰πàÊñπÊ≥ïÂëΩÂêçÔºåÂèÇÊï∞Á≠âÁ≠âÊâçËÉΩË¢´Ê°ÜÊû∂Ë∞ÉÁî®Âà∞„ÄÇ</p>
<p>ÊúâÂêåÂ≠¶ÂèØËÉΩËØ¥ÂèñÂÜ≥‰∫é‰Ω†Áî®‰ªÄ‰πàÊ°ÜÊû∂Ôºå ‰ΩÜÂ¶ÇÊûúÊÉ≥Êç¢Ê°ÜÊû∂ÊÄé‰πàÂäûÔºü</p>
<p>Âõ†Ê≠§Êàë‰ª¨Â∞±Êúâ‰∫Ü<strong>ServletËßÑËåÉ</strong>ÔºåÊù•ÊåáÂØºÊ°ÜÊû∂ÊÄé‰πàÂÜôÔºåservletÊÄé‰πàÂÜôÔºå‰ª•Á°Æ‰øù‰∏çÂêåÁöÑServletÂÆπÂô®Ôºà‰æãÂ¶ÇTomcat„ÄÅJettyÁ≠âÔºâ‰πãÈó¥ÁöÑÂÖºÂÆπÊÄß„ÄÇÊØîÂ¶Ç:</p>
<ol>
<li>
<p>ËßÑÂÆö‰∫ÜÊâÄÊúâServletÁ±ªÈÉΩÂøÖÈ°ªÂÆûÁé∞<code>javax.servlet.Servlet </code> Ëøô‰∏™Êé•Âè£</p>
</li>
<li>
<p>ÂÆö‰πâ‰∫ÜServletÁöÑÁîüÂëΩÂë®ÊúüÔºåÊØîÂ¶ÇËßÑÂÆöÊØè‰∏Ä‰∏™servlet ÈÉΩÂøÖÈ°ªÊúâ <code>init()</code>„ÄÅ<code>service()</code>„ÄÅ<code>destroy()</code>Ôºå</p>
</li>
<li>
<p>ÊèèËø∞‰∫ÜServletÂÆπÂô®ÁöÑËÅåË¥£ÂíåÂäüËÉΩÔºåÊØîÂ¶ÇÂΩìËØ∑Ê±ÇÊù•‰∫Ü‰ºöË∞ÉÁî®ServletÂÆû‰æãÁöÑserviceÊñπÊ≥ï</p>
</li>
<li>
<p>Á≠âÁ≠â„ÄÇÊõ¥Â§öËØ¶ÁªÜÁöÑËßÑËåÉËØ∑ÂèÇÈòÖ</p>
</li>
</ol>
<blockquote>
<p>‚ö†Ô∏è Servlet API ÁöÑÂåÖÂêçËá™2020Âπ¥12ÊúàJakarta EE 9 ÂèëÂ∏ÉÂêéÂ∑≤Áªè‰ªé <code>javax.servlet</code> Êõ¥Êîπ‰∏∫ <code>jakarta.servlet</code></p>
</blockquote>
<p>Áõ∏‰ø°ÂæàÂ§ö‰∫∫Âú®Â≠¶java web Êó∂‰∏ÄÂºÄÂßãÈÉΩ‰ºöÂéªÂ≠¶ÊÄé‰πàÂÜô‰∏Ä‰∏™Servlet.</p>
<blockquote>
<p>ËßÑËåÉ„ÄÅÁ∫¶ÂÆöÁöÑÊÄùÊÉ≥ÈöèÂ§ÑÂèØËßÅÔºåËøô‰∏™‰∏ñÁïå‰∏áÁâ©ÁöÑËøêË°åÊú¨Ë¥®‰∏ä‰πüÊòØÂü∫‰∫éËßÑËåÉËßÑÂàô„ÄÇ</p>
</blockquote>
<p>ÂÜçÂéªÁêÜËß£‰ªÄ‰πàÊòØtomcatÁöÑÊó∂ÂÄôÂèëÁé∞<strong>tomcat ÂÖ∂ÂÆû‰πüÂÆûÁé∞‰∫ÜServletËßÑËåÉ</strong>Ôºå ‰πüÂèØ‰ª•ÁêÜËß£‰∏∫‰ªÄ‰πàËØ¥<strong>Tomcat ÊòØservlet ÂÆπÂô®</strong>‰∫Ü„ÄÇ</p>
<p><strong>Â∞èÁªì</strong></p>
<ul>
<li>Servlet ÊòØ‰∏ÄÊÆµÁ®ãÂ∫è</li>
<li>ÈúÄË¶ÅÁ¨¶ÂêàServletËßÑËåÉ</li>
<li>ÂÆÉ‰∏ªË¶ÅÁî®‰∫éÂ§ÑÁêÜÂíåÂìçÂ∫îHTTP ËØ∑Ê±Ç</li>
<li>ËøêË°åÂú®ÊîØÊåÅServletËßÑËåÉÁöÑÂÆπÂô®‰∏≠</li>
</ul>
<h1 id="tomcat-ÁöÑÂ∑•‰ΩúÂéüÁêÜ">Tomcat ÁöÑÂ∑•‰ΩúÂéüÁêÜ</h1>
<p>ËôΩÁÑ∂Â∫îÁî®Â§ßÈÉ®ÂàÜÂ∫îÁî®ÈÉΩÊòØÂü∫‰∫éspringbootÂèäÂÖ∂ÈªòËÆ§ÂÜÖÂµåÁöÑtomcatËøõË°åÂºÄÂèëÔºå‰ΩÜÊòØËÑ±Á¶ªÂ§çÊùÇÁöÑspringÊäätomcat‰Ωú‰∏∫Áã¨Á´ãÈÉ®ÁΩ≤ÁöÑ‰∏≠Èó¥‰ª∂ÂèØ‰ª•Êõ¥Â•ΩÁöÑÊù•Â∏ÆÂä©Êàë‰ª¨Êù•Â≠¶‰π†Âíå‰∫ÜËß£tomcat„ÄÇ</p>
<ol>
<li><strong>‰∏ãËΩΩTomcat</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl https://dlcdn.apache.org/tomcat/tomcat-10/v10.1.18/bin/apache-tomcat-10.1.18.zip -o apache-tomcat-10.1.18.zip
</span></span></code></pre></div><p>Ëß£ÂéãÂêéÂèØ‰ª•ÁúãÂà∞Â¶Ç‰∏ãÁõÆÂΩïÁªìÊûÑÔºö</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240129141653195.png"
	width="1004"
	height="698"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240129141653195_hu893c53693a6eb646ab8692361570f6ec_90149_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240129141653195_hu893c53693a6eb646ab8692361570f6ec_90149_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240129141653195"
	
	
		class="gallery-image" 
		data-flex-grow="143"
		data-flex-basis="345px"
	
></p>
<ol start="2">
<li>
<p><strong>Ëá™ÂÆö‰πâ‰∏Ä‰∏™Servlet</strong></p>
<p>‰ª•‰∏ã‰ª£Á†ÅÁî±kotlin ÂÆûÁé∞ÔºåÊ≥®ÊÑè<code>HttpServlet</code> Â∑≤ÁªèÂÆûÁé∞‰∫Ü<code>jakarta.servlet</code> ÊâÄ‰ª•Ê≠§Â§ÑÊàë‰ª¨Âè™ÈúÄË¶ÅÁªßÊâøHttpServletÂ∞±Ë°å„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DemoServlet</span> <span class="p">:</span> <span class="n">HttpServlet</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">doGet</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">HttpServletRequest</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">HttpServletResponse</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span><span class="p">.</span><span class="n">writer</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;Pong!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p><strong>ÁºñËØë‰∏äËø∞‰ª£Á†ÅÔºåÂæóÂà∞classÊñá‰ª∂</strong></p>
<p>Áî±‰∫éÊòØkotlin ‰ª£Á†ÅÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•Áî®IDEA ËøõË°åÁºñËØëÔºå‰πüÂèØ‰ª•Áî®Á¶ªÁ∫øÁöÑkotlinÁºñËØëÂô®ÔºåÊàëÊòØÈÄâÊã©ÁöÑÂâçËÄÖ„ÄÇ</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240130095816052.png"
	width="880"
	height="398"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240130095816052_hu57af22a11690458aff1c99c2409794e4_31071_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240130095816052_hu57af22a11690458aff1c99c2409794e4_31071_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240130095816052"
	
	
		class="gallery-image" 
		data-flex-grow="221"
		data-flex-basis="530px"
	
></p>
</li>
<li>
<p><strong>Â∞Üclass Êñá‰ª∂Êã∑Ë¥ùÂà∞tomcatÊåáÂÆöÁõÆÂΩï</strong></p>
<ul>
<li>
<p>Âú®<code>webapp</code> ‰∏ãÂàõÂª∫‰∏Ä‰∏™ÁõÆÂΩïÂëΩÂêç‰∏∫my-appÔºå Âπ∂Âú®my-appÂàõÂª∫Â¶Ç‰∏ãÁõÆÂΩïÁªìÊûÑÔºö</p>
<pre tabindex="0"><code>my-app
‚îî‚îÄ‚îÄ WEB-INF
    ‚îú‚îÄ‚îÄ classes
    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ org
    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ fan
    ‚îÇ¬†¬†         ‚îî‚îÄ‚îÄ DemoServlet.class
    ‚îú‚îÄ‚îÄ lib
    ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ annotations-13.0.jar
    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ kotlin-stdlib-1.9.21.jar
    ‚îî‚îÄ‚îÄ web.xml
</code></pre></li>
<li>
<p><code>web.xml</code> ÁöÑÂÜÖÂÆπÂ¶Ç‰∏ã</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;web-app</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-name&gt;</span>DemoServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-class&gt;</span>com.fan.DemoServlet<span class="nt">&lt;/servlet-class&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/servlet&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet-mapping&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-name&gt;</span>DemoServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;url-pattern&gt;</span>/ping<span class="nt">&lt;/url-pattern&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/servlet-mapping&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/web-app&gt;</span>
</span></span></code></pre></div><p>Ëøô‰∏ÄÊ≠•Â∞±ÊòØÈÖçÁΩÆÊò†Â∞ÑËßÑÂàôÔºåËÆ©Á¨¶ÂêàËßÑÂàôÁöÑËØ∑Ê±ÇË¢´ÊåáÂÆöÁöÑservletÂ§ÑÁêÜ„ÄÇ</p>
</li>
</ul>
</li>
<li>
<p><strong>ÈÄöËøábinÁõÆÂΩï‰∏ãÁöÑËÑöÊú¨ÂêØÂä®Tomcat</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chmod -R +x ./bin
</span></span><span class="line"><span class="cl">./bin/startup.sh
</span></span></code></pre></div></li>
<li>
<p><strong>ÊµèËßàÂô®ËÆøÈóÆhttp://localhost:8080/my-app/ping</strong></p>
</li>
</ol>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240130101103677.png"
	width="1224"
	height="298"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240130101103677_hu7c1340e8489d2ab0356109a8c4e59784_25768_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240130101103677_hu7c1340e8489d2ab0356109a8c4e59784_25768_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240130101103677"
	
	
		class="gallery-image" 
		data-flex-grow="410"
		data-flex-basis="985px"
	
></p>
<p>ÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨Âè™Ë¶ÅÊääËá™Â∑±ÂÜôÁöÑServlet ÊåâÁÖßtomcat ÁöÑËßÑÂàôÊîæÂà∞ÊåáÂÆöÁõÆÂΩï‰∏ãÔºåÁÑ∂ÂêéËøêË°åtomcat Êàë‰ª¨ÂÜôÁöÑServletÂ∞±ÂèØ‰ª•Â§ÑÁêÜËØ∑Ê±ÇÔºå‰∏ãÈù¢Ëß£Èáä‰∏ãÊàëÂàöÂàöÂàõÂª∫ÁöÑÁõÆÂΩïÁªìÊûÑÁöÑ‰ΩúÁî®„ÄÇ</p>
<ul>
<li>
<p><code>classes</code> Ëøô‰∏™ÁõÆÂΩïÂ≠òÊîæÊàë‰ª¨Ëá™Â∑±ÂÜôÁöÑServletÁºñËØëÂêéÁöÑÂ≠óËäÇÁ†ÅÊñá‰ª∂</p>
<blockquote>
<p>‰ªÄ‰πàÊòØÂ≠óËäÇÁ†ÅÊñá‰ª∂ÔºüÈáåÈù¢Â≠òÁöÑÊòØ‰ªÄ‰πàÔºüÈïø‰ªÄ‰πàÊ†∑Â≠êÔºü</p>
</blockquote>
</li>
<li>
<p><code>lib</code> Â≠òÊîæÊàë‰ª¨ÈúÄË¶ÅÁî®Âà∞ÁöÑ‰æùËµñÔºåÂõ†‰∏∫ÊàëÊòØÁî®kotlinÁºñÂÜôÁöÑÔºåÊâÄ‰ª•ÈúÄË¶ÅÁî®Âà∞Áõ∏ÂÖ≥‰æùËµñ</p>
</li>
<li>
<p><code>web.xml</code> Â≠òÊîæTomcatÁõ∏ÂÖ≥ÈÖçÁΩÆÔºå‰∏äÈù¢Êàë‰ª¨Âè™ÂëäËØâ‰∫Ütomcat ÊääURI‰∏∫<code>/ping</code> ÁöÑËØ∑Ê±Ç‰∫§Áªô DemoServletÂ§ÑÁêÜ</p>
</li>
</ul>
<p>Ëá≥Ê≠§Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞tomcat Ëá≥Â∞ëÂÅö‰∫ÜÂ¶Ç‰∏ãÁöÑ‰∫ãÔºö</p>
<ul>
<li>ÁõëÂê¨ÁΩëÁªúÁ´ØÂè£</li>
<li>Êé•ÂèóÁΩëÁªúËØ∑Ê±Ç</li>
<li>ËØªÂèñÁΩëÁªúÊï∞ÊçÆ</li>
<li>Ê†πÊçÆHTTP ÂçèËÆÆËß£ÊûêÊï∞ÊçÆ</li>
<li>Âä†ËΩΩclass Êñá‰ª∂Âèäjar Êñá‰ª∂</li>
<li>Ë∞ÉÁî®DemoServletÁöÑdoGet ÊñπÊ≥ï</li>
<li>Â∞ÜÂìçÂ∫îÁöÑÂ≠óËäÇÊµÅÂÜôÂõûÁªôÊµèËßàÂô®</li>
</ul>
<p>Ë¶ÅÂÅöËøô‰∫õ‰∫ãËÇØÂÆö‰∏ç‰ºöÂÉèÊàë‰ª¨demoÁâà‰ª£Á†Å‰∏≠ÈÇ£‰πàÁÆÄÂçïÔºåËÇØÂÆöÁªèËøáËÆæËÆ°ÁöÑÔºå‰ΩÜÊòØÊó†ËÆ∫ÊÄé‰πàËÆæËÆ°ÔºåÊØè‰∏™Êé•Âè£ÂíåÊ®°ÂùóÈÉΩÊúâÂÆÉËá™Â∑±ÁöÑËÅåË¥£ÂíåË¶ÅÂ§ÑÁêÜÁöÑ‰∫ãÊÉÖÔºå‰∏ãÈù¢ÂÖàÁúãÁúãtomcat ÁöÑÊï¥‰ΩìÊû∂ÊûÑ„ÄÇ</p>
<h2 id="tomcatÊû∂ÊûÑ">TomcatÊû∂ÊûÑ</h2>
<p>TomcatÊï¥‰ΩìÊû∂ÊûÑÊòØ‰∏ÄÁßçÂàÜÂ±ÇÁöÑÁªìÊûÑÔºåÊàë‰ª¨ÂÖàÁúã‰∏Ä‰∏™ÁªìËÆ∫Âõæ(Êù•Ê∫ê‰∫éÁΩëÁªú)Ôºå ÂêéÈù¢ÊàëÂú®ÂàÜÊûêÊ∫êÁ†ÅÁöÑÊó∂ÂÄô‰ºöÈÄêÊ∏êÊääÊ∫êÁ†ÅÂíåËøô‰∏™ÂõæÂØπÂ∫îËµ∑Êù•„ÄÇ</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/1775037-20200701215156409-51289451.png"
	width="1000"
	height="967"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/1775037-20200701215156409-51289451_huda31b2cae9d94bf59e6c1cb8d4e760b9_510228_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/1775037-20200701215156409-51289451_huda31b2cae9d94bf59e6c1cb8d4e760b9_510228_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="TomcatÊû∂ÊûÑÔºåÊù•Ê∫ê‰∫éÁΩëÁªúÔºå‰æµÂà†"
	
	
		class="gallery-image" 
		data-flex-grow="103"
		data-flex-basis="248px"
	
></p>
<p>Âú®ËøôÂ∞èËäÇÊàë‰ª¨ÂèØ‰ª•ÂÖàÂè™ÂÖ≥Ê≥®<code>Server</code>„ÄÅ <code>Service</code>„ÄÅ<code>Connector</code>„ÄÅ<code>Engine</code>„ÄÅ<code>Host</code>„ÄÅ<code>Context</code>„ÄÅ<code>Wrapper</code>Ôºå ËÆ∞‰ΩèËøôÂá†‰∏™ÁªÑ‰ª∂ÂêçÂ≠óÂèä‰ªñ‰ª¨ÁöÑÂ±ÇÁ∫ßÂÖ≥Á≥ª,  ÂÖ∂‰∏≠Èô§ConnectorÊ≤°ÊúâÊäΩË±°Âá∫Êé•Âè£Â§ñÔºåÂÖ∂‰Ωô‰πüÈÉΩÂØπÂ∫î‰∫Ütomcat‰∏≠Âá†‰∏™È°∂Á∫ßÊé•Âè£ÂêçÂ≠ó(‰æãÂ¶Ç<code>org.apache.catalina.Server</code>), ËÄå<code>StandardXXX</code> ÊòØËøô‰∫õÊé•Âè£ÁöÑÂÆûÁé∞„ÄÇ</p>
<p>Ê≥®ÊÑèÔºö<strong>‰∏ãÊñáË¥¥Âá∫ÁöÑÊ∫ê‰ª£Á†ÅÈÉ®ÂàÜÈÉΩÊòØÁ≤æÁÆÄËøáÂêéÁöÑÂÖ≥ÈîÆ‰ª£Á†Å„ÄÅ‰∏™‰∫∫ËÆ§‰∏∫ÊòØ‰Ωú‰∏∫ÁêÜËß£tomcatÁöÑÂøÖËØªÈÉ®ÂàÜ</strong>„ÄÇËøáÂÆåÂøÖËØªÈÉ®ÂàÜÂêéÔºåËã•ËÉΩ‰∏ãËΩΩÂÖ®ÈÉ®Ê∫êÁ†ÅÈÄöËøádebugÊù•‰∫ÜËß£Êõ¥Â§öÁªÜËäÇÂàôÊõ¥‰Ω≥ÔºåÂÖ≥‰∫éÂ¶Ç‰ΩïÂú®Êú¨Âú∞ÁºñËØëÂπ∂ÂêØÂä®tomcatÊ∫êÁ†ÅÂèØ‰ª•ÂèÇËÄÉÊàëÁöÑÂè¶‰∏ÄÁØáÔºö<a class="link" href="https://woaihuangfan.github.io/posts/%E7%94%A8idea%E6%9C%AC%E5%9C%B0%E7%BC%96%E8%AF%91%E5%90%AF%E5%8A%A8tomcat%E6%BA%90%E7%A0%81/"  target="_blank" rel="noopener"
    >Â¶Ç‰ΩïÁî®IDEAÊú¨Âú∞ÁºñËØëÂêØÂä®tomcat</a></p>
<ul>
<li><strong>StandardServer</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardServer</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">LifecycleMBeanBase</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">Catalina</span><span class="w"> </span><span class="n">catalina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * The set of Services associated with this Server.
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">services</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Service</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addService</span><span class="p">(</span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">servicesLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Service</span><span class="w"> </span><span class="n">results</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Service</span><span class="o">[</span><span class="n">services</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Â∞Üservices ‰∏≠ÁöÑÂÄºÊã∑Ë¥ùÂà∞results</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">services</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">services</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">results</span><span class="o">[</span><span class="n">services</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addConnector</span><span class="p">(</span><span class="n">Connector</span><span class="w"> </span><span class="n">connector</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">connectorsLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">connector</span><span class="p">.</span><span class="na">setService</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Connector</span><span class="w"> </span><span class="n">results</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Connector</span><span class="o">[</span><span class="n">connectors</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">connectors</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">connectors</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">results</span><span class="o">[</span><span class="n">connectors</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connector</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">connectors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCatalina</span><span class="p">(</span><span class="n">Catalina</span><span class="w"> </span><span class="n">catalina</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">catalina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">catalina</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><ul>
<li><strong>StandardService</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">LifecycleMBeanBase</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The &lt;code&gt;Server&lt;/code&gt; that owns this Service, if any.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The set of Connectors associated with this Service.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">Connector</span><span class="w"> </span><span class="n">connectors</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Connector</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setContainer</span><span class="p">(</span><span class="n">Engine</span><span class="w"> </span><span class="n">engine</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engine</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">engine</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">engine</span><span class="p">.</span><span class="na">setService</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setServer</span><span class="p">(</span><span class="n">Server</span><span class="w"> </span><span class="n">server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addConnector</span><span class="p">(</span><span class="n">Connector</span><span class="w"> </span><span class="n">connector</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">connectorsLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">connector</span><span class="p">.</span><span class="na">setService</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Connector</span><span class="w"> </span><span class="n">results</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Connector</span><span class="o">[</span><span class="n">connectors</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">connectors</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">connectors</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">results</span><span class="o">[</span><span class="n">connectors</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connector</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">connectors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span></code></pre></div><ul>
<li><strong>StandardEngine</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardEngine</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ContainerBase</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The &lt;code&gt;Service&lt;/code&gt; that owns this Engine, if any.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addChild</span><span class="p">(</span><span class="n">Container</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// EngineÁöÑChild ÂøÖÈ°ªÊòØHost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">child</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Host</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;standardEngine.notHost&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ë∞ÉÁî®Áà∂Á±ªContainerBase‰∏≠ÁöÑÂÆûÁé∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span></code></pre></div><ul>
<li>StandardHost</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardHost</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ContainerBase</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addChild</span><span class="p">(</span><span class="n">Container</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// HostÁöÑChildÂøÖÈ°ªÊòØContext</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">child</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Context</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;standardHost.notContext&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ë∞ÉÁî®Áà∂Á±ªContainerBase‰∏≠ÁöÑÂÆûÁé∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span></code></pre></div><ul>
<li><strong>StandardContext</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardContext</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ContainerBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">implements</span><span class="w"> </span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">NotificationEmitter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addChild</span><span class="p">(</span><span class="n">Container</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Global JspServlet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Wrapper</span><span class="w"> </span><span class="n">oldJspServlet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">child</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Wrapper</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;standardContext.notWrapper&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ë∞ÉÁî®Áà∂Á±ªContainerBase‰∏≠ÁöÑÂÆûÁé∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span></code></pre></div><ul>
<li><strong>StandardWrapper</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardWrapper</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ContainerBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">implements</span><span class="w"> </span><span class="n">ServletConfig</span><span class="p">,</span><span class="w"> </span><span class="n">Wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">NotificationEmitter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * Refuse to add a child Container, because Wrappers are the lowest level
</span></span></span><span class="line"><span class="cl"><span class="cm">   * of the Container hierarchy.
</span></span></span><span class="line"><span class="cl"><span class="cm">   *
</span></span></span><span class="line"><span class="cl"><span class="cm">   * @param child Child container to be added
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addChild</span><span class="p">(</span><span class="n">Container</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		  </span><span class="c1">// StandardWrapperÊòØÂ±ÇÁ∫ßÁöÑÊúÄÂ∫ïÂ±ÇÔºåÊãíÁªùÊ∑ªÂä†child</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;standardWrapper.notChild&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞StandardEngineÔºåStandardHostÔºåStandardContext, StandardWrapperÈÉΩÁªßÊâø‰∫ÜContainerBase‰∏îÈÉΩÂÆûÁé∞‰∫Ü<code>Container</code> Êé•Âè£Ôºå‰ªñ‰ª¨addChild ÁöÑÊó∂ÂÄôÈÉΩË∞ÉÁî®‰∫ÜÁà∂Á±ªÊñπÊ≥ïÔºåchild Áª¥Êä§Âú®Áà∂Á±ªÁöÑchildrenÂ±ûÊÄß‰∏≠.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ContainerBase</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">LifecycleMBeanBase</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Container</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">    * The parent Container to which this Container is a child.
</span></span></span><span class="line"><span class="cl"><span class="cm">    */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">protected</span><span class="w"> </span><span class="n">Container</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">protected</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Container</span><span class="o">&gt;</span><span class="w"> </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addChild</span><span class="p">(</span><span class="n">Container</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">addChildInternal</span><span class="p">(</span><span class="n">child</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addChildInternal</span><span class="p">(</span><span class="n">Container</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">children</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="na">getName</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;containerBase.child.notUnique&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="p">.</span><span class="na">getName</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">child</span><span class="p">.</span><span class="na">setParent</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">  </span><span class="c1">// May throw IAE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">children</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">child</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ÁúãÂÆå‰ª•‰∏äÂá†‰∏™Á±ªÁöÑÈÉ®ÂàÜÊ†∏ÂøÉ‰ª£Á†ÅÂ∞±‰ºöÁêÜËß£ËøôÁßçÂÉèÂ•óÂ®É‰∏ÄÊ†∑ÁöÑÂàÜÂ±ÇËÆæËÆ°„ÄÇ</p>
<p>‰æùÊ¨°ÂæÄ‰∏ãÔºå‰∏Ä‰∏™Server ÂåÖÂê´‰∏Ä‰∏™ÊàñÂ§ö‰∏™Service, ‰∏Ä‰∏™ServiceÂåÖÂê´‰∏Ä‰∏™EngineÂíå‰∏Ä‰∏™ÊàñÂ§ö‰∏™connectorÔºå‰∏Ä‰∏™Engine ÂèØ‰ª•ÂåÖÂê´Â§ö‰∏™Host, ‰∏Ä‰∏™Host ÂèØ‰ª•ÂåÖÂê´‰∏Ä‰∏™ÊàñÂ§ö‰∏™Context, ‰∏Ä‰∏™Context ÂèØ‰ª•ÂåÖÂê´Â§ö‰∏™Wrapper, ‰ªéEngineÂºÄÂßãÈÉΩÂÆûÁé∞‰∫Ü<code>Container</code> Êé•Âè£„ÄÇ</p>
<p><strong>ÂåñÊäΩË±°‰∏∫ÂÖ∑‰Ωì</strong></p>
<p>Áé∞Âú®Server, service, engine Á≠âÊàë‰ª¨‰ªéÊäÄÊúØËßíÂ∫¶ÁêÜËß£‰∫Ü‰ªñ‰ª¨ÊòØ‰∏Ä‰∏™‰∏™ÁöÑÊé•Âè£ÔºåÊàñËÄÖËØ¥ÊäÄÊúØÁªÑ‰ª∂Ôºå‰æùÊóßÊòØ‰∏ÄÁßçÊäΩË±°ÁöÑÊ¶ÇÂøµÔºåÈÇ£Â¶Ç‰Ωï‰ªé‰∏öÂä°ËßíÂ∫¶ÁêÜËß£‰ªñ‰ª¨ÊòØÂπ≤‰ªÄ‰πàÁöÑÔºü</p>
<ul>
<li>ServerÂèØ‰ª•ÁêÜËß£‰∏∫‰∏Ä‰∏™tomcat server ÂÆû‰æã;</li>
<li>ServiceÂ∞Ü‰∏Ä‰∏™ÊàñÂ§ö‰∏™ËøûÊé•Âô®‰∏é‰∏Ä‰∏™EngineÁõ∏ÂÖ≥ËÅî;</li>
<li>Engine Áî®Êù•ÁÆ°ÁêÜÂ§ö‰∏™ËôöÊãü‰∏ªÊú∫Ôºõ</li>
<li>Host ‰ª£Ë°®ÁöÑÊòØ‰∏Ä‰∏™ËôöÊãü‰∏ªÊú∫ÔºåÂèØ‰ª•Áªô Tomcat ÈÖçÁΩÆÂ§ö‰∏™ËôöÊãü‰∏ªÊú∫Âú∞ÂùÄÔºõ</li>
<li>Context Ë°®Á§∫‰∏Ä‰∏™ Web Â∫îÁî®Á®ãÂ∫èÔºåËÄå‰∏Ä‰∏™ËôöÊãü‰∏ªÊú∫‰∏ãÂèØ‰ª•ÈÉ®ÁΩ≤Â§ö‰∏™ Web Â∫îÁî®Á®ãÂ∫è;</li>
<li>Wrapper Ë°®Á§∫‰∏Ä‰∏™ Servlet, ‰∏Ä‰∏™ Web Â∫îÁî®Á®ãÂ∫è‰∏≠ÂèØËÉΩ‰ºöÊúâÂ§ö‰∏™ ServletÔºõ</li>
</ul>
<p>Âπ∂‰∏îÂèØ‰ª•ÂèëÁé∞Ôºå</p>
<ol>
<li>
<p>Âú®Ëøô‰∏™Â±ÇÁ∫ßÁªìÊûÑ‰∏≠ÔºåÂ≠êËäÇÁÇπ‰∏≠‰πüÁª¥Êä§‰∫ÜÁà∂ËäÇÁÇπÔºåÂΩ¢Êàê‰∫ÜÂèåÂêëÈìæË°®ÂíåÂØπË±°Ê†ë„ÄÇ</p>
</li>
<li>
<p>ÊØè‰∏ÄÂ±ÇÁöÑÁªÑ‰ª∂ÈÉΩÂÆûÁé∞‰∫Ü<code>Lifecycle</code>Êé•Âè£„ÄÇ</p>
</li>
</ol>
<p>ÂÜçÁúãÁúãTomcat ÈÖçÁΩÆÊñá‰ª∂ÂèØ‰ª•Â∏ÆÂä©Êàë‰ª¨Êõ¥Â•ΩÁöÑÊù•ÁêÜËß£Ëøô‰∏™Â±ÇÊ¨°ÂÖ≥Á≥ª„ÄÇ‰ª•‰∏ãÈÖçÁΩÆÊñá‰ª∂ËäÇÈÄâËá™ÈªòËÆ§ÁöÑ<code>conf/server.xml</code>Êñá‰ª∂„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;Server</span> <span class="na">port=</span><span class="s">&#34;8005&#34;</span> <span class="na">shutdown=</span><span class="s">&#34;SHUTDOWN&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Service</span> <span class="na">name=</span><span class="s">&#34;Catalina&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">&#34;8080&#34;</span> <span class="na">protocol=</span><span class="s">&#34;HTTP/1.1&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">connectionTimeout=</span><span class="s">&#34;20000&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">redirectPort=</span><span class="s">&#34;8443&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Engine</span> <span class="na">name=</span><span class="s">&#34;Catalina&#34;</span> <span class="na">defaultHost=</span><span class="s">&#34;localhost&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;Host</span> <span class="na">name=</span><span class="s">&#34;localhost&#34;</span>  <span class="na">appBase=</span><span class="s">&#34;webapps&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">unpackWARs=</span><span class="s">&#34;true&#34;</span> <span class="na">autoDeploy=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/Host&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Engine&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Service&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Server&gt;</span>
</span></span></code></pre></div><p>ÂêåÊó∂ÂºïÂÖ•‰∏§‰∏™ÈóÆÈ¢òÔºå</p>
<ul>
<li>Ëøô‰∏™ÂØπË±°Ê†ëÁöÑÊ†πËäÇÁÇπÊòØ‰ªÄ‰πàÔºü‰∏äÈù¢ÁöÑÊØè‰∏™ÂØπË±°ÊòØÊÄé‰πàÂÆû‰æãÂåñÁöÑÔºü</li>
<li>‰∏∫‰ªÄ‰πàÈÉΩÂÆûÁé∞‰∫Ü<code>Lifecycle</code>Êé•Âè£Ôºü</li>
</ul>
<p>Ë¶ÅÂõûÁ≠îËøô‰∏™ÈóÆÈ¢òÊàë‰ª¨ÂèØ‰ª•ÂÖàÊù•‰∫ÜËß£‰∏ãTomcat ÁöÑÂêØÂä®ËøáÁ®ã„ÄÇ</p>
<h3 id="tomcat-ÁöÑÂêØÂä®ËøáÁ®ã">Tomcat ÁöÑÂêØÂä®ËøáÁ®ã</h3>
<p>![tomcat ÂêØÂä®ËøáÁ®ã](images/tomcat ÂêØÂä®ËøáÁ®ã.png)</p>
<p>‰∏äÂõæÂ∞±ÊòØtomcat ÂêØÂä®ÁöÑËøáÁ®ãÔºå<code>Bootstrap</code> ‰∏∫tomcat ÁöÑÂêØÂä®Á±ªÔºåÂàÜ‰∏∫init, load, start Â§ßÁöÑ‰∏âÊ≠•ÔºåÁÑ∂ÂêéÂèàÂàÜÂà´Ë∞ÉÁî®Catalina ÂØπÂ∫îÁöÑload Âíåstart ÊñπÊ≥ïÔºåÂú®ÂêØÂä®ËøáÁ®ã‰∏≠ÈÄêÊ≠•ÂÆû‰æãÂåñÂêÑ‰∏™ÁªÑ‰ª∂Âπ∂ÊûÑÂª∫‰ª•Catalina‰∏∫Ê†πËäÇÁÇπÁöÑÂØπË±°Ê†ë„ÄÇ</p>
<p>ÂêåÊó∂Êàë‰ª¨ÂèëÁé∞ÂêØÂä®ËøáÁ®ã‰∏≠&quot;init&quot;,&ldquo;start&rdquo; ËøôÁ±ªÊñπÊ≥ïÈöèÂ§ÑÂèØËßÅÔºåËøô‰∏çÈöæÁêÜËß£Â±ÇÊ¨°Êû∂ÊûÑ‰∏≠ÊØè‰∏™ÁªÑ‰ª∂ÈÉΩÊúâËá™Â∑±ÁöÑÁîüÂëΩÂë®ÊúüÔºåÂõ†Ê≠§‰ªñ‰ª¨ÈÉΩÂÆûÁé∞‰∫ÜLifeCycle Êé•Âè£ÔºåÈÄöËøáËøô‰∏™Êé•Âè£Êù•ÁÆ°ÁêÜÊâÄÊúâÁªÑ‰ª∂ÁöÑÁîüÂëΩÂë®Êúü„ÄÇÂêåÊó∂ÔºåÁî±‰∫éÊ†ëÂΩ¢ÁªìÊûÑÁöÑÂ≠òÂú®ÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÂÅöÂà∞‰∏ÄÈîÆÂêØÂÅúÔºåÊØîÂ¶Çserver ÁöÑstart ÊñπÊ≥ï‰ºöË∞ÉÁî®Â≠êËäÇÁÇπÁöÑÊñπÊ≥ï„ÄÇ</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240223104628734.png"
	width="772"
	height="740"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240223104628734_hu118df191dceeedf93298eacd573438fb_82279_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240223104628734_hu118df191dceeedf93298eacd573438fb_82279_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240223104628734"
	
	
		class="gallery-image" 
		data-flex-grow="104"
		data-flex-basis="250px"
	
></p>
<p>ÂêåÊó∂ÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Lifecycle‰∏≠ËøòÊûö‰∏æ‰∫ÜLifecycleStateÔºåÂêÑ‰∏™ÁªÑ‰ª∂Âú®ÁîüÂëΩÂë®Êúü‰∏≠ÁöÑÊØè‰∏Ä‰∏™Èò∂ÊÆµÈÉΩÊúâ‰∏Ä‰∏™ÂØπÂ∫îÁöÑÁä∂ÊÄÅÂíå‰∫ã‰ª∂ÔºåÂêåÊó∂ËøòÊúâÁª¥Êä§ÁöÑLifecycleListenerÔºåÈÄöËøá‰∫ã‰ª∂ÁõëÂê¨ÁöÑÊú∫Âà∂ÂèØ‰ª•ÂæàÊñπ‰æøÊâ©Â±ïÂêÑ‰∏™ÁªÑ‰ª∂Áé∞ÊúâÁöÑÁîüÂëΩÂë®ÊúüÊñπÊ≥ï„ÄÇ</p>
<p><strong>Â∏∏ËßÅÁöÑLifeCycleListener</strong></p>
<ul>
<li>EngineConfig</li>
<li>HostConfig</li>
<li>ContextConfig</li>
<li>&hellip;</li>
</ul>
<p><strong>Tomcat‰ºóÂ§öÁªÑ‰ª∂‰∏≠Êúâ‰∏§‰∏™Ê†∏ÂøÉÁªÑ‰ª∂ÔºöËøûÊé•Âô®(<code>Connector</code>) ÂíåÂÆπÂô®(<code>Container</code>).</strong></p>
<p><code>Conntector</code> Áª¥Êä§Âú®Service ÂÆû‰æã‰∏≠ÔºåÂÆÉÁöÑ‰∏ªË¶ÅÂäüËÉΩÂ∞±ÊòØË¥üË¥£ÂØπÂ§ñ‰∫§ÊµÅÔºåÂåÖÊã¨ÁõëÂê¨Á´ØÂè£ÔºåÊé•Êî∂ËØ∑Ê±ÇÔºåËØªÂèñÂπ∂Ëß£ÊûêËØ∑Ê±ÇÊï∞ÊçÆÔºåÁÑ∂Âêé‰∫§ÁªôServlet Â§ÑÁêÜÔºåÂπ∂Â∞ÜÂìçÂ∫îÂÜôÂõûÁªôÂÆ¢Êà∑Á´Ø„ÄÇ</p>
<p><code>Container</code> ÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™ÊØîËæÉ‰∏öÂä°ÂåñÁöÑÊèèËø∞ÔºåÊàë‰ª¨Â∏∏Âê¨Âà∞&quot;SpringÂÆπÂô®&quot;Ôºå&ldquo;ServletÂÆπÂô®&rdquo;ÔºåÈÇ£Âà∞Â∫ï‰ªÄ‰πàÊòØÂÆπÂô®ÔºüÂÆπÂô®ÊòØÁî®Êù•Ë£Ö‰∏úË•øÁöÑÔºå‰∏Ä‰∏™Ê∞¥ÊùØ‰πüÊòØÂÆπÂô®ÔºåË£ÖÁöÑÊòØÊ∞¥„ÄÇÈÇ£Êàë‰ª¨tomcatÈáåËØ¥ÁöÑÂÆπÂô®‰∏ªË¶ÅÁõÆÁöÑÊòØ‰∏∫‰∫ÜË£ÖServlet, Ëøô‰πüÊòØÂÆÉÁöÑÊ†∏ÂøÉÂäüËÉΩ‰πã‰∏Ä ‚Äî‚Äî Âä†ËΩΩÂπ∂ÁÆ°ÁêÜ <code>Servlet</code> „ÄÇÊàë‰ª¨‰∏äÈù¢ÁúãÊû∂ÊûÑÁöÑÊó∂ÂÄôÂèØ‰ª•ÂèëÁé∞EngineÔºåHost , Context, Wrapper ÈÉΩÂÆûÁé∞‰∫ÜContainer Êé•Âè£ÔºåÂõ†Ê≠§‰ªñ‰ª¨ÈÉΩÂèØ‰ª•ÁêÜËß£‰∏∫ÂÆπÂô®ÔºåÂè™‰∏çËøáÊòØ‰∏ÄÁßçÂ•óÂ®ÉÂºèËÆæËÆ°„ÄÇ</p>
<blockquote>
<p>‰ΩÜÊòØÊàë‰ª¨ÊúâÊó∂ÂÄô‰πüÁúãÂà∞ËØ¥&quot;Catalina ÊòØtomcat ÁöÑservlet ÂÆπÂô®&quot;, ËøôÁßçËØ¥Ê≥ïÊ≠£Á°ÆÂêóÔºü ÂÖ∂ÂÆû‰πüÊ≠£Á°ÆÔºåÂõ†‰∏∫catalina ‰Ωú‰∏∫ÂØπË±°Ê†ëÁöÑÊ†πËäÇÁÇπÁÆ°ÁêÜÁùÄÊï¥‰∏™‰∏ãÂ±ÇÂÆπÂô®ÔºåÊâÄ‰ª•ÂæÄÂ§ß‰∫ÜÊàë‰ª¨‰πüÂèØ‰ª•ËØ¥CatalinaÊòØÂÆπÂô®ÔºåÂæÄÂ∞è‰∫ÜËØ¥Â∞±Âè™ÊúâÂÆûÁé∞‰∫ÜContainerÊé•Âè£ÁöÑÁªÑ‰ª∂ÊâçÊòØ&quot;ÂÆπÂô®&quot;ÔºåÂÆπÂô®Âè™ÊòØ‰∏ÄÁßçÂ§ßÂÆ∂Â∏∏Áî®ÁöÑÁî®Êù•ÊØîÊãüÁöÑËØçÔºåÊõ¥ÈáçË¶ÅÁöÑÊòØÊòéÁôΩÂÆÉËÉåÂêéÊÉ≥Ë°®ËææÁöÑÊòØ‰ªÄ‰πà„ÄÇ</p>
</blockquote>
<h2 id="ËØ∑Ê±ÇÊé•Êî∂ÂíåÂ§ÑÁêÜ">ËØ∑Ê±ÇÊé•Êî∂ÂíåÂ§ÑÁêÜ</h2>
<p>ConnectorÁöÑËÅåË¥£ÂèàÂèØ‰ª•ÁªÜÂàÜ‰∏∫‰∏§ÈÉ®ÂàÜÔºöÁΩëÁªúÈÄö‰ø°(EndPoint), Ê†πÊçÆÂ∫îÁî®Â±ÇÂçèËÆÆËß£ÊûêËØ∑Ê±ÇÊï∞ÊçÆ(Processor), Â∞ÅË£ÖServletRequest‰∫§ÁªôServlet Â§ÑÁêÜ(Adaptor)„ÄÇ</p>
<blockquote>
<p>Êàë‰ª¨Âú®ÂâçÈù¢demoÈªòËÆ§ÁöÑÂ∫îÁî®Â±ÇÂçèËÆÆÊòØHTTP/1.1 ÔºåÂÖ∂ÂÆûtomcat ËøòÊîØÊåÅAJP, HTTP/2</p>
</blockquote>
<h3 id="connectorÁöÑÂàõÂª∫">ConnectorÁöÑÂàõÂª∫</h3>
<p>Âú®<code>server.xml</code> ‰∏≠ÊúâÂ¶Ç‰∏ãÈÖçÁΩÆÔºåÂΩìDigisterËß£ÊûêxmlÊñá‰ª∂ÂèëÁé∞Ëøô‰∏™ÈÖçÁΩÆÊó∂Â∞±‰ºöÂéªÂÆû‰æãÂåñConnector.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"> <span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">&#34;8080&#34;</span> <span class="na">protocol=</span><span class="s">&#34;HTTP/1.1&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">connectionTimeout=</span><span class="s">&#34;20000&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">redirectPort=</span><span class="s">&#34;8443&#34;</span> <span class="nt">/&gt;</span>
</span></span></code></pre></div><p>ËÄåÂÆû‰æãÂåñÁöÑÊìç‰ΩúÊòØÂú®ÂºÄÂßãËß£Êûêxml‰πãÂâçÁªôDigisterÊ∑ªÂä†‰∫ÜÂØπÂ∫îÁöÑRuleÂÜ≥ÂÆöÁöÑ„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Âú®ÂºÄÂßãËß£ÊûêxmlÊñá‰ª∂‰πãÂâç‰ºöÁªôDigisterÊ∑ªÂä†‰∏Ä‰∏™RuleÊù•ÂëäËØâDigisterÈÅáÂà∞&lt;Connector&gt;Ê†áÁ≠æÊó∂ÁöÑÂ§ÑÁêÜÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">digester</span><span class="p">.</span><span class="na">addRule</span><span class="p">(</span><span class="s">&#34;Server/Service/Connector&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">ConnectorCreateRule</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></div><p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206143632546.png"
	width="2302"
	height="1212"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206143632546_hu027ec3b996561359d184cefe463055f5_381110_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206143632546_hu027ec3b996561359d184cefe463055f5_381110_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="h"
	
	
		class="gallery-image" 
		data-flex-grow="189"
		data-flex-basis="455px"
	
></p>
<p>ÁÑ∂ÂêéÂú®ÂÆû‰æãÂåñConnectorÁöÑÊó∂ÂÄô‰ºöÊ†πÊçÆÊàë‰ª¨ÈÖçÁΩÆÁöÑÂçèËÆÆÂàõÂª∫<code>ProtocolHandler</code>,  ÂÆÉÊòØConnector‰∏≠ÂæàÈáçË¶ÅÁöÑ‰∏Ä‰∏™ÁªÑ‰ª∂Ôºå‰∏ãÈù¢‰ºöÊèêÂà∞„ÄÇ</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206143921781.png"
	width="2552"
	height="1052"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206143921781_hu5ff1a2667acb02c665d7c7252cc1f2eb_264557_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206143921781_hu5ff1a2667acb02c665d7c7252cc1f2eb_264557_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240206143921781"
	
	
		class="gallery-image" 
		data-flex-grow="242"
		data-flex-basis="582px"
	
></p>
<p>ËÄåÈíàÂØπ<code>HTTP/1.1</code> ‰ºöÂàõÂª∫<code>Http11NioProtocol</code></p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206144411379.png"
	width="2240"
	height="1318"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206144411379_hu8ea8f2ab531821870351b2cac25448a9_388875_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240206144411379_hu8ea8f2ab531821870351b2cac25448a9_388875_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240206144411379"
	
	
		class="gallery-image" 
		data-flex-grow="169"
		data-flex-basis="407px"
	
></p>
<p>ÂÜçÊù•ÁúãÁúãËøô‰∏™Http11NioProtocolÔºå</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/20200407174647.png"
	width="1438"
	height="856"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/20200407174647_hua4d1234e1ee57c0f613448715feabe27_168769_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/20200407174647_hua4d1234e1ee57c0f613448715feabe27_168769_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Â∫îÁî®Â±ÇÂçèËÆÆÊäΩË±°"
	
	
		class="gallery-image" 
		data-flex-grow="167"
		data-flex-basis="403px"
	
></p>
<p>Âú®ÂàõÂª∫Http11NioProtocolÁöÑÊó∂ÂÄô‰ºö‰º†ÂÖ•‰∏Ä‰∏™NioEndpoint ‰Ωú‰∏∫ÊûÑÈÄ†ÂáΩÊï∞ÁöÑÂèÇÊï∞Ôºå</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="nf">Http11NioProtocol</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">NioEndpoint</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ËÄåEndPointÁª¥Êä§Âú®<code>AbstractProtocol</code>‰∏≠Ôºå</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbstractProtocol</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ProtocolHandler</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">MBeanRegistration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Endpoint that provides low-level network I/O - must be matched to the
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ProtocolHandler implementation (ProtocolHandler using NIO, requires NIO
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Endpoint etc.).
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AbstractEndpoint</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span><span class="o">?&gt;</span><span class="w"> </span><span class="n">endpoint</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Connector ÂàõÂª∫ÂÆåÂêé‰ºöË∞ÉÁî®service#addConnector ÊääÂÆÉÁªëÂÆöÂà∞service, Ëá≥Ê≠§Êàë‰ª¨ÁöÑÁü•ÈÅì‰∫ÜÔºö</p>
<ol>
<li>Connector ÊòØÂú®Ëß£Êûêxml Êó∂Ê†πÊçÆ‰∫ãÂÖàÊåáÂÆöÁöÑRuleÂàõÂª∫</li>
<li>Connector ÂåÖÂê´ProtocolHandler, Âú®ÂÆû‰æãÂåñConnectorÊó∂‰ºöÊ†πÊçÆxml ÈÖçÁΩÆÊù•ÂàõÂª∫ProtocolHandler, HTTP/1.1 ‰ºöÂàõÂª∫Http11NioProtocol</li>
<li>ProtocolHandler‰∏≠Áª¥Êä§ÁùÄEndPoint ÁªÑ‰ª∂ÔºåHttp11NioProtocolÈªòËÆ§ÂàõÂª∫NioEndpoint</li>
</ol>
<h3 id="ÁõëÂê¨ÁΩëÁªúÁ´ØÂè£ÂíåÊé•Êî∂ËøûÊé•ËØ∑Ê±Ç">ÁõëÂê¨ÁΩëÁªúÁ´ØÂè£ÂíåÊé•Êî∂ËøûÊé•ËØ∑Ê±Ç</h3>
<h4 id="acceptor">Acceptor</h4>
<p>Acceptor ÂÆûÁé∞‰∫ÜRunnable Êé•Âè£ÔºåÊòØÁª¥Êä§Âú®AbstractEndpointÂÜÖÈÉ®ÁöÑ‰∏Ä‰∏™fieldËøô‰∏™Á±ªÂæàÁÆÄÂçïÔºå‰∏ªË¶ÅÈÄªËæëÂ∞±ÊòØÂú®runÊñπÊ≥ï‰∏≠Ë∞ÉÁî®<code>endpoint.serverSocketAccept()</code>‰ª•Âèä<code>endpoint.setSocketOptions(socket)</code>Êù•ÁõëÂê¨Á´ØÂè£ÂíåÊé•Êî∂ËØ∑Ê±Ç„ÄÇ</p>
<blockquote>
<p><strong>ÂÜ∑Áü•ËØÜÔºöfield Âíåproperty ÁöÑÂå∫Âà´ÊòØ‰ªÄ‰πàÔºü</strong></p>
<p>field Ê≤°Êúâget/set ÊñπÊ≥ïÔºå‰∏ç‰ºöÂØπÂ§ñÊö¥Èú≤Ôºå Âèç‰πãpropertyÈúÄË¶ÅÔºåÊâÄ‰ª•propertyÈÄöÂ∏∏Êúâget/set ÊñπÊ≥ï</p>
</blockquote>
<p><strong>Acceptor ÁöÑÂàõÂª∫ÂèäÂêØÂä®</strong></p>
<p>tomcat ÂêØÂä®ËøáÁ®ã‰∏≠ÔºåÂú®Ë∞ÉÁî®catalina ÁöÑstart ÊñπÊ≥ïÂêéÔºå‰ºö‰æùÊ¨°Ë∞ÉÁî®server.start(), service.start()ÔºåËÄåÂú®service ÁªÑ‰ª∂ÁöÑ<code>startInternal</code>ÊñπÊ≥ï‰∏≠‰ºöË∞ÉÁî®Connectors ÁöÑstartÊñπÊ≥ï„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">LifecycleMBeanBase</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">startInternal</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">LifecycleException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Start our defined Connectors second</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">connectorsLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Connector</span><span class="w"> </span><span class="n">connector</span><span class="p">:</span><span class="w"> </span><span class="n">connectors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// If it has already failed, don&#39;t try and start it</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connector</span><span class="p">.</span><span class="na">getState</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LifecycleState</span><span class="p">.</span><span class="na">FAILED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">connector</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Connector</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">LifecycleMBeanBase</span><span class="w">  </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">      * Coyote protocol handler.
</span></span></span><span class="line"><span class="cl"><span class="cm">      */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ProtocolHandler</span><span class="w"> </span><span class="n">protocolHandler</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">startInternal</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">LifecycleException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">protocolHandler</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LifecycleException</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;coyoteConnector.protocolHandlerStartFailed&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbstractProtocol</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ProtocolHandler</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">MBeanRegistration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">endpoint</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ÊúÄÁªà‰ºöË∞ÉÁî®Âà∞EndPointÁöÑstartInternalÊñπÊ≥ï</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NioEndpoint</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractJsseEndpoint</span><span class="o">&lt;</span><span class="n">NioChannel</span><span class="p">,</span><span class="n">SocketChannel</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">startInternal</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">running</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">paused</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Start poller thread</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">poller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Poller</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Thread</span><span class="w"> </span><span class="n">pollerThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">poller</span><span class="p">,</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;-Poller&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">pollerThread</span><span class="p">.</span><span class="na">setPriority</span><span class="p">(</span><span class="n">threadPriority</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">pollerThread</span><span class="p">.</span><span class="na">setDaemon</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">pollerThread</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">startAcceptorThread</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbstractEndpoint</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">startAcceptorThread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">acceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Acceptor</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">threadName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;-Acceptor&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">acceptor</span><span class="p">.</span><span class="na">setThreadName</span><span class="p">(</span><span class="n">threadName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">acceptor</span><span class="p">,</span><span class="w"> </span><span class="n">threadName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">t</span><span class="p">.</span><span class="na">setPriority</span><span class="p">(</span><span class="n">getAcceptorThreadPriority</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">t</span><span class="p">.</span><span class="na">setDaemon</span><span class="p">(</span><span class="n">getDaemon</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">t</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span></code></pre></div><p>AcceptorÁ∫øÁ®ãÂêØÂä®Âêé</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Acceptor Á±ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">stopCalled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endpoint</span><span class="p">.</span><span class="na">serverSocketAccept</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">stopCalled</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">endpoint</span><span class="p">.</span><span class="na">isPaused</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">endpoint</span><span class="p">.</span><span class="na">setSocketOptions</span><span class="p">(</span><span class="n">socket</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">endpoint</span><span class="p">.</span><span class="na">closeSocket</span><span class="p">(</span><span class="n">socket</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">endpoint</span><span class="p">.</span><span class="na">destroySocket</span><span class="p">(</span><span class="n">socket</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">....</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//NioEndpointÁ±ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="n">SocketChannel</span><span class="w"> </span><span class="nf">serverSocketAccept</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// serverSocketChannel ÊòØÂú®catalina load Èò∂ÊÆµÈÄöËøáÂàùÂßãÂåñ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Â¶ÇÊûúËÆæÁΩÆ‰∫Üblocking ÊâÄ‰ª•Ê≠§Â§Ñ‰ºöÈòªÂ°ûÔºå‰æãÂ¶Ç serverSocketChannel.configureBlocking(true)ÔºåÂê¶ÂàôÁ´ãÂç≥ËøîÂõû</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SocketChannel</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serverSocketChannel</span><span class="p">.</span><span class="na">accept</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">setSocketOptions</span><span class="p">(</span><span class="n">SocketChannel</span><span class="w"> </span><span class="n">socket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NioSocketWrapper</span><span class="w"> </span><span class="n">socketWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÂàÜÈÖçNioChannel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">NioChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nioChannels</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nioChannels</span><span class="p">.</span><span class="na">pop</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">channel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">SocketBufferHandler</span><span class="w"> </span><span class="n">bufhandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SocketBufferHandler</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">socketProperties</span><span class="p">.</span><span class="na">getAppReadBufSize</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">socketProperties</span><span class="p">.</span><span class="na">getAppWriteBufSize</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">socketProperties</span><span class="p">.</span><span class="na">getDirectBuffer</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isSSLEnabled</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SecureNioChannel</span><span class="p">(</span><span class="n">bufhandler</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NioChannel</span><span class="p">(</span><span class="n">bufhandler</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//Â∞ÅË£ÖSocketWrapper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">NioSocketWrapper</span><span class="w"> </span><span class="n">newWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NioSocketWrapper</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">channel</span><span class="p">.</span><span class="na">reset</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">newWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">connections</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">newWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">socketWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newWrapper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Set socket properties</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Disable blocking, polling will be used</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">socket</span><span class="p">.</span><span class="na">configureBlocking</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getUnixDomainSocketPath</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">socketProperties</span><span class="p">.</span><span class="na">setProperties</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">socket</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">setReadTimeout</span><span class="p">(</span><span class="n">getConnectionTimeout</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">setWriteTimeout</span><span class="p">(</span><span class="n">getConnectionTimeout</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">setKeepAliveLeft</span><span class="p">(</span><span class="n">NioEndpoint</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">getMaxKeepAliveRequests</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Â∞ÜsocketWrapper‰∫§Áªôpoller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">poller</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ExceptionUtils</span><span class="p">.</span><span class="na">handleThrowable</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;endpoint.socketOptionsError&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">tt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ExceptionUtils</span><span class="p">.</span><span class="na">handleThrowable</span><span class="p">(</span><span class="n">tt</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">destroySocket</span><span class="p">(</span><span class="n">socket</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Tell to close the socket if needed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// PollerÁ±ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">NioSocketWrapper</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">interestOps</span><span class="p">(</span><span class="n">SelectionKey</span><span class="p">.</span><span class="na">OP_READ</span><span class="p">);</span><span class="c1">//this is what OP_REGISTER turns into.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PollerEvent</span><span class="w"> </span><span class="n">pollerEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createPollerEvent</span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">,</span><span class="w"> </span><span class="n">OP_REGISTER</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">addEvent</span><span class="p">(</span><span class="n">pollerEvent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Â∞èÁªì</strong></p>
<ol>
<li>
<p>Âú®tomcat startÈò∂ÊÆµ‰ºöÂú®Endpoint start ÁöÑÊó∂ÂÄôÂàõÂª∫ÂîØ‰∏Ä‰∏Ä‰∏™acceptor Á∫øÁ®ã</p>
</li>
<li>
<p>AcceptorÁ∫øÁ®ãÈÄöËøáÊ≠ªÂæ™ÁéØÊù•Ë∞ÉÁî®<code>endpoint.serverSocketAccept()</code> ÊúÄÁªàË∞ÉÁî®serverSocketChannel.accept()Êù•Êé•ÂèóÊñ∞ÁöÑËøûÊé•ÔºåÊúâÊñ∞ËøûÊé•Êó∂‰ºöËøîÂõû‰∏Ä‰∏™SocketChannel„ÄÇËøôÈáåÂíåÊàë‰ª¨ÂâçÈù¢demo‰ª£Á†Å‰∏≠ÁöÑÂÆûÁé∞Êúâ‰∏™‰∏çÂêå‰πãÂ§ÑÊòØÂâçÈù¢demo‰ª£Á†Å‰∏≠Áî®ÁöÑÊòØBIOÊ®°ÂºèÔºåËÄå‰ªétomcat 8.0ÂºÄÂßãÈªòËÆ§NIOÔºåËøôÊòØNIOÁöÑÂÆûÁé∞ÊñπÂºè„ÄÇ</p>
</li>
<li>
<p>ÁÑ∂ÂêéË∞ÉÁî®<code>endpoint.setSocketOptions(socket)</code>,Êù•Â∞ÅË£ÖSocketWrapperÔºåÂπ∂Ë∞ÉÁî®poller.register(socketWrapper)ÔºåÂàõÂª∫PollerEventÔºå Âπ∂Áª¥Êä§Âú®Poller ÂÜÖÈÉ®ÁöÑevents ÂêåÊ≠•ÈòüÂàó‰∏≠„ÄÇ</p>
</li>
</ol>
<p>Êàë‰ª¨ÂÜçÊù•ÁúãÁúãPoller ÊòØÂÅö‰ªÄ‰πàÁöÑ„ÄÇ</p>
<h4 id="poller">Poller</h4>
<p>Poller Á∫øÁ®ã‰πüÊòØÂú®Endpoint startÁöÑÊó∂ÂÄôÂàõÂª∫ÔºåÂÜÖÈÉ®Áª¥Êä§ÁùÄ‰∏Ä‰∏™events ÈòüÂàó„ÄÇ</p>
<p><strong>events ÈòüÂàó</strong></p>
<p>events ÈòüÂàóÊòØ‰∏Ä‰∏™ÂÖàËøõÂÖàÂá∫ÁöÑÈòüÂàóÔºåÂΩìacceptor Êé•Êî∂Âà∞Êñ∞ÁöÑËØ∑Ê±ÇËøûÊé•Âêé‰ºöÂ∞ÅË£ÖPollerEvent Ê∑ªÂä†Âà∞Ëøô‰∏™ÈòüÂàó‰∏≠Ôºå ÊØè‰∏™Poller Event ÂåÖÂê´Ëøô‰∏™ÈìæÊé•ÁöÑsocketWrapper, socketWrapper ‰∏≠ÂåÖÂê´ÂèØ‰ª•Áî®Êù•ËØªÂÜôÊï∞ÊçÆÁöÑSocketChannel.</p>
<p><strong>runÊñπÊ≥ï</strong></p>
<p>runÊñπÊ≥ï‰ºö‰∏çÊñ≠ÂéªÈÅçÂéÜevents ÈòüÂàóÔºå Â¶ÇÊûúÊúâevent Â∞±‰ºö‰ªéÈòüÂàó‰∏≠ÂèñÂá∫Êù•Ê∂àË¥π</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">   </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The background thread that adds sockets to the Poller, checks the
</span></span></span><span class="line"><span class="cl"><span class="cm">     * poller for triggered events and hands the associated socket off to an
</span></span></span><span class="line"><span class="cl"><span class="cm">     * appropriate processor as events occur.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Loop until destroy() is called</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">close</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">hasEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">events</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wakeupCounter</span><span class="p">.</span><span class="na">getAndSet</span><span class="p">(</span><span class="o">-</span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// If we are here, means we have other stuff to do</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// Do a non blocking select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">keyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selector</span><span class="p">.</span><span class="na">selectNow</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">keyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selector</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">selectorTimeout</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">wakeupCounter</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ExceptionUtils</span><span class="p">.</span><span class="na">handleThrowable</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;endpoint.nio.selectorLoopError&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">continue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">SelectionKey</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">keyCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">selector</span><span class="p">.</span><span class="na">selectedKeys</span><span class="p">().</span><span class="na">iterator</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Walk through the collection of ready keys and dispatch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// any active event.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">iterator</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">iterator</span><span class="p">.</span><span class="na">hasNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">SelectionKey</span><span class="w"> </span><span class="n">sk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iterator</span><span class="p">.</span><span class="na">next</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">iterator</span><span class="p">.</span><span class="na">remove</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">NioSocketWrapper</span><span class="w"> </span><span class="n">socketWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NioSocketWrapper</span><span class="p">)</span><span class="w"> </span><span class="n">sk</span><span class="p">.</span><span class="na">attachment</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// Attachment may be null if another thread has called</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// cancelledKey()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">processKey</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Process timeouts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">timeout</span><span class="p">(</span><span class="n">keyCount</span><span class="p">,</span><span class="n">hasEvents</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">getStopLatch</span><span class="p">().</span><span class="na">countDown</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="Ëß£ÊûêËØ∑Ê±ÇÊï∞ÊçÆ">Ëß£ÊûêËØ∑Ê±ÇÊï∞ÊçÆ</h3>
<p><strong>processKey</strong></p>
<p>pollerÁ∫øÁ®ã‰ªéevents ÈòüÂàó‰∏≠ÂèñÂá∫‰∫ã‰ª∂Âêé‰ºöË∞ÉÁî®<code>processKey(sk, socketWrapper)</code> ËøõË°åÊ∂àË¥π</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processKey</span><span class="p">(</span><span class="n">SelectionKey</span><span class="w"> </span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">NioSocketWrapper</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">close</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">cancelledKey</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sk</span><span class="p">.</span><span class="na">isValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sk</span><span class="p">.</span><span class="na">isReadable</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">sk</span><span class="p">.</span><span class="na">isWritable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">getSendfileData</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">processSendfile</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">unreg</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">,</span><span class="w"> </span><span class="n">sk</span><span class="p">.</span><span class="na">readyOps</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">closeSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// Read goes before write</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sk</span><span class="p">.</span><span class="na">isReadable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">readOperation</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">readOperation</span><span class="p">.</span><span class="na">process</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">closeSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">readBlocking</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">readLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">readBlocking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">readLock</span><span class="p">.</span><span class="na">notify</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">processSocket</span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">,</span><span class="w"> </span><span class="n">SocketEvent</span><span class="p">.</span><span class="na">OPEN_READ</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">closeSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">closeSocket</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sk</span><span class="p">.</span><span class="na">isWritable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">writeOperation</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">writeOperation</span><span class="p">.</span><span class="na">process</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">closeSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">writeBlocking</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">writeLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">writeBlocking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">socketWrapper</span><span class="p">.</span><span class="na">writeLock</span><span class="p">.</span><span class="na">notify</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">processSocket</span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">,</span><span class="w"> </span><span class="n">SocketEvent</span><span class="p">.</span><span class="na">OPEN_WRITE</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">closeSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">closeSocket</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">cancelledKey</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Invalid key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">cancelledKey</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CancelledKeyException</span><span class="w"> </span><span class="n">ckx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">cancelledKey</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ExceptionUtils</span><span class="p">.</span><span class="na">handleThrowable</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;endpoint.nio.keyProcessingError&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>processSocket</strong></p>
<p>processSocketÁöÑÂÆûÁé∞Âú®<code>AbstractEndpoint</code> ‰∏≠ÔºåÂèØ‰ª•ÁúãÂà∞ÂàõÂª∫‰∫ÜSocketProcessorÂπ∂‰∫§ÁªôÁ∫øÁ®ãÊ±†Êù•Â§ÑÁêÜ„ÄÇÂàíÈáçÁÇπÔºöÊØè‰∏Ä‰∏™socket ÈÉΩ‰ºöÊúâ‰∏Ä‰∏™ÂØπÂ∫îÁöÑsocketProcessorÊù•Â§ÑÁêÜ„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">processSocket</span><span class="p">(</span><span class="n">SocketWrapperBase</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">SocketEvent</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">dispatch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// ÂàõÂª∫SocketProcessorÔºå SocketProcessorÊòØEndPoint ÁöÑÂÜÖÈÉ®Á±ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSocketProcessor</span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getExecutor</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// ‰∫§ÁªôÁ∫øÁ®ãÊ±†Êù•Â§ÑÁêÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">executor</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RejectedExecutionException</span><span class="w"> </span><span class="n">ree</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">getLog</span><span class="p">().</span><span class="na">warn</span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;endpoint.executor.fail&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ree</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ExceptionUtils</span><span class="p">.</span><span class="na">handleThrowable</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// This means we got an OOM or similar creating a thread, or that</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// the pool and its queue are full</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">getLog</span><span class="p">().</span><span class="na">error</span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;endpoint.process.fail&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>SocketProcessorÊòØEndPoint ÁöÑÂÜÖÈÉ®Á±ªÔºåÊúÄÁªà‰ºöË∞ÉÁî®<code>doRun</code> ÊñπÊ≥ïÊù•Â§ÑÁêÜ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doRun</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Poller</span><span class="w"> </span><span class="n">poller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NioEndpoint</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">poller</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// getHandler ËøîÂõûÁöÑÂ∞±ÊòØConnectionHandlerÔºå ÊòØAbstractProtocolÁöÑ‰∏Ä‰∏™ÂÜÖÈÉ®Á±ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getHandler</span><span class="p">().</span><span class="na">process</span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ËøîÂõûÁöÑÂ∞±ÊòØConnectionHandlerÁöÑprocess ÊñπÊ≥ïÔºå</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">SocketState</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">SocketWrapperBase</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="n">wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">SocketEvent</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">processor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">processor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recycledProcessors</span><span class="p">.</span><span class="na">pop</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">processor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// ËøîÂõûProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">processor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getProtocol</span><span class="p">().</span><span class="na">createProcessor</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">register</span><span class="p">(</span><span class="n">processor</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processor</span><span class="p">.</span><span class="na">process</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SocketState</span><span class="p">.</span><span class="na">UPGRADING</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">state</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">){}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Make sure socket/processor is removed from the list of current</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// connections</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">release</span><span class="p">(</span><span class="n">processor</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SocketState</span><span class="p">.</span><span class="na">CLOSED</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// AbstactHttp11Protocol ‰∏≠createProcessor ÁöÑÂÆûÁé∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ê≥®ÊÑèÊ≠§Â§Ñ‰º†ÂÖ•‰∫Ü‰∏Ä‰∏™Adapter, ÂÆÉÂú®ConnectorÂàùÂßãÂåñÊó∂ÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//  adapter = new CoyoteAdapter(this);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//  protocolHandler.setAdapter(adapter);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="n">Processor</span><span class="w"> </span><span class="nf">createProcessor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Http11Processor</span><span class="w"> </span><span class="n">processor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Http11Processor</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">adapter</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">processor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>‰ª•HTTP/1.1 ‰∏∫‰æãÔºå ‰∏äËø∞‰ª£Á†Å‰ºöÂàõÂª∫HTTP11Processor Êù•Â§ÑÁêÜËøô‰∏™socket</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Http11Processor.png"
	width="555"
	height="489"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Http11Processor_huf45ff0efba7988c54fb1b4b26837a903_18989_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Http11Processor_huf45ff0efba7988c54fb1b4b26837a903_18989_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Http11Processor"
	
	
		class="gallery-image" 
		data-flex-grow="113"
		data-flex-basis="272px"
	
></p>
<p>AbstractProcessorLightÁöÑprocess ÊñπÊ≥ï„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">SocketState</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">SocketWrapperBase</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">,</span><span class="w"> </span><span class="n">SocketEvent</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// service ÊòØÊäΩË±°ÊñπÊ≥ï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">(</span><span class="n">socketWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SocketState</span><span class="p">.</span><span class="n">ASYNC_END</span><span class="w"> </span><span class="o">||</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">dispatches</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">SocketState</span><span class="p">.</span><span class="na">CLOSED</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">state</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Â∞èÁªì</strong></p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/poller-and-Adapter.png"
	width="1593"
	height="419"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/poller-and-Adapter_hu47e696a7d929ac791f98710d72cae244_49737_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/poller-and-Adapter_hu47e696a7d929ac791f98710d72cae244_49737_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="pollerÂà∞Adapter"
	
	
		class="gallery-image" 
		data-flex-grow="380"
		data-flex-basis="912px"
	
></p>
<p>ÊØè‰∏Ä‰∏™Http11Processor ÂÜÖÈÉ®‰ºöÁª¥Êä§‰∏Ä‰∏™<code>Http11InputBuffer</code> Âíå‰∏Ä‰∏™<code>Http11OutputBuffer</code>, Áî®‰ΩúÈíàÂØπsocket IO ÁöÑÁºìÂ≠òÂ±ÇÔºåÂú®ÂÆûÁé∞ÁöÑservice ÊñπÊ≥ï‰∏≠Êù•Ëß£ÊûêËØ∑Ê±ÇË°åÔºåËØ∑Ê±ÇÂ§¥, ÁÑ∂ÂêéÂ∞ÜËØ∑Ê±Ç‰∫§Áªô<code>Adapter</code>Â§ÑÁêÜ</p>
<p>Http11ProcessorÁöÑservice ÊñπÊ≥ï</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">SocketState</span><span class="w"> </span><span class="nf">service</span><span class="p">(</span><span class="n">SocketWrapperBase</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">socketWrapper</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">....</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Parsing the request header</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">inputBuffer</span><span class="p">.</span><span class="na">parseRequestLine</span><span class="p">(</span><span class="n">keptAlive</span><span class="p">,</span><span class="w"> </span><span class="n">protocol</span><span class="p">.</span><span class="na">getConnectionTimeout</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">protocol</span><span class="p">.</span><span class="na">getKeepAliveTimeout</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">.</span><span class="na">getParsingRequestLinePhase</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">SocketState</span><span class="p">.</span><span class="na">UPGRADING</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">handleIncompleteRequestLineRead</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Process the Protocol component of the request line</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Need to know if this is an HTTP 0.9 request before trying to</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// parse headers.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">prepareRequestProtocol</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//Ëß£ÊûêÂÆåÂêé‰ºöË∞ÉÁî®adaptor ÁöÑservice ÊñπÊ≥ï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">getAdapter</span><span class="p">().</span><span class="na">service</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="Ëß£ÊûêËØ∑Ê±ÇË°å">Ëß£ÊûêËØ∑Ê±ÇË°å</h4>
<p>Ëß£ÊûêËØ∑Ê±ÇË°åÁöÑÊìç‰ΩúÂú®Http11InputBufferÁöÑparseRequestLine‰∏≠ËøõË°åÔºå</p>
<ol>
<li>
<p>parseRequestLine‰ºöË∞ÉÁî®ÁßÅÊúâÊñπÊ≥ï<code>fill(boolean block) </code>,Êù•ËØªÂèñÂéüÂßãÁöÑËØ∑Ê±ÇÊï∞ÊçÆÔºåÂú®ËøôÈáåÂÆÉÂ∞±ÊòØ‰∏Ä‰∏™Â≠óËäÇÊï∞ÁªÑ„ÄÇ</p>
<p>fillÊñπÊ≥ï‰∏≠ÈÄöËøá<code>nRead = socketWrapper.read(block, byteBuffer);</code> ‰ºöÂ∞Üsocket ‰∏≠ÁöÑËæìÂÖ•ÊµÅËØªÂèñÂà∞Http11InputBuffer‰∏≠ÁöÑbyteBuffer‰∏≠</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240223154318886.png"
	width="3748"
	height="1494"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240223154318886_hu422a27446ff72e8453b218dd177bc600_887899_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240223154318886_hu422a27446ff72e8453b218dd177bc600_887899_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240223154318886"
	
	
		class="gallery-image" 
		data-flex-grow="250"
		data-flex-basis="602px"
	
></p>
</li>
<li>
<p>Ë∑≥ËøáÁ©∫Ë°å</p>
</li>
<li>
<p>Ëß£ÊûêËØ∑Ê±ÇÊñπÊ≥ïÔºö ‰ªéÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶(Token)ÂºÄÂßãËØªÔºåËØªÂà∞Á©∫ÁôΩ(&rsquo; &lsquo;) Êàñtab(&rsquo;\t&rsquo;) ÁªìÊùüÔºå Ëøô‰∏ÄÊ≠•ÁªìÊùüÂêéÂèØ‰ª•ÂæóÂà∞<code>GET</code>Ôºå ÁÑ∂ÂêéÈÄöËøá<code>request.method().setBytes(byteBuffer.array(), parsingRequestLineStart,pos - parsingRequestLineStart)</code> Êù•‰øùÂ≠òËØ∑Ê±ÇÊñπÊ≥ïÔºåÊ≥®ÊÑèÊ≠§Â§Ñ‰øùÂ≠òÁöÑÊòØÊ∫êÁ†ÅÂÖ®ÈÉ®ÁöÑÂ≠óËäÇÊï∞ÁªÑÔºå‰ª•ÂèäGETÂú®Êï∞ÁªÑ‰∏≠ÂØπÂ∫îÁöÑËµ∑Âßã‰ΩçÁΩÆ„ÄÇ</p>
<blockquote>
<p>Ê≠§Â§ÑÁöÑrequestÊòØorg.apache.coyote.Request, Âú®Http11ProcessorÂÆû‰æãÂåñÁöÑÊó∂ÂÄôÊûÑÂª∫, Áª¥Êä§Âú®<code>AbstractProcessor</code> ‰∏≠</p>
</blockquote>
</li>
<li>
<p>Ëß£ÊûêURI: ÁªßÁª≠ÂæÄ‰∏ãËØªÂ≠óÁ¨¶ÔºåÁõ¥Âà∞Á©∫ÁôΩÊàñÊç¢Ë°åÔºå‰æãÂ¶ÇËøô‰∏ÄÊ≠•‰ºöÂæóÂà∞ <code>/my-app/ping</code> ÁÑ∂ÂêéÁ±ª‰ººÁöÑÈÄöËøá<code>request.requestURI().setBytes(byteBuffer.array(), parsingRequestLineStart,end - parsingRequestLineStart)</code> Â∞ÜËøôÈÉ®ÂàÜ‰ø°ÊÅØ‰øùÂ≠òÂú®request‰∏≠ÔºåËÆ∞ÂΩïURIÂú®Êï∞ÁªÑ‰∏≠Ëµ∑Âßã‰ΩçÁΩÆ„ÄÇ</p>
</li>
<li>
<p>Ëß£ÊûêÂçèËÆÆÔºöÁªßÁª≠ÂæÄ‰∏ãËØªÂ≠óÁ¨¶ÔºåÁõ¥Âà∞Á©∫ÁôΩÊàñÊç¢Ë°åÔºåÈÄöËøá<code>request.protocol().setBytes(byteBuffer.array(), parsingRequestLineStart,end - parsingRequestLineStart)</code> Â∞ÜËØ∑Ê±ÇÊâÄÁî®ÁöÑÂçèËÆÆ‰æãÂ¶ÇHTTP‰øùÂ≠òÂú®request‰∏≠ÔºåËÆ∞ÂΩïÂçèËÆÆÂú®Êï∞ÁªÑ‰∏≠Ëµ∑Âßã‰ΩçÁΩÆ„ÄÇ</p>
</li>
</ol>
<p>request‰∏≠ÁöÑËØ∑Ê±ÇÂçèËÆÆÔºåÊñπÊ≥ïÔºåURLÁ≠âÊØè‰∏Ä‰∏™‰ø°ÊÅØÈÉΩÁî®<code>MessageBytes</code> Á±ªÂûãÁöÑÂèòÈáèÊù•Â≠òÂÇ®ÔºåMessageBytes ÂÜÖÈÉ®Áª¥Êä§ÁùÄ‰∏Ä‰∏™<code>ByteChunk</code> Â≠óËäÇÂùóÔºå‰∏äÈù¢Ëß£ÊûêÂá∫Êù•ÁöÑËØ∑Ê±ÇË°å‰ø°ÊÅØÈÉΩ‰ºöÂèòÊàêbytechunk ÂèäMessageByteÂ≠òÂÇ®Âà∞request‰∏≠„ÄÇ</p>
<h4 id="Ëß£ÊûêËØ∑Ê±ÇÂ§¥">Ëß£ÊûêËØ∑Ê±ÇÂ§¥</h4>
<p>Ëß£ÊûêËØ∑Ê±ÇÂ§¥ÈÄöËøá<code>inputBuffer.parseHeaders()</code> Êù•ËøõË°åÔºå‰πüÊòØÊåâÁÖßHTTPÂçèËÆÆÊù•ËøõË°åÂ≠óÁ¨¶ÁöÑÊìç‰ΩúÂà§Êñ≠Ëß£ÊûêÂá∫headers, ÁÑ∂ÂêéÂ≠òÂÇ®Âú®request ‰∏≠„ÄÇ</p>
<h3 id="Â§ÑÁêÜËØ∑Ê±Ç">Â§ÑÁêÜËØ∑Ê±Ç</h3>
<p>AdapterÁöÑÂàõÂª∫</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//Adapter ÊòØÂú®connectorÂàùÂßãÂåñÁöÑÊó∂ÂÄôÂàõÂª∫ÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initInternal</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">LifecycleException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Initialize adapter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CoyoteAdapter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">protocolHandler</span><span class="p">.</span><span class="na">setAdapter</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">protocolHandler</span><span class="p">.</span><span class="na">init</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LifecycleException</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;coyoteConnector.protocolHandlerInitializationFailed&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>CoyoteAdapterÁöÑservice ÊñπÊ≥ïÔºå</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">service</span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">coyote</span><span class="p">.</span><span class="na">Request</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">coyote</span><span class="p">.</span><span class="na">Response</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c1">// Ê≠§Â§ÑÂàõÂª∫ÁöÑÊòØorg.apache.catalina.connector.Request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connector</span><span class="p">.</span><span class="na">createRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">request</span><span class="p">.</span><span class="na">setCoyoteRequest</span><span class="p">(</span><span class="n">req</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connector</span><span class="p">.</span><span class="na">createResponse</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">response</span><span class="p">.</span><span class="na">setCoyoteResponse</span><span class="p">(</span><span class="n">res</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c1">// Link objects</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">request</span><span class="p">.</span><span class="na">setResponse</span><span class="p">(</span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">response</span><span class="p">.</span><span class="na">setRequest</span><span class="p">(</span><span class="n">request</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c1">// Set as notes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">req</span><span class="p">.</span><span class="na">setNote</span><span class="p">(</span><span class="n">ADAPTER_NOTES</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">res</span><span class="p">.</span><span class="na">setNote</span><span class="p">(</span><span class="n">ADAPTER_NOTES</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c1">// Set query string encoding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">req</span><span class="p">.</span><span class="na">getParameters</span><span class="p">().</span><span class="na">setQueryStringCharset</span><span class="p">(</span><span class="n">connector</span><span class="p">.</span><span class="na">getURICharset</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Parse and set Catalina and configuration specific</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// request parameters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">postParseSuccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">postParseRequest</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">postParseSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Calling the container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">connector</span><span class="p">.</span><span class="na">getService</span><span class="p">().</span><span class="na">getContainer</span><span class="p">().</span><span class="na">getPipeline</span><span class="p">().</span><span class="na">getFirst</span><span class="p">().</span><span class="na">invoke</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">isAsync</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">finishRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">response</span><span class="p">.</span><span class="na">finishResponse</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ignore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Ê≥®ÊÑèÊ≠§Â§ÑÁöÑ‰∏Ä‰∏™ÊØîËæÉÈïøÁöÑÈìæÂºèË∞ÉÁî®Ôºå<code>connector.getService().getContainer().getPipeline().getFirst().invoke(request, response)</code>,Ê≠§Â§ÑÊ∂âÂèäÂè¶‰∏§‰∏™ËÆæËÆ°Ôºå<code>Pipeline</code> Âíå<code>Valve</code> ÔºåÂêéÈù¢Ë°•ÂÖÖ„ÄÇ</p>
<p>ËÄåÈªòËÆ§ÊÉÖÂÜµ‰∏ãËøôÈáå‰ºöÊâßË°å<code>StandardEngineValve</code>ÁöÑinvokeÊñπÊ≥ï</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Select the Host to be used for this Request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Host</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ask this Host to process this request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">host</span><span class="p">.</span><span class="na">getPipeline</span><span class="p">().</span><span class="na">getFirst</span><span class="p">().</span><span class="na">invoke</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ÁÑ∂ÂêéEngine‰æùÊóßÈÄöËøáÁ±ª‰ººÁöÑPipeline ÂÅöÊ≥ïÊääËØ∑Ê±Ç‰∫§ÁªôHostÂ§ÑÁêÜÔºåÈÇ£‰πà‰æùÊ¨°Á±ªÊé®Ôºå‰∏ÄÂÆö‰ºöÊâßË°åÂà∞<code>StandardHostValve</code>ÁöÑinvoke ÊñπÊ≥ï ‰∏≠ÂéªÔºåÁÑ∂ÂêéStandardContextValve -&gt; StandardWrapperValve, ÂâçÈù¢ËØ¥Âà∞WrapperÁõ∏ÂΩì‰∫éServlet, Êàë‰ª¨ÁúãÁúãStandardWrapperValve‰∏≠ÁöÑÂÆûÁé∞Ôºå</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Servlet</span><span class="w"> </span><span class="n">servlet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">servlet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wrapper</span><span class="p">.</span><span class="na">allocate</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Create the filter chain for this request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Â§ßÂêçÈºéÈºéÁöÑTomcat Filter Êé•Âè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ApplicationFilterChain</span><span class="w"> </span><span class="n">filterChain</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ApplicationFilterFactory</span><span class="p">.</span><span class="na">createFilterChain</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">servlet</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">filterChain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getRequest</span><span class="p">(),</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">getResponse</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ËøôÈáåÂÖ≥ÈîÆÊ≠•È™§ÁúãÂà∞ filterChain.doFilter(request.getRequest(), response.getResponse());Â∞±ÁªìÊùü‰∫ÜÔºåÂÜçÊù•Áúã<code>ApplicationFilterChain</code>ÁöÑdoFilterÊñπÊ≥ïÔºå</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilter</span><span class="p">(</span><span class="n">ServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">ServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Globals</span><span class="p">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">internalDoFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">internalDoFilter</span><span class="p">(</span><span class="n">ServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="n">ServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">// Call the next filter if there is one</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">ApplicationFilterConfig</span><span class="w"> </span><span class="n">filterConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filters</span><span class="o">[</span><span class="n">pos</span><span class="o">++]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">Filter</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filterConfig</span><span class="p">.</span><span class="na">getFilter</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Globals</span><span class="p">.</span><span class="na">IS_SECURITY_ENABLED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c1">// ËøêË°åtomcat ËøáÊª§Âô®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">filter</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">// We fell off the end of the chain -- call the servlet instance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">servlet</span><span class="p">.</span><span class="na">service</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ÂèØ‰ª•ÁúãÂà∞Áªà‰∫éÂú®ApplicationFilterChain‰∏≠Ë∞ÉÁî®‰∫Ü<code>servlet.service(request, response)</code> !!!!!</p>
<h3 id="Â∞èÁªì">Â∞èÁªì</h3>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/tomcat%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B.png"
	width="1742"
	height="440"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/tomcat%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B_hue5cbee21db16f225f329ffd1c2d09bd6_65882_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/tomcat%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B_hue5cbee21db16f225f329ffd1c2d09bd6_65882_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="tomcatËØ∑Ê±ÇËøáÁ®ã"
	
	
		class="gallery-image" 
		data-flex-grow="395"
		data-flex-basis="950px"
	
></p>
<ol>
<li>
<p>Connector ‰∏≠Êúâ‰∏Ä‰∏™Â±ûÊÄßÂè´protocolHandlerÔºå connectorËøêË°åstartÊñπÊ≥ïÂêé, ‰ºöËøêË°å<code>protocolHandler.start()</code></p>
</li>
<li>
<p>protocolHandlerÁªßÊâø<code>AbstractProtocol</code>, AbstractProtocol‰∏≠Êúâ‰∏™Â±ûÊÄßÂè´endpointÔºå ‰ºöÂú®prorocolHandlerÂÆû‰æãÂåñÁöÑÊó∂ÂÄôÂÆû‰æãÂåñEndPoint</p>
</li>
<li>
<p>AbstractProtocolÁöÑstartÊñπÊ≥ïÔºå‰ºöÊâßË°åendpointÁöÑstartÊñπÊ≥ï</p>
</li>
<li>
<p>endpoint start ÊñπÊ≥ï‰∏≠‰ºöÂàÜÂà´ÂºÄÂêØ‰∏§‰∏™Á∫øÁ®ã(‰ª•‰∏ãÂü∫‰∫é<code>NioEndPoint</code>Á±ªÁöÑÂàÜÊûê)</p>
<ul>
<li>Poller Á∫øÁ®ãÔºå Áî®Êù•Ê∂àË¥πÂíåÂ§ÑÁêÜËØ∑Ê±ÇÔºå Poller ÊòØNioEndPointÁöÑÂÜÖÈÉ®Á±ª</li>
<li>AcceptorÁ∫øÁ®ãÔºåÁî®Êù•ÁõëÂê¨Á´ØÂè£ÂíåÊé•Êî∂socketÈìæÊé•</li>
</ul>
</li>
<li>
<p>AcceptorÁ∫øÁ®ãrun ÊñπÊ≥ï</p>
<ul>
<li>Âú®Âæ™ÁéØ‰ºöË∞ÉÁî®endpoint ÁöÑserverSocketAcceptÊñπÊ≥ïÊù•ÊúÄÁªàÊâßË°åServerSocketChannel.accpet()ÊñπÊ≥ïÔºåËØ∑Ê±ÇÂà∞Êù•Âêé‰ºöËøîÂõû‰∏Ä‰∏™SocketChannel</li>
<li>‰ºöË∞ÉÁî®<code>endpoint.setSocketOptions(socket)</code>ÊñπÊ≥ïÊù•Â∞ÅË£Ösockerwrapper, Âπ∂ÂêëPollerÊ≥®ÂÜåsocketWrapper</li>
<li>Ê≥®ÂÜåsocketWrapperÁöÑÊó∂ÂÄô‰ºöÂàõÂª∫<code>PollerEvent</code> Âπ∂Áª¥Êä§Âú®PollerÂÜÖÈÉ®ÁöÑeventsÈòüÂàó‰∏≠</li>
</ul>
</li>
<li>
<p>PollerÁ∫øÁ®ãrun ÊñπÊ≥ï</p>
<ul>
<li>Âæ™ÁéØ‰∏≠‰∏çÊñ≠ÈÅçÂéÜeventsÈòüÂàóÔºåÂ¶ÇÊûúÊúâ‰∫ã‰ª∂ÂàôÂèñÂá∫socketÂ§ÑÁêÜÔºåÊúâ‰∏™Ê†∏ÂøÉÊñπÊ≥ïÊòØË∞ÉÁî®AbstractEndpointÁöÑprocessSocketÊñπÊ≥ï</li>
<li>AbstractEndpointÁöÑprocessSocket‰∏≠‰ºöÂàõÂª∫SocketProcessorÁ∫øÁ®ãÂπ∂‰∫§ÁªôÁ∫øÁ®ãÊ±†ÂéªËøêË°åÔºåSocketProcessorÊòØEndPoint Â≠êÁ±ª‰∏≠ÁöÑÂÜÖÈÉ®Á±ª</li>
</ul>
</li>
<li>
<p>SocketProcessorÁ∫øÁ®ãdoRun ÊñπÊ≥ï(run ÊñπÊ≥ïÁî±Áà∂Á±ªË¶ÜÂÜôÁÑ∂ÂêéË∞ÉÁî®Â≠êÁ±ªÁöÑdoRunÊñπÊ≥ï)</p>
<ul>
<li>Ë∞ÉÁî®ConnectionHandler ÁöÑprocess ÊñπÊ≥ïÔºåConnectionHandlerÊòØAbstractProtocolÁöÑÂÜÖÈÉ®Á±ª</li>
<li>ConnectionHandler process ÊñπÊ≥ï‰∏≠‰ºöË∞ÉÁî®ProcessorÊñπÊ≥ïprocessÊñπÊ≥ïÊù•Â§ÑÁêÜÔºå‰æãÂ¶ÇHttp11Processor</li>
<li>Http11ProcessorÁªßÊâøAbstractProcessorLightÔºåAbstractProcessorLight‰ºöË∞ÉÁî®Â≠êÁ±ªÁöÑserviceÊñπÊ≥ï</li>
<li>ÁÑ∂ÂêéHttp11Processor‰ºöËß£ÊûêËØ∑Ê±ÇË°åÔºåËØ∑Ê±ÇÂ§¥ÔºåÂÅö‰∏Ä‰∫õÈ¢ÑÂ§ÑÁêÜÊûÑÂª∫coyoteÁöÑRequest ÂíåResponseÔºåÁÑ∂ÂêéÈÄöËøáË∞ÉÁî®getAdapter().service(request, response)Â∞ÜËØ∑Ê±Ç‰∫§ÁªôAdapterÂ§ÑÁêÜ</li>
</ul>
</li>
<li>
<p>AdapterÁöÑservice ÊñπÊ≥ï</p>
<ul>
<li>
<p>ÊûÑÂª∫org.apache.catalina.connector.Request Âíåorg.apache.catalina.connector.ResponseÔºå‰ªñ‰ª¨ÂÆûÁé∞‰∫ÜHttpServletRequestÂíåHttpServletResponse, ÊâÄ‰ª•ËøôÈáåÊú¨Ë¥®‰∏äÊòØÊûÑÂª∫ServletRequest ÂíåServletResponse</p>
</li>
<li>
<p>ÁÑ∂ÂêéÈÄöËøáPipeline Â∞ÜËØ∑Ê±Ç‰∫§ÁªôÂÆπÂô®Â§ÑÁêÜ, <code>connector.getService().getContainer().getPipeline().getFirst().invoke(request,response)</code></p>
</li>
<li>
<p>È¶ñÂÖà‰ºöË∞ÉÁî®StandardEngineValveÁöÑinvokeÊñπÊ≥ïÔºåÁÑ∂Âêé‰æùÊ¨°Ë∞ÉÁî®StandardHostValve„ÄÅStandardContextValve„ÄÅStandardWrapperValve</p>
</li>
<li>
<p>StandardWrapperValveÁöÑinvoke ‰∏≠‰ºöËé∑Âèñservlet, ÁÑ∂ÂêéÂàõÂª∫ApplicationFilterChainÔºåË∞ÉÁî®filterChain.doFilterÊñπÊ≥ï</p>
</li>
<li>
<p>ÁÑ∂ÂêéÊâßË°åtomcat ÁöÑËøáÊª§Âô®ÈìæÔºåÊúÄÁªàÊâßË°åservlet.service(request, response)ÊñπÊ≥ï</p>
</li>
</ul>
</li>
</ol>
<p>ËøòÊúâ‰∏Ä‰∫õÁñëÈóÆÔºåÊØîÂ¶ÇÔºö</p>
<ol>
<li>Servlet ÊòØ‰ªÄ‰πàÊó∂ÂÄôË¢´Âä†ËΩΩÁöÑÔºåÂÆÉÁöÑÁîüÂëΩÂë®ÊúüÊòØ‰ªÄ‰πàÊó∂ÂÄôÁªìÊùüÁöÑÔºü</li>
<li>Â§ÑÁêÜËØ∑Ê±ÇÁöÑservletÊòØÂ¶Ç‰ΩïË¢´ÂÆö‰ΩçÂà∞ÁöÑÔºü</li>
<li>Servlet Â§ÑÁêÜÂÆåËØ∑Ê±ÇÂêétomcatÂ¶Ç‰ΩïÂ∞ÜËøîÂõûÊï∞ÊçÆÂìçÂ∫îÁªôÂÆ¢Êà∑Á´ØÔºü</li>
</ol>
<h2 id="servlet-ÂíåËØ∑Ê±ÇÁöÑmapping">Servlet ÂíåËØ∑Ê±ÇÁöÑMapping</h2>
<p>‰∏Ä‰∏™ËØ∑Ê±ÇÁöÑÊ†ºÂºèÂÖ∂ÂÆûÂåÖÊã¨ip,port, path, ÈÇ£‰πàÊò†Â∞ÑÂà∞tomcat ÁªìÊûÑ‰∏äÊù•ÂÖ∂ÂÆûÂ∞±ÊòØË¶ÅÊâæÂà∞ÂØπÂ∫îÁöÑHost, Context, Wrapper(serlvelt).</p>
<p>Êàë‰ª¨Âú®<code>StandardEngineValve</code> ÁöÑinvoke ÊñπÊ≥ï‰∏≠ÂèëÁé∞ÂÆÉÊòØÁõ¥Êé•ÈÄöËøá<code>Host host = request.getHost();</code> Êù•ÂÆö‰ΩçÂà∞hostÁöÑÔºåhostÁª¥Êä§Âú®<code>org.apache.catalina.connector.Request</code>ÂÜÖÈÉ®ÁöÑMappingData‰∏≠ÔºåËÄåËøô‰∏™MappingDataËøòÂåÖÂê´Context, WrapperÁ≠â‰ø°ÊÅØÔºå ËØ¥ÊòéËøô‰∏™mapping Â∑•‰ΩúÂèëÁîüÂú®connector ÊääËØ∑Ê±Ç‰∫§ÁªôÂÆπÂô®Â§ÑÁêÜ‰πãÂâçÔºå ÊâÄ‰ª•ÈúÄË¶ÅÂÖ≥Ê≥®MappingDataÊòØÂ¶Ç‰ΩïÂàõÂª∫ÁöÑ„ÄÇ</p>
<p><code>Http11Processor</code> ‰∫§ÁªôAdapterÁöÑÊòØ<code>org.apache.coyote.Request</code>,  <code>org.apache.catalina.connector.Request</code>ÊòØÂú®AdapterÁöÑservice ÊñπÊ≥ï‰∏≠ÂàùÊ¨°ÊûÑÂª∫ÁöÑ„ÄÇ</p>
<p>Âú®AdapterÁöÑ<code>postParseRequest</code> ÊñπÊ≥ï‰∏≠ÊúâÊÆµÂÖ≥ÈîÆ‰ª£Á†ÅÔºö</p>
<pre tabindex="0"><code>connector.getService().getMapper().map(serverName, decodedURI,
        version, request.getMappingData())
    
</code></pre><p>Mapper ÊòØServiceÁöÑÁªÑ‰ª∂ÔºåÂú®service startÁöÑÊó∂ÂÄô‰ºöstart mapperListenerÔºå ÁÑ∂ÂêéÈÄöËøá<code>registerHost(host)</code> Â∞Ühost Â∞ÅË£Ö‰∏∫MappedHostÊ∑ªÂä†Âà∞Mapper ÂÜÖÈÉ®Áª¥Êä§ÁöÑ<code>hosts</code> Êï∞ÁªÑ‰∏≠Ôºå ÂêåÊó∂MappedHostÂÜÖÈÉ®Áª¥Êä§‰∫ÜContextListÔºåContextList ÂÜÖÈÉ®Áª¥Êä§MappedContextÔºåMappedContextÂÜÖÈÉ®Áª¥Êä§ContextVersionÔºåContextVersionÂÜÖÈÉ®Áª¥Êä§MappedWrapperÔºå Áî±Ê≠§ÂèàÊûÑÂª∫‰∫Ü‰∏ÄÂ•óÂ±ÇÁ∫ßÂÖ≥Á≥ª„ÄÇ</p>
<p>MappingDataÂ∞±ÊòØÂú®ËøôÈáåÂàùÂßãÂåñÁöÑ„ÄÇÈÄöËøáÊü•ÊâæMapper ÂÜÖÈÉ®Áª¥Êä§ÁöÑ<code>hosts</code>ÂÆö‰ΩçÂà∞Host ÂêéÂ∞±ÂèØ‰ª•ÂÜçÂÆö‰ΩçContext,  ÊúÄÁªàÂÆö‰ΩçÂà∞wrapper. Âú®Â§ÑÁêÜËØ∑Ê±ÇÁöÑÊó∂ÂÄôÁõ¥Êé•Â∞±ÂèØ‰ª•ÈÄöËøá<code>request.getHost()</code>„ÄÅ<code>request.getContext();</code>„ÄÅ<code>request.getWrapper();</code>ÊâæÂà∞ÂØπÂ∫îÁöÑÂÆπÂô®ÁªÑ‰ª∂ÁöÑpipelineÂéªÂ§ÑÁêÜËØ∑Ê±Ç„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ÂèÇÊï∞Á§∫‰æãÔºö map(&#34;localhost&#34;,&#34;/my-app/ping&#34;, null, mappingData)
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">MessageBytes</span><span class="w"> </span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">MessageBytes</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="n">MappingData</span><span class="w"> </span><span class="n">mappingData</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="na">isNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">defaultHostName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">defaultHostName</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">defaultHostName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">host</span><span class="p">.</span><span class="na">getCharChunk</span><span class="p">().</span><span class="na">append</span><span class="p">(</span><span class="n">defaultHostName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">host</span><span class="p">.</span><span class="na">toChars</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">uri</span><span class="p">.</span><span class="na">toChars</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">internalMap</span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="na">getCharChunk</span><span class="p">(),</span><span class="w"> </span><span class="n">uri</span><span class="p">.</span><span class="na">getCharChunk</span><span class="p">(),</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">mappingData</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÈáçÁÇπÊòØËøô‰∏™internalMapÊñπÊ≥ï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">internalMap</span><span class="p">(</span><span class="n">CharChunk</span><span class="w"> </span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">CharChunk</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">MappingData</span><span class="w"> </span><span class="n">mappingData</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Virtual host mapping</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MappedHost</span><span class="o">[]</span><span class="w"> </span><span class="n">hosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">hosts</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MappedHost</span><span class="w"> </span><span class="n">mappedHost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exactFindIgnoreCase</span><span class="p">(</span><span class="n">hosts</span><span class="p">,</span><span class="w"> </span><span class="n">host</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mappingData</span><span class="p">.</span><span class="na">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mappedHost</span><span class="p">.</span><span class="na">object</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Context mapping</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ContextList</span><span class="w"> </span><span class="n">contextList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mappedHost</span><span class="p">.</span><span class="na">contextList</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MappedContext</span><span class="o">[]</span><span class="w"> </span><span class="n">contexts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextList</span><span class="p">.</span><span class="na">contexts</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">contexts</span><span class="p">,</span><span class="w"> </span><span class="n">uri</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ContextVersion</span><span class="w"> </span><span class="n">contextVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ContextVersion</span><span class="o">[]</span><span class="w"> </span><span class="n">contextVersions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">versions</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">versionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextVersions</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">versionCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Context</span><span class="o">[]</span><span class="w"> </span><span class="n">contextObjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Context</span><span class="o">[</span><span class="n">contextVersions</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">contextObjects</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">contextObjects</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextVersions</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">object</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mappingData</span><span class="p">.</span><span class="na">contexts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextObjects</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">version</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">contextVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exactFind</span><span class="p">(</span><span class="n">contextVersions</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">contextVersion</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Return the latest version</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// The versions array is known to contain at least one element</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">contextVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextVersions</span><span class="o">[</span><span class="n">versionCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mappingData</span><span class="p">.</span><span class="na">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextVersion</span><span class="p">.</span><span class="na">object</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mappingData</span><span class="p">.</span><span class="na">contextSlashCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextVersion</span><span class="p">.</span><span class="na">slashCount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Wrapper mapping</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">contextVersion</span><span class="p">.</span><span class="na">isPaused</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">internalMapWrapper</span><span class="p">(</span><span class="n">contextVersion</span><span class="p">,</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="n">mappingData</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="ÂìçÂ∫îËøáÁ®ã">ÂìçÂ∫îËøáÁ®ã</h2>
<p>Âú®ÊúÄÁÆÄtomcat‰∏ÄËäÇ‰∏≠Êàë‰ª¨Áü•ÈÅìÂÖ∂ÂÆûÂìçÂ∫îÂ∞±ÊòØÂêësocketÂØπË±°ÁöÑoutputStream‰∏≠ÂÜôÂÖ•Êï∞ÊçÆÔºåËÄåtomcatÂ∞ÜËØ∑Ê±Ç‰∫§ÁªôservletÂ§ÑÁêÜÊó∂ÊòØÂ∞ÜÂ∞ÅË£ÖÂ•ΩÁöÑServletRequest Âíå ServletResponseÁöÑÈÉΩ‰∫§Áªô‰∫ÜservletÁöÑ„ÄÇ</p>
<blockquote>
<pre tabindex="0"><code>servlet.service(request, response);
</code></pre></blockquote>
<p>Áúã‰∏ãÈù¢Ëøô‰∏™ÁÆÄÂçïÁöÑServlet, ‰ª•Ëøô‰∏™servlet‰∏∫‰æãÊàë‰ª¨ÁúãÁúãHTTPÂìçÂ∫îÊòØÊÄé‰πàËøõË°åÁöÑ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleServlet</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">response</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">write</span><span class="p">(</span><span class="s">&#34;Pong!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ÈÄöËøá<code>response.getWriter().write(&quot;Pong!&quot;);</code> Êù•ÂìçÂ∫îÔºåÂìçÂ∫îÂÆåÂêéÊàë‰ª¨Â∞±ÂèØ‰ª•Âú®ÊµèËßàÂô®‰∏≠ÁúãÂà∞&quot;Pong!&quot;.</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/tomcat%E5%93%8D%E5%BA%94.png"
	width="2919"
	height="742"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/tomcat%E5%93%8D%E5%BA%94_hud89dadefebfab05ab03ccab5bcabede2_204672_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/tomcat%E5%93%8D%E5%BA%94_hud89dadefebfab05ab03ccab5bcabede2_204672_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="tomcatÂìçÂ∫î"
	
	
		class="gallery-image" 
		data-flex-grow="393"
		data-flex-basis="944px"
	
></p>
<p>‚Äã</p>
<p>ÂèØ‰ª•ÁúãÂà∞ÂÜôÂÖ•ÂìçÂ∫îÊó∂‰ºöÂÖàÂÜôÂÖ•ÁºìÂ≠ò‰∏≠ÔºåÊúÄÂêéÁªü‰∏ÄÂ∞ÜÁºìÂ≠òÊï∞ÊçÆÂà∑Êñ∞Âà∞socket‰∏≠„ÄÇ</p>
<h2 id="pipeline-Âíå-valve">Pipeline Âíå Valve</h2>
<p><code>pipeline</code> ÊòØ<code>ContainerBase</code> ÊäΩË±°Á±ª‰∏≠ÁöÑ‰∏Ä‰∏™Â±ûÊÄß, ÂÖ∑‰ΩìÂÆû‰æãÂåñ‰∫Ü‰∏Ä‰∏™StandardPipelineÔºåÂπ∂ÈÄöËøá<code>Container</code> Êé•Âè£Êö¥Èú≤‰∫ÜgetPipelineÊñπÊ≥ïÔºåÊâÄ‰ª•Engine, Context, Host, WrapperÁ≠âÁªÑ‰ª∂ÈÉΩ‰ºöÊúâËøô‰∏™Â±ûÊÄß„ÄÇËÄåpipeline‰∏≠Áª¥Êä§ÁöÑÊòØ‰∏ÄÁ≥ªÂàóÁöÑValve„ÄÇ</p>
<h3 id="pipeline">Pipeline</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Pipeline</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Contained</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Valve</span><span class="w"> </span><span class="nf">getBasic</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setBasic</span><span class="p">(</span><span class="n">Valve</span><span class="w"> </span><span class="n">valve</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addValve</span><span class="p">(</span><span class="n">Valve</span><span class="w"> </span><span class="n">valve</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Valve</span><span class="o">[]</span><span class="w"> </span><span class="nf">getValves</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">removeValve</span><span class="p">(</span><span class="n">Valve</span><span class="w"> </span><span class="n">valve</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Valve</span><span class="w"> </span><span class="nf">getFirst</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAsyncSupported</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">findNonAsyncValves</span><span class="p">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="valve">Valve</h3>
<p>ValveÊòØ‰∏Ä‰∏™Á±ª‰ººÂçïÂêëÈìæË°®ÁöÑÁªìÊûÑÔºåÂèØ‰ª•ÈÄöËøá<code>getNext</code> ÊâæÂà∞‰∏ã‰∏Ä‰∏™Valve, Âπ∂‰∏îÊúâ‰∏Ä‰∏™Ê†∏ÂøÉÊñπÊ≥ï<code>invoke(Request request, Response response)</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Valve</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Valve</span><span class="w"> </span><span class="nf">getNext</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setNext</span><span class="p">(</span><span class="n">Valve</span><span class="w"> </span><span class="n">valve</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">backgroundProcess</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ServletException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAsyncSupported</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><blockquote>
<p>ËøôÊó∂ÂÄôÂÜçÊù•ÂõûÈ°æ<code>connector.getService().getContainer().getPipeline().getFirst().invoke(request,response)</code>ËøôÊÆµAdapterÁöÑservice ÊñπÊ≥ïÂ∞ÜËØ∑Ê±Ç‰∫§ÁªôÂÆπÂô®Â§ÑÁêÜÁöÑ‰ª£Á†ÅÔºåÂ∞±ËÉΩÊòéÁôΩ‰∫Ü.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StandardPipeline</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">LifecycleBase</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Pipeline</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">//Ë∞ÉÁî®getFirst ÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÊúâfirstÂ∞±ËøîÂõûÂê¶ÂàôËøîÂõûbasic  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Valve</span><span class="w"> </span><span class="nf">getFirst</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">first</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">basic</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="valveÊòØÊÄé‰πàÊ∑ªÂä†ÁöÑ">ValveÊòØÊÄé‰πàÊ∑ªÂä†ÁöÑ</h3>
<ul>
<li>
<p>StandardEngine</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219111936769.png"
	width="1908"
	height="640"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219111936769_hu0cd360a6832c9cfa5182b22003297a28_152461_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219111936769_hu0cd360a6832c9cfa5182b22003297a28_152461_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240219111936769"
	
	
		class="gallery-image" 
		data-flex-grow="298"
		data-flex-basis="715px"
	
></p>
</li>
<li>
<p>StandardHost</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219112157125.png"
	width="1256"
	height="332"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219112157125_hu361a2aa321ef98f0e22eebba95804047_37319_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219112157125_hu361a2aa321ef98f0e22eebba95804047_37319_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240219112157125"
	
	
		class="gallery-image" 
		data-flex-grow="378"
		data-flex-basis="907px"
	
></p>
<p>ÊûÑÈÄ†ÂáΩÊï∞‰∏≠‰πüÊòØÈªòËÆ§ËÆæÁΩÆ‰∫Ü‰∏Ä‰∏™basic valve,  Êàë‰ª¨ËøòÂèØ‰ª•ÈÄöËøáweb.xml Êù•ÈÖçÁΩÆÔºåËøôÂÖ∂ÂÆûÊòØtomcat ÁïôÁªôÊàë‰ª¨ÁöÑÊâ©Â±ïÁÇπ„ÄÇ</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219112739302.png"
	width="2494"
	height="978"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219112739302_hu545b2ec9a3dfb5640dd0177a4056ff40_222474_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219112739302_hu545b2ec9a3dfb5640dd0177a4056ff40_222474_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240219112739302"
	
	
		class="gallery-image" 
		data-flex-grow="255"
		data-flex-basis="612px"
	
></p>
<p>ÈÇ£ÂØπ‰∫éHostËÄåË®ÄËøô‰∏§‰∏™valveÁöÑÈ°∫Â∫èÊòØ‰ªÄ‰πàÂë¢Ôºü</p>
<p>È¶ñÂÖàËÇØÂÆöÊòØÊâßË°åHostÁªÑ‰ª∂ÁöÑÊûÑÈÄ†ÂáΩÊï∞ÔºåÊâÄ‰ª•‰ºöÂÖàËÆæÁΩÆbasic valve, ÁÑ∂ÂêéËß£ÊûêÂà∞<code>&lt;Valve&gt;</code> Ê†áÁ≠æ‰ºöÊ†πÊçÆÈÖçÁΩÆÁöÑdigister <code>SetNextRule</code> Êù•Ë∞ÉÁî®addValve.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addValve</span><span class="p">(</span><span class="n">Valve</span><span class="w"> </span><span class="n">valve</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valve</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">valve</span><span class="p">.</span><span class="na">setNext</span><span class="p">(</span><span class="n">basic</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Valve</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">first</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="na">getNext</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">basic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">current</span><span class="p">.</span><span class="na">setNext</span><span class="p">(</span><span class="n">valve</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">valve</span><span class="p">.</span><span class="na">setNext</span><span class="p">(</span><span class="n">basic</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="p">.</span><span class="na">getNext</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ÂèØ‰ª•ÁúãÂà∞Â¶ÇÊûúpipeline ‰∏≠first‰∏∫null, Âàôserver.xml ‰∏≠ÈÖçÁΩÆÁöÑÁ¨¨‰∏Ä‰∏™valveÂ∞±ÊòØfirst, Â¶ÇÊûúfirst‰∏ç‰∏∫Á©∫ÔºåÂ∞±ÊääËøô‰∏™valve ‰Ωú‰∏∫first ÁöÑ‰∏ã‰∏Ä‰∏™ËäÇÁÇπÔºå basic Ê∞∏ËøúÊòØÈìæË°®‰∏≠ÊúÄÂêé‰∏Ä‰∏™ËäÇÁÇπ„ÄÇ</p>
</li>
<li>
<p>StandardContext</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219113136664.png"
	width="1646"
	height="540"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219113136664_hu0bd6e7ef73cab5d280aba3302b37e837_116255_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219113136664_hu0bd6e7ef73cab5d280aba3302b37e837_116255_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240219113136664"
	
	
		class="gallery-image" 
		data-flex-grow="304"
		data-flex-basis="731px"
	
></p>
</li>
<li>
<p>StandardWrapper</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219113212734.png"
	width="1812"
	height="370"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219113212734_hu62c2f15c36ae95875203524bbd56512a_68035_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240219113212734_hu62c2f15c36ae95875203524bbd56512a_68035_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240219113212734"
	
	
		class="gallery-image" 
		data-flex-grow="489"
		data-flex-basis="1175px"
	
></p>
</li>
</ul>
<p><strong>Â∞èÁªì</strong></p>
<ol>
<li>Engine/Host/Context/Wrapper ÁªÑ‰ª∂Âú®ÂàùÂßãÂåñÁöÑÊûÑÈÄ†ÊñπÊ≥ï‰∏≠‰ºöËÆæÁΩÆbasic valve</li>
<li>Êàë‰ª¨ÂèØ‰ª•ÈÄöËøáÈÖçÁΩÆÊñá‰ª∂ÁöÑÊñπÂºèÊ∑ªÂä†ÂÖ∂‰ªñvalve, Ê∑ªÂä†ÁöÑÁ¨¨‰∏Ä‰∏™valve ‰ºö‰Ωú‰∏∫first value, ‰æùÊ¨°ÊûÑÂª∫‰∏Ä‰∏™ÈìæË°®Ôºåbasic valve‰ºö‰Ωú‰∏∫ÈìæË°®‰∏äÊúÄÂêé‰∏Ä‰∏™ËäÇÁÇπ</li>
</ol>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Pipeline-and-Valve.png"
	width="1111"
	height="297"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Pipeline-and-Valve_hu70302cdf17f08567660ed68195d87643_45580_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Pipeline-and-Valve_hu70302cdf17f08567660ed68195d87643_45580_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Pipeline ÂíåValve"
	
	
		class="gallery-image" 
		data-flex-grow="374"
		data-flex-basis="897px"
	
></p>
<h3 id="valve-‰ªÄ‰πàÊó∂ÂÄô‰ºöËøêË°å">Valve ‰ªÄ‰πàÊó∂ÂÄô‰ºöËøêË°å</h3>
<ol>
<li>ËØ∑Ê±ÇÂà∞ËææÂÆπÂô®‰πãÂâç‰ºöÁî±AdapterÁöÑservice ÊñπÊ≥ïÂ∞ÜËØ∑Ê±Ç‰∫§ÁªôÂÆπÂô®ÔºåÂÖ≥ÈîÆÊñπÊ≥ïÊòØ<code>connector.getService().getContainer().getPipeline().getFirst().invoke(request,response)</code></li>
<li>Ê≠§Êó∂‰ºöË∞ÉÁî®Engine ÁöÑfirst valveÁöÑinvoke ÊñπÊ≥ï, Â¶ÇÊûúÊ≤°Êúâfirst ÂàôË∞ÉÁî® basic value.</li>
<li>ÂΩìÊüê‰∏ÄÂ±ÇÂÆπÂô®ÁöÑpipeline ‰∏≠ÊúâÂ§ö‰∏™valveÊó∂ÔºåÂú®‰∏Ä‰∏™valveÊâßË°åÁöÑÊúÄÂêé‰ºöÈÄöËøá<code>getNext().invoke(request, response);</code>Ë∞ÉÁî®‰∏ã‰∏Ä‰∏™Valve, Áõ¥Âà∞ÊúÄÂêéË∞ÉÁî®Âà∞basic valve</li>
<li>basic valveÊòØvalve Èìæ‰∏≠ÊúÄÂêé‰∏Ä‰∏™ËäÇÁÇπ(ÊúÄÂêéÊâßË°åÔºâÔºåËøôÊó∂‰∏äÂ±ÇÂÆπÂô®Âèà‰ºöË∞ÉÁî®‰∏ã‰∏ÄÂ±ÇÂÆπÂô®ÁöÑpipeline ‰∏≠ÁöÑvalve ÁöÑinvoke ÊñπÊ≥ïÔºå‰æùÊ¨°Á±ªÊé®</li>
</ol>
<h2 id="tomcatÁöÑÁ±ªÂä†ËΩΩÊú∫Âà∂">TomcatÁöÑÁ±ªÂä†ËΩΩÊú∫Âà∂</h2>
<p>Âú®ËØ∑Ê±ÇÂ§ÑÁêÜËøáÁ®ãÁöÑÂàÜÊûê‰∏≠ÔºåÊàë‰ª¨ÊèêÂà∞ÊúÄÂêétomcat‰ºöÂ∞ÜËØ∑Ê±Ç‰∫§ÁªôservletÊù•Â§ÑÁêÜÔºå‰ΩÜservletÊòØ‰ªÄ‰πàÊó∂ÂÄôË¢´Âä†ËΩΩÂíåÂàùÂßãÂåñÁöÑÂë¢Ôºü</p>
<p>ÂèØËÉΩÊúÄÂø´ÊÉ≥Âà∞ÁöÑÊòØÂà©Áî®Á±ªÂä†ËΩΩÂô®ÂéªÂä†ËΩΩwebapp ÂêÑ‰∏™Â∫îÁî®‰∏ãÈù¢ÁöÑclasses Êñá‰ª∂ÔºåÊää‰ªñ‰ª¨ÂèòÊàêÂèØÊâßË°åÁöÑÂØπË±°Ôºå‰ΩÜÊòØÂÄòËã•‰∏çÂêåÁöÑÂ∫îÁî®‰∏ãÈù¢ÂÅáÂ¶ÇÈÉΩÊúâ‰∏Ä‰∏™<code>MyApp</code> Á±ªÔºåÁ±ªÂêçÁõ∏Âêå‰ΩÜÊòØÂÆûÁé∞‰∏çÂêåÔºåtomcatÊú¨Ë∫´ÊòØ‰∏Ä‰∏™javaËøõÁ®ãÔºåÊ†πÊçÆJdkÁöÑÂèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÔºåÂ¶ÇÊûú‰∏çÂÅöÂ§ÑÁêÜÂΩìÂ∞ùËØïÂéªÂä†ËΩΩÁ¨¨‰∫å‰∏™MyApp ÁöÑÊó∂ÂÄô‰ºöÂ§çÁî®‰πãÂâçÂ∑≤ÁªèÂä†ËΩΩÂ•ΩÁöÑMyApp(‰∏∫‰ªÄ‰πà?), ‰ªéËÄåÂØºËá¥Ë°å‰∏∫ÂíåÈ¢ÑÊúüÁöÑ‰∏ç‰∏ÄËá¥ÔºåÊâÄ‰ª•tomcat ‰∏∫‰∫ÜÈöîÁ¶ªÂêÑ‰∏™Â∫îÁî®Ôºå‰ºöÊâìÁ†¥Ëøô‰∏™Âèå‰∫≤ÂßîÊ¥æÊ®°Âûã„ÄÇ</p>
<h3 id="jdkÁ±ªÂä†ËΩΩÂô®‰∏éÂèå‰∫≤ÂßîÊ¥æÊ®°Âûã">JDKÁ±ªÂä†ËΩΩÂô®‰∏éÂèå‰∫≤ÂßîÊ¥æÊ®°Âûã</h3>
<h4 id="‰ªÄ‰πàÊòØÁ±ªÂä†ËΩΩÂô®">‰ªÄ‰πàÊòØÁ±ªÂä†ËΩΩÂô®Ôºü</h4>
<p>ËØ¥ÁôΩ‰∫ÜÔºåÊàë‰ª¨ÂÜôÁöÑ‰ª£Á†ÅÊòØÂ≠òÂú®‰ª•<code>java</code> ‰∏∫ÂêéÁºÄÁöÑÊñá‰ª∂‰∏≠ÔºåÁÑ∂ÂêéJDKÈÄöËøáÁºñËØëÂô®Â∞Üjava Êñá‰ª∂ÁºñËØëÊàêclassÊñá‰ª∂Ôºå‰πüÂ∞±ÊòØÂ≠óËäÇÁ†ÅÊñá‰ª∂Ôºå‰ΩÜÂ≠óËäÇÁ†ÅÊòØ‰∏ÄÁßç‰∏çËÉΩÁî±Á°¨‰ª∂Áõ¥Êé•ÊâßË°åÁöÑ‰∏≠Èó¥‰ª£Á†ÅÔºåÂè™ËÉΩË¢´JVMË£ÖËΩΩÂπ∂Ëß£ÈáäÊâßË°åÔºåÁÑ∂ÂêéÁ±ªÂä†ËΩΩÂô®ÁöÑ‰ΩúÁî®Â∞±ÊòØÊääËøô‰∫õËøô‰∫õÂ≠óËäÇÁ†ÅÂä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠Âπ∂Âú®ÂÜÖÂ≠ò‰∏≠ÁîüÊàê‰∏Ä‰∏™‰ª£Ë°®ËØ•Á±ªÁöÑClassÂØπË±°Ôºå ÊúÄÂêéÁî±ÊâßË°åÂô®ÊääÂÆÉÁøªËØëÊàêÊú∫Âô®Á†ÅÁÑ∂Âêé‰∫§ÁªôÊú∫Âô®ÊâßË°å„ÄÇ</p>
<p>JavaËôöÊãüÊú∫ÂÆö‰πâ‰∫Ü‰∏âÁßçÁ±ªÂä†ËΩΩÂô®Ôºö</p>
<ul>
<li><strong>ÂêØÂä®Á±ªÂä†ËΩΩÂô®</strong>ÔºàBootstrap Class LoaderÔºâÔºö ÈÄöÂ∏∏Áî±Êú¨Âú∞‰ª£Á†ÅÂÆûÁé∞Ôºå‰πüÁß∞‰∏∫Ê†πÁ±ªÂä†ËΩΩÂô®ÔºåÂÆÉË¥üË¥£Âä†ËΩΩ%JAVA_HOME%/libË∑ØÂæÑ‰∏ãJavaËôöÊãüÊú∫ÁöÑÊ†∏ÂøÉÁ±ªÂ∫ì</li>
<li><strong>Êâ©Â±ïÁ±ªÂä†ËΩΩÂô®</strong>ÔºàExtension Class LoaderÔºâÔºöÂÆÉÊòØÁî®Êù•Âä†ËΩΩJavaÊâ©Â±ïÁ±ªÂ∫ìÁöÑÁ±ªÂä†ËΩΩÂô®„ÄÇÊâ©Â±ïÁ±ªÂ∫ìÂåÖÊã¨<code>javax</code>Âíå<code>java.util</code>Á≠âÂåÖÔºåÂÆÉ‰ª¨‰Ωç‰∫é<code>jre/lib/ext</code>ÁõÆÂΩï‰∏ã</li>
<li><strong>Â∫îÁî®Á®ãÂ∫èÁ±ªÂä†ËΩΩÂô®</strong>ÔºàApplication Class LoaderÔºâÔºö‰πüÁß∞‰∏∫Á≥ªÁªüÁ±ªÂä†ËΩΩÂô®ÔºåÂÆÉË¥üË¥£Âä†ËΩΩ%CLASSPATH%Ë∑ØÂæÑ‰∏ãÂ∫îÁî®Á®ãÂ∫èÁöÑÁ±ª„ÄÇ</li>
</ul>
<p>Êàë‰ª¨Âú®ÂêØÂä®javaËøõÁ®ãÁöÑÊó∂ÂÄôÈÄöÂ∏∏ÈúÄË¶Å‰º†ÈÄí‰∏Ä‰∏™<code>classpath</code> ÂèÇÊï∞Ôºå‰æãÂ¶ÇÈÄöËøáIDEA Ê∫êÁ†ÅÂêØÂä®tomcatÊó∂ÂèØ‰ª•Âú®ÊéßÂà∂Âè∞ÁúãÂà∞ÂêØÂä®ÂëΩ‰ª§Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/Users/hf/Documents/developer/jdk/zulu21.30.15-ca-jdk21.0.1-macosx_aarch64/bin/java -agentlib:jdwp<span class="o">=</span><span class="nv">transport</span><span class="o">=</span>dt_socket,address<span class="o">=</span>127.0.0.1:64807,suspend<span class="o">=</span>y,server<span class="o">=</span>n 
</span></span><span class="line"><span class="cl">-Dcatalina.home<span class="o">=</span>/Users/hf/IdeaProjects/tomcat/output/build/ 
</span></span><span class="line"><span class="cl">-Dcatalina.base<span class="o">=</span>/Users/hf/IdeaProjects/tomcat/output/build/ 
</span></span><span class="line"><span class="cl">-javaagent:/Users/hf/Library/Caches/JetBrains/IntelliJIdea2024.1/captureAgent/debugger-agent.jar 
</span></span><span class="line"><span class="cl">-Dfile.encoding<span class="o">=</span>UTF-8 -Dsun.stdout.encoding<span class="o">=</span>UTF-8 
</span></span><span class="line"><span class="cl">-Dsun.stderr.encoding<span class="o">=</span>UTF-8 
</span></span><span class="line"><span class="cl">-classpath /Users/hf/IdeaProjects/tomcat/.idea/output/production/tomcat:/opt/homebrew/Cellar/ant/1.10.14/libexec/lib/ant.jar ...
</span></span><span class="line"><span class="cl">org.apache.catalina.startup.Bootstrap
</span></span></code></pre></div><p>ÂèØ‰ª•ÁúãÂà∞‰º†ÈÄí‰∫ÜclasspathÂèÇÊï∞Ôºå‰∏ç‰º†ÈÄíÂàôÈªòËÆ§ÂΩìÂâçÁõÆÂΩï„ÄÇÊàë‰ª¨Ëá™Â∑±ÂÜôÁöÑjava‰ª£Á†ÅÈÄöÂ∏∏Áî±App class loader Êù•Âä†ËΩΩ„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">loadedClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassLoader</span><span class="p">.</span><span class="na">getSystemClassLoader</span><span class="p">().</span><span class="na">loadClass</span><span class="p">(</span><span class="s">&#34;org.apache.catalina.startup.MyClass&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MyClass</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span><span class="w"> </span><span class="n">loadedClass</span><span class="p">.</span><span class="na">getDeclaredConstructor</span><span class="p">().</span><span class="na">newInstance</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">object</span><span class="p">.</span><span class="na">hi</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NoSuchMethodException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">InstantiationException</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">InvocationTargetException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">class</span> <span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">hi</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Hello, class loader!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span></code></pre></div><h4 id="Ëá™ÂÆö‰πâÁ±ªÂä†ËΩΩÂô®">Ëá™ÂÆö‰πâÁ±ªÂä†ËΩΩÂô®</h4>
<p>Ëá™ÂÆö‰πâÁöÑÁ±ªÂä†ËΩΩÂô®ÂøÖÈ°ªÁªßÊâø<code>java.lang.ClassLoader</code>, Âπ∂Ë¶ÜÂÜô<code>findClass</code>ÊñπÊ≥ïÔºåfindClass ÊñπÊ≥ï‰ºöË¢´loadClassË∞ÉÁî®Ôºå‰∏ãÈù¢ÊòØClassloaderÁ±ª‰∏≠loadClass ÊñπÊ≥ï</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">loadClass</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">resolve</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">getClassLoadingLock</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// First, check if the class has already been loaded</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findLoadedClass</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">long</span><span class="w"> </span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">nanoTime</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findBootstrapClassOrNull</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// ClassNotFoundException thrown if class not found</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// from the non-null parent class loader</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// If still not found, then invoke findClass in order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// to find the class.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kt">long</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">nanoTime</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findClass</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// this is the defining class loader; record the stats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">PerfCounter</span><span class="p">.</span><span class="na">getParentDelegationTime</span><span class="p">().</span><span class="na">addTime</span><span class="p">(</span><span class="n">t1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">PerfCounter</span><span class="p">.</span><span class="na">getFindClassTime</span><span class="p">().</span><span class="na">addElapsedTimeFrom</span><span class="p">(</span><span class="n">t1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">PerfCounter</span><span class="p">.</span><span class="na">getFindClasses</span><span class="p">().</span><span class="na">increment</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">resolveClass</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ÂèØ‰ª•ÁúãÂà∞Âü∫Êú¨ÊµÅÁ®ãÂ∞±ÊòØ:</p>
<ol>
<li>Êü•ÁúãÊüê‰∏™Á±ªÊòØÂê¶Â∑≤ÁªèË¢´Âä†ËΩΩÔºå‰ºöÈÄöËøáË∞ÉÁî®native ÊñπÊ≥ïfindLoadedClass0ÔºåÂ¶ÇÊûúÂ∑≤ÁªèÂä†ËΩΩÂ∞±ËøîÂõû</li>
<li>Â¶ÇÊûúÊ≤°Ë¢´Âä†ËΩΩÂ∞±ÂÖàÂ∞ùËØïÁî®Áà∂Á±ªÂä†ËΩΩÂô®(Extention class loader)Âä†ËΩΩ</li>
<li>Áà∂Á±ªÂä†ËΩΩÂô®ËøòÂä†ËΩΩ‰∏çÂà∞ÁöÑËØùÂ∞±‰ºöË∞ÉÁî®findClassÊñπÊ≥ï</li>
</ol>
<p>ËøôÂíåÊàë‰ª¨ÊâÄÁÜüÁü•ÁöÑÂèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÁöÑÊÄùÊÉ≥ÊòØ‰∏ÄÊ†∑ÁöÑÔºå‰∏ãÈù¢ÁªôÂá∫‰∏Ä‰∏™findClass ÁöÑÂÜôÊ≥ïÁ§∫‰æãÔºö</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">findClass</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// class Êñá‰ª∂ÂèØ‰ª•ÊîæÂà∞‰ªª‰ΩïÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fileInputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">&#34;/Users/hf/IdeaProjects/tomcat/MyClass.class&#34;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileInputStream</span><span class="p">.</span><span class="na">readAllBytes</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">defineClass</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">bytes</span><span class="p">.</span><span class="na">length</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÊµãËØï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testClassLoader</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">MyClassLoader</span><span class="w"> </span><span class="n">myClassLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyClassLoader</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">loadedClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myClassLoader</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="s">&#34;MyClass&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadedClass</span><span class="p">.</span><span class="na">getDeclaredConstructor</span><span class="p">().</span><span class="na">newInstance</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadedClass</span><span class="p">.</span><span class="na">getMethod</span><span class="p">(</span><span class="s">&#34;hi&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">object</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NoSuchMethodException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">InstantiationException</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">InvocationTargetException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="tomcatÁöÑÁ±ªÂä†ËΩΩÂô®">TomcatÁöÑÁ±ªÂä†ËΩΩÂô®</h3>
<p>Tomcat Êã•Êúâ‰∏çÂêåÁöÑËá™ÂÆö‰πâÁ±ªÂä†ËΩΩÂô®Ôºå‰ª•ÂÆûÁé∞ÂØπÂêÑÁßçËµÑÊ∫êÂ∫ìÁöÑÊéßÂà∂„ÄÇ‰∏ÄËà¨Êù•ËØ¥ÔºåTomcat ‰∏ªË¶ÅÁî®Á±ªÂä†ËΩΩÂô®Ëß£ÂÜ≥‰ª•‰∏ã 4 ‰∏™ÈóÆÈ¢ò„ÄÇ</p>
<ul>
<li>
<p>ÂêÑ‰∏™WebÂ∫îÁî®‰πãÈó¥ÂêÑËá™‰ΩøÁî®ÁöÑJavaÁ±ªÂ∫ìË¶Å<strong>‰∫íÁõ∏ÈöîÁ¶ª</strong> &mdash; WebappClassLoader„ÄÇ</p>
</li>
<li>
<p>ÂêÑ‰∏™WebÂ∫îÁî®‰πãÈó¥ÂèØ‰ª•<strong>Êèê‰æõÂÖ±‰∫´</strong>ÁöÑJavaÁ±ªÂ∫ì &mdash; SharedClassLoader„ÄÇ</p>
</li>
<li>
<p>TomcatÊú¨Ë∫´ÁöÑÁ±ªÂíåWebÂ∫îÁî®ÁöÑÁ±ªË¶Å<strong>‰∫íÁõ∏ÈöîÁ¶ª</strong> &mdash; CatalinaClassLoader„ÄÇ</p>
</li>
</ul>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Tomcat%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.png"
	width="1123"
	height="759"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Tomcat%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8_hu4d6539e87a4b9aabb92808e52e832412_102792_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/Tomcat%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8_hu4d6539e87a4b9aabb92808e52e832412_102792_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Tomcat Á±ªÂä†ËΩΩÂô®"
	
	
		class="gallery-image" 
		data-flex-grow="147"
		data-flex-basis="355px"
	
></p>
<p>WebappClassLoaderBaseÁöÑstartÊñπÊ≥ïÁöÑÊ∫ê‰ª£Á†Å‰∏≠Âπ∂Ê≤°ÊúâÁúãÂà∞Êàë‰ª¨‰ª•‰∏∫ÁöÑ<code>findClass</code> Êàñ<code>loadClass</code> Êìç‰ΩúÔºåÈÇ£Âä†ËΩΩservletÊòØ‰ªÄ‰πàÊó∂ÂÄôËøõË°åÁöÑÔºü</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// WebappClassLoaderBaseÁöÑstartÊñπÊ≥ï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">LifecycleException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LifecycleState</span><span class="p">.</span><span class="na">STARTING_PREP</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">WebResource</span><span class="o">[]</span><span class="w"> </span><span class="n">classesResources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resources</span><span class="p">.</span><span class="na">getResources</span><span class="p">(</span><span class="s">&#34;/WEB-INF/classes&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">WebResource</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">classesResources</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">classes</span><span class="p">.</span><span class="na">isDirectory</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">classes</span><span class="p">.</span><span class="na">canRead</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">localRepositories</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">classes</span><span class="p">.</span><span class="na">getURL</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">WebResource</span><span class="o">[]</span><span class="w"> </span><span class="n">jars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resources</span><span class="p">.</span><span class="na">listResources</span><span class="p">(</span><span class="s">&#34;/WEB-INF/lib&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">WebResource</span><span class="w"> </span><span class="n">jar</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">jars</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jar</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">endsWith</span><span class="p">(</span><span class="s">&#34;.jar&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">jar</span><span class="p">.</span><span class="na">isFile</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">jar</span><span class="p">.</span><span class="na">canRead</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">localRepositories</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">jar</span><span class="p">.</span><span class="na">getURL</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">jarModificationTimes</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jar</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">Long</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">jar</span><span class="p">.</span><span class="na">getLastModified</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LifecycleState</span><span class="p">.</span><span class="na">STARTED</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Á≠îÊ°àÊòØÊúâ‰∏§Ê¨°„ÄÇ</p>
<p>Á¨¨‰∏ÄÊ¨°ÈÄöËøáLifeCycleEventÂ§ÑÁêÜÊ≥®Ëß£Êó∂Âä†ËΩΩÁöÑ„ÄÇ</p>
<p><code>StandardContext#startInternal</code> -&gt; <code>fireLifecycleEvent(Lifecycle.CONFIGURE_START_EVENT, null)</code> -&gt; <code>ContextConfig#lifecycleEvent</code> -&gt; <code>configureStart</code> -&gt; <code>applicationAnnotationsConfig</code> -&gt; <code>WebAnnotationSet.loadApplicationAnnotations(context)</code> -&gt; <code>WebAnnotationSet#loadApplicationServletAnnotations</code> -&gt; <code>Introspection.loadClass(context, wrapper.getServletClass())</code> -&gt; <code>cl.loadClass(className)</code></p>
<p>Á¨¨‰∫åÊ¨°ÊòØËØ∑Ê±ÇÂà∞Êù•Êó∂ÂéªÂ∞ùËØïÂä†ËΩΩÂπ∂ÂÆû‰æãÂåñServlet, Á¨¨‰∏ÄÊ¨°Â¶ÇÊûúÂ∑≤ÁªèÂä†ËΩΩ‰∫ÜclassÂàô‰ºöÂ§çÁî®„ÄÇ</p>
<p><code>StandardWrapper#invoke</code> -&gt; <code>StandardWrapper#allocate</code> -&gt; <code>StandardWrapper#loadServlet</code> -&gt; <code>InstanceManager.newInstance(servletClass)</code> -&gt; <code>DefaultInstanceManager#newInstance</code> -&gt; <code>classLoader.loadClass(className)</code></p>
<h3 id="tomcat-ÊòØÂ¶Ç‰ΩïÊâìÁ†¥Âèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÁöÑ">Tomcat ÊòØÂ¶Ç‰ΩïÊâìÁ†¥Âèå‰∫≤ÂßîÊ¥æÊ®°ÂûãÁöÑÔºü</h3>
<p>‰∫ÜËß£Ëøô‰∏™ÈóÆÈ¢òÈúÄË¶ÅÁúãWebappClassLoaderBaseÁöÑÊ∫êÁ†ÅÔºåÈáçÁÇπÊòØfindClass ÊñπÊ≥ïÂíåloadClass ÊñπÊ≥ï</p>
<p><strong>loadClass</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">loadClass</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">resolve</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">JreCompat</span><span class="p">.</span><span class="na">isGraalAvailable</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">getClassLoadingLock</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">..</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// (0) Check our previously loaded local class cacheÔºåÊ£ÄÊü•tomcatËá™Â∑±ÁöÑÁºìÂ≠ò</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findLoadedClass0</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// (0.1) Check our previously loaded class cache, Ê£ÄÊü•jvmÁöÑÁºìÂ≠ò</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JreCompat</span><span class="p">.</span><span class="na">isGraalAvailable</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">findLoadedClass</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// (0.2) Try loading the class with the bootstrap class loader, to prevent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//       the webapp from overriding Java SE classes. This implements</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//       SRV.10.7.2Ôºå Èò≤Ê≠¢Ë¶ÜÁõñÁ≥ªÁªüÁöÑÊ†∏ÂøÉÁ±ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">resourceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binaryNameToPath</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">javaseLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getJavaseClassLoader</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">tryLoadingFromJavaseLoader</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">....</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tryLoadingFromJavaseLoader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">javaseLoader</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// (0.5) Permission to access this class when using a SecurityManager</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">delegateLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delegate</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// (1) Delegate to our parent if requested, Â¶ÇÊûúÈÖçÁΩÆ‰∫ÜÁî®Áà∂Âä†ËΩΩÂô®Âä†ËΩΩÂ∞±Áî®Áà∂Âä†ËΩΩÂô®ÔºåÈªòËÆ§false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delegateLoad</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">..</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// (2) Search local repositories</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="na">isDebugEnabled</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&#34;  Searching local repositories&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findClass</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Ignore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// (3) Delegate to parent unconditionally, Â¶ÇÊûú‰∏ç‰ΩøÁî®Áà∂Âä†ËΩΩÂô®Ôºå‰ΩÜËá™Â∑±ÂèàÊ≤°ÊúâÊâæÂà∞Â∞±ËøòÊòØÁî®Áà∂Âä†ËΩΩÂô®Êâæ‰∏ÄÈÅç</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">delegateLoad</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">						</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>findClass</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">findClass</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// (1) Permission to define this class when using a SecurityManager</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">..</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ask our superclass to locate this class, if possible</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// (throws ClassNotFoundException if it is not found)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">securityManager</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findClassInternal</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">AccessControlException</span><span class="w"> </span><span class="n">ace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">clazz</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">hasExternalRepositories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">findClass</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="n">AccessControlException</span><span class="w"> </span><span class="n">ace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Return the class we have located</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>findClassInternal</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">findClassInternal</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binaryNameToPath</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ResourceEntry</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resourceEntries</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="na">loadedClass</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">JreCompat</span><span class="p">.</span><span class="na">isGraalAvailable</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">getClassLoadingLock</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="na">loadedClass</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       	</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">binaryContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resource</span><span class="p">.</span><span class="na">getContent</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Ë∞ÉÁî®jdkÁöÑAPIÂéªÂä†ËΩΩÁ±ª </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defineClass</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">binaryContent</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">binaryContent</span><span class="p">.</span><span class="na">length</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CodeSource</span><span class="p">(</span><span class="n">codeBase</span><span class="p">,</span><span class="w"> </span><span class="n">certificates</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnsupportedClassVersionError</span><span class="w"> </span><span class="n">ucve</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">entry</span><span class="p">.</span><span class="na">loadedClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Â∞èÁªì</strong></p>
<ul>
<li>ÂÖàÂú®Êú¨Âú∞tomcatÁºìÂ≠ò‰∏≠Êü•ÊâæËØ•Á±ªÊòØÂê¶Â∑≤ÁªèÂä†ËΩΩËøáÔºåÂ¶ÇÊûúÂä†ËΩΩËøáÂ∞±ËøîÂõûÁºìÂ≠ò‰∏≠ÁöÑ„ÄÇ</li>
<li>Â¶ÇÊûúÊú¨Âú∞ÁºìÂ≠òÊ≤°ÊúâÂ∞±ÂéªJVM‰∏≠Êü•ÊâæÊòØÂê¶Â∑≤ÁªèÂä†ËΩΩËøáÔºåÊúâÂ∞±ËøîÂõû„ÄÇ</li>
<li>Â¶ÇÊûúÁºìÂ≠òÈáåÈÉΩÊ≤°ÊúâÔºåÂßîÊâòÁªô bootstrap class loaderÂéªÂä†ËΩΩÔºåÈò≤Ê≠¢Ë¶ÜÁõñÁ≥ªÁªüÁöÑÊ†∏ÂøÉÁ±ªÂ∫ì„ÄÇ</li>
<li>Â¶ÇÊûúËøòÊ≤°Âä†ËΩΩÂà∞ËØ¥Êòé‰∏çÊ†∏ÂøÉÂ∫ì‰∏≠Ê≤°ÊúâËøô‰∏™Á±ªÔºåÈÇ£Â∞±WebappClassLoaderBaseËá™Â∑±ÂéªÂä†ËΩΩÔºåË∞ÉÁî®findClassÊñπÊ≥ï„ÄÇ</li>
<li>findClass ‰∏≠ÊúÄÁªà‰ºöÈÄöËøáË∞ÉÁî®findClassInternalÊù•Âä†ËΩΩÔºåÊâæ‰∏çÂà∞‰ºöÂÜçÊ¨°Â∏∏Áî®Áî®Áà∂Á±ªÂä†ËΩΩÂô®Êù•Âä†ËΩΩ„ÄÇ</li>
<li>findClassInternal‰ºòÂÖà‰ªéresourceEntriesÁºìÂ≠ò‰∏≠Êü•ÊâæÔºåÊâæÂà∞ÂàôËøîÂõû„ÄÇ</li>
<li>Êâæ‰∏çÂà∞ÂàôÊúÄÁªàÈÄöËøáclass ÁöÑbinaryContentÂíåË∞ÉÁî®JDK ÁöÑAPI <code>defineClass</code> Êù•Âä†ËΩΩ„ÄÇ</li>
</ul>
<p><strong>ÁªèËøá‰ª•‰∏äÂàÜÊûêÊàë‰ª¨ÂèØ‰ª•‰ªé‰∏Ä‰∏™HTTPËØ∑Ê±ÇÂá∫ÂèëÂàùÊ≠•‰∫ÜËß£Âà∞TomcatÊï¥‰ΩìÁöÑÊû∂ÊûÑËÆæËÆ°Ôºå‰ª•ÂèäÊé•Êî∂ËØ∑Ê±Ç„ÄÅËß£ÊûêËØ∑Ê±ÇÔºåÂä†ËΩΩËøêË°åservlet, Âà∞ÁîüÊàêÂìçÂ∫îÁöÑÂÖ®ÊµÅÁ®ãÔºå‰ΩÜÊòØtomcat ÁªèËøá‰∫åÂçÅÂπ¥‰ΩôÂπ¥ÁöÑÂèëÂ±ïÔºåÊâÄË¶ÅÂ§ÑÁêÜÁöÑ‰∏öÂä°Âú∫ÊôØËøú‰∏çÊ≠¢Ëøô‰∫õÔºåÊúâÂæàÂ§öÂÖ∂‰ªñÁöÑËÆæËÆ°ÂíåÂÆûÁé∞ÂÄºÂæóÊàë‰ª¨ÂéªËøõ‰∏ÄÊ≠•Êé¢Á¥¢ÔºåÊØîÂ¶ÇÔºö</strong></p>
<ul>
<li><strong>tomcat‰∏≠ÂÖ≥‰∫éÈïøÈìæÊé•ÁöÑÂ§ÑÁêÜ</strong></li>
<li><strong>ÂàÜÂùó‰º†Ëæì</strong></li>
<li><strong>tomcatÊòØÂ¶Ç‰ΩïÂØπÂìçÂ∫îËøõË°åÂéãÁº©ÁöÑ(‰æãÂ¶Çgzip)Ôºü</strong></li>
<li><strong>&hellip;</strong></li>
</ul>
<blockquote>
<p>ËøôÂá†‰∏™ÈóÆÈ¢òÊöÇÊó∂‰∏ç‰Ωú‰∏∫ËøôÊ¨°ÁöÑÊïÖ‰∫ã‰∏ªÁ∫øÔºåÂØπÂìçÂ∫îÂéãÁº©ÂíåÂàÜÂùó‰º†ËæìÊÑüÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶ÂèØ‰ª•ÂèÇËÄÉÊàëÁöÑÂè¶‰∏ÄÁØáÔºö<a class="link" href="https://woaihuangfan.github.io/posts/tomcat-http-%e5%8e%8b%e7%bc%a9%e4%b8%8e%e5%88%86%e5%9d%97%e4%bc%a0%e8%be%93/"  target="_blank" rel="noopener"
    >tomcat http ÂéãÁº©‰∏éÂàÜÂùó‰º†ËæìÂéüÁêÜ</a></p>
</blockquote>
<p>‰ΩÜÊòØÂú®Ê≠§‰πãÂâçÔºåÁ´ôÂú®ÂºÄÂèëËÄÖÁöÑËßíÂ∫¶ËÄÉËôëÂà∞Êàë‰ª¨Âü∫‰∫éspringbootÂºÄÂèëÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨ËøòÊúâ‰∏ÄÁÇπÊ≤°ÊúâÊêûÊ∏ÖÊ•öÔºåtomcat ÊòØÂ¶Ç‰Ωï‰∏éSpringbootËÅîÁ≥ªÂú®‰∏ÄËµ∑ÁöÑÂë¢Ôºü</p>
<h2 id="tomcat-Âíåspringboot">Tomcat ÂíåSpringboot</h2>
<p>‰ª•Ëøô‰∏™<a class="link" href="https://github.com/woaihuangfan/how-tomcat-works/tree/main/springboot-on-tomcat"  target="_blank" rel="noopener"
    >ÁÆÄÂçïÁöÑspringbootÂ∫îÁî®</a>(Springboot <strong>3.2.3</strong>, Ê≥®ÊÑèËÄÅÁâàÊú¨‰ºöÁï•ÂæÆÊúâÊâÄ‰∏çÂêåÔºå‰ΩÜÂ§ßÂêåÂ∞èÂºÇ)‰∏∫‰æã,</p>
<p><strong>gradle</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">implementation</span><span class="p">(</span><span class="s2">&#34;org.springframework.boot:spring-boot-starter-web&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">..</span><span class="p">.</span>
</span></span></code></pre></div><p>Ëøô‰∏™‰æùËµñÈáåÂºïÂÖ•‰∫Ü<code>spring-boot-starter-tomcat</code>‰æùËµñ,</p>
<blockquote>
<p>Âõ†‰∏∫Áî®‰∫Ü<code>api</code> ÊâÄ‰ª•Âú®Êàë‰ª¨ÁöÑspringbootÂ∫îÁî®‰∏≠ÂèØ‰ª•ËÆøÈóÆÂà∞<code>spring-boot-starter-tomcat</code>‰æùËµñ</p>
</blockquote>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226113635234.png"
	width="3046"
	height="1886"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226113635234_hu70ca8861426ffd5949f05e6d45ea0ae9_562428_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226113635234_hu70ca8861426ffd5949f05e6d45ea0ae9_562428_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240226113635234"
	
	
		class="gallery-image" 
		data-flex-grow="161"
		data-flex-basis="387px"
	
></p>
<p><strong>spring-boot-starter-tomcat</strong></p>
<p>ÂºïÂÖ•‰∫Ü<code>tomcat-embed-core</code> ‰æùËµñ,</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226114833240.png"
	width="3352"
	height="1358"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226114833240_hu8351bde63d4de251afb7fac2bc05a7ed_430139_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226114833240_hu8351bde63d4de251afb7fac2bc05a7ed_430139_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240226114833240"
	
	
		class="gallery-image" 
		data-flex-grow="246"
		data-flex-basis="592px"
	
></p>
<p>ËÄå<code>tomcat-embed-core</code>‰πüÂ∞±ÊòØÊàë‰ª¨ÊúÄÁªà‰ºöÁî®Âà∞ÁöÑ‰∏Ä‰∏™Ê†∏ÂøÉÁöÑtomcatÁöÑjar‰æùËµñ„ÄÇËÄåÂú®Ëøô‰∏™jarÂåÖÈáåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞tomcat ÁöÑÊ∫êÁ†Å„ÄÇ</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226115159408.png"
	width="3714"
	height="1262"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226115159408_hu0d123a5afcfc7a29c60aad6d9dc4d553_486385_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240226115159408_hu0d123a5afcfc7a29c60aad6d9dc4d553_486385_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240226115159408"
	
	
		class="gallery-image" 
		data-flex-grow="294"
		data-flex-basis="706px"
	
></p>
<p><strong>PingContoller</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s2">&#34;/ping&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PingController</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">ping</span><span class="p">():</span> <span class="n">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Pong!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>SpringbootÂ∫îÁî®ÂêØÂä®ÂÖ•Âè£‰πüÊòØ‰∏Ä‰∏™MainÊñπÊ≥ïÔºåËØ¶ÁªÜÁöÑSpringbootÂêØÂä®ËøáÁ®ã‰∏çÂú®Êú¨ÊñáÁöÑËåÉÂõ¥ÂÜÖÔºåÊ≠§Â§ÑÁõ¥Êé•Ë∑≥Âà∞tomcatÂêØÂä®ÁöÑ‰ª£Á†Å„ÄÇ</p>
<p><code>SpringApplication#run</code> ‚Äî&gt; <code>SpringApplication#refreshContext</code>  ‚Äî&gt; <code>ServletWebServerApplicationContext#onRefresh</code>  ‚Äî&gt;  <code>ServletWebServerApplicationContext#createWebServer</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createWebServer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">WebServer</span><span class="w"> </span><span class="n">webServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">webServer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">ServletContext</span><span class="w"> </span><span class="n">servletContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getServletContext</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">webServer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">servletContext</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">StartupStep</span><span class="w"> </span><span class="n">createWebServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getApplicationStartup</span><span class="p">().</span><span class="na">start</span><span class="p">(</span><span class="s">&#34;spring.boot.webserver.create&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">ServletWebServerFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getWebServerFactory</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">createWebServer</span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&#34;factory&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">webServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="na">getWebServer</span><span class="p">(</span><span class="n">getSelfInitializer</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">servletContext</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">initPropertySources</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>‰∏äËø∞‰ª£Á†ÅÁ¨¨6Ë°å<code>getWebServerFactory();</code> ËøîÂõûÁöÑÊòØ<strong>TomcatServletWebServerFactory</strong></p>
<p><strong>‰∏∫‰ªÄ‰πàÊòØTomcatËÄå‰∏çÊòØJettyÔºü</strong></p>
<p>Âõ†‰∏∫Âú®<code>ServletWebServerFactoryAutoConfiguration</code> Ëá™Âä®Ë£ÖÈÖçÁ±ª‰∏≠ÈÄöËøá@Import ÂØºÂÖ•‰∫ÜServletWebServerFactoryConfigurationÁ±ª‰∏ãÈù¢ÁöÑÂá†‰∏™ÈÖçÁΩÆÔºå</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227110015707.png"
	width="2028"
	height="858"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227110015707_hu1e0b65aaad25379021185aa1252c64df_292952_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227110015707_hu1e0b65aaad25379021185aa1252c64df_292952_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240227110015707"
	
	
		class="gallery-image" 
		data-flex-grow="236"
		data-flex-basis="567px"
	
></p>
<p>ËÄåÂú®ServletWebServerFactoryConfiguration‰∏≠ÔºåÈÄöËøá<code>ConditionalOnClass</code> Ê≥®Ëß£‰ºöÈªòËÆ§Âä†ËΩΩTomcatServletWebServerFactory„ÄÇ</p>
<blockquote>
<p>web starter ÈªòËÆ§ÈõÜÊàêtomcat, ÂèØ‰ª•ÂèëÁé∞JettyÁöÑ‰∏§‰∏™Á±ªÈªòËÆ§ÊÉÖÂÜµ‰∏ãÊâæ‰∏çÂà∞„ÄÇ</p>
</blockquote>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227112101127.png"
	width="2224"
	height="1742"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227112101127_hu07bb95c638b4109ce0398b5daa50364c_447352_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227112101127_hu07bb95c638b4109ce0398b5daa50364c_447352_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240227112101127"
	
	
		class="gallery-image" 
		data-flex-grow="127"
		data-flex-basis="306px"
	
></p>
<p>‰∏ãÈù¢ÂÜçÁúã<code>factory#getWebServer</code>ÁöÑÂÆûÁé∞</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">WebServer</span><span class="w"> </span><span class="nf">getWebServer</span><span class="p">(</span><span class="n">ServletContextInitializer</span><span class="p">...</span><span class="w"> </span><span class="n">initializers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">disableMBeanRegistry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">Registry</span><span class="p">.</span><span class="na">disableRegistry</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">Tomcat</span><span class="w"> </span><span class="n">tomcat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Tomcat</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">File</span><span class="w"> </span><span class="n">baseDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">baseDirectory</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">baseDirectory</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">createTempDir</span><span class="p">(</span><span class="s">&#34;tomcat&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">tomcat</span><span class="p">.</span><span class="na">setBaseDir</span><span class="p">(</span><span class="n">baseDir</span><span class="p">.</span><span class="na">getAbsolutePath</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">LifecycleListener</span><span class="w"> </span><span class="n">listener</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">serverLifecycleListeners</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">tomcat</span><span class="p">.</span><span class="na">getServer</span><span class="p">().</span><span class="na">addLifecycleListener</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">Connector</span><span class="w"> </span><span class="n">connector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Connector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">protocol</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">connector</span><span class="p">.</span><span class="na">setThrowOnFailure</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//ÂàõÂª∫server, service, Âπ∂ÂÆåÊàêconnector Âíå serviceÁöÑÁªëÂÆö</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">tomcat</span><span class="p">.</span><span class="na">getService</span><span class="p">().</span><span class="na">addConnector</span><span class="p">(</span><span class="n">connector</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">customizeConnector</span><span class="p">(</span><span class="n">connector</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">tomcat</span><span class="p">.</span><span class="na">setConnector</span><span class="p">(</span><span class="n">connector</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">tomcat</span><span class="p">.</span><span class="na">getHost</span><span class="p">().</span><span class="na">setAutoDeploy</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ëøô‰∏ÄÊ≠•‰ºöÊ†πÊçÆÊàë‰ª¨application.yml ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑÈÖçÁΩÆÂØπtomcat serverÂÅöÂÆöÂà∂ÂåñÁöÑÈÖçÁΩÆ„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">configureEngine</span><span class="p">(</span><span class="n">tomcat</span><span class="p">.</span><span class="na">getEngine</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Connector</span><span class="w"> </span><span class="n">additionalConnector</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">additionalTomcatConnectors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">tomcat</span><span class="p">.</span><span class="na">getService</span><span class="p">().</span><span class="na">addConnector</span><span class="p">(</span><span class="n">additionalConnector</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">prepareContext</span><span class="p">(</span><span class="n">tomcat</span><span class="p">.</span><span class="na">getHost</span><span class="p">(),</span><span class="w"> </span><span class="n">initializers</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getTomcatWebServer</span><span class="p">(</span><span class="n">tomcat</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ËøôÊó∂Èô§‰∫ÜTomcat Á±ªÂ§ñÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Connector, Service, HostÔºåProtocolÁ≠âÁÜüÊÇâÁöÑÂ≠óÁúº„ÄÇ</p>
<p><strong>ConnectorÁöÑÂàõÂª∫</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Connector</span><span class="w"> </span><span class="n">connector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Connector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">protocol</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><strong>ServerÂíåServiceÁöÑÂàõÂª∫</strong></p>
<p>Âú®tomcat.getService()ÂÆûÁé∞‰∏≠ÔºåÂèØ‰ª•ÁúãÂà∞Êñ∞Âª∫‰∫ÜStandardServerÂíåStandardServiceÂπ∂ÂÆûÁé∞‰∫ÜÂèåÂêëÁªëÂÆö„ÄÇ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="nf">getService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">getServer</span><span class="p">().</span><span class="na">findServices</span><span class="p">()</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="nf">getServer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">server</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">server</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&#34;catalina.useNaming&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;false&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÁÜüÊÇâÁöÑStandardServer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StandardServer</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">initBaseDir</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Set configuration source</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ConfigFileLoader</span><span class="p">.</span><span class="na">setSource</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CatalinaBaseConfigurationSource</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">basedir</span><span class="p">),</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">server</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="o">-</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÁÜüÊÇâÁöÑStandardService</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StandardService</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">service</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&#34;Tomcat&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">server</span><span class="p">.</span><span class="na">addService</span><span class="p">(</span><span class="n">service</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">server</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>EngineÂíåHostÁöÑÂàõÂª∫</strong></p>
<p>Âú®tomcat.getHost()ÁöÑÂÆûÁé∞‰∏≠ÔºåÂàõÂª∫‰∫ÜStandardEngineÂíåStandardHostÔºåÂπ∂ÂÆåÊàê‰∫ÜEngine, Host, Service ‰πãÈó¥ÁöÑÁªëÂÆö</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="nf">getHost</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Engine</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getEngine</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">engine</span><span class="p">.</span><span class="na">findChildren</span><span class="p">().</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">Host</span><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="p">.</span><span class="na">findChildren</span><span class="p">()</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Host</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StandardHost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">host</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">hostname</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">getEngine</span><span class="p">().</span><span class="na">addChild</span><span class="p">(</span><span class="n">host</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">host</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="nf">getEngine</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getServer</span><span class="p">().</span><span class="na">findServices</span><span class="p">()</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="na">getContainer</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getContainer</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Engine</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StandardEngine</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">engine</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&#34;Tomcat&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">engine</span><span class="p">.</span><span class="na">setDefaultHost</span><span class="p">(</span><span class="n">hostname</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">engine</span><span class="p">.</span><span class="na">setRealm</span><span class="p">(</span><span class="n">createDefaultRealm</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">service</span><span class="p">.</span><span class="na">setContainer</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">engine</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Ëá≥Ê≠§, ËøòÂ∑Æ‰∏Ä‰∏™WrapperÂ∞±ÂÆåÊàê‰∫Ü‰ª•<code>Tomcat</code>‰∏∫Ê†πËäÇÁÇπÁöÑËøô‰∏™Â±ÇÁ∫ßÂÖ≥Á≥ªÁöÑÊûÑÂª∫„ÄÇ Wrapper ÊòØÂú®</p>
<p><strong>TomcatÁöÑÂêØÂä®</strong></p>
<p>Âú®getWebServerÊúÄÂêé‰∏ÄÊ≠•<code>getTomcatWebServer(tomcat)</code>‰∏≠,</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// TomcatServletWebServerFactory#getTomcatWebServer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="n">TomcatWebServer</span><span class="w"> </span><span class="nf">getTomcatWebServer</span><span class="p">(</span><span class="n">Tomcat</span><span class="w"> </span><span class="n">tomcat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TomcatWebServer</span><span class="p">(</span><span class="n">tomcat</span><span class="p">,</span><span class="w"> </span><span class="n">getPort</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">getShutdown</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//TomcatWebServer#TomcatWebServer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="nf">TomcatWebServer</span><span class="p">(</span><span class="n">Tomcat</span><span class="w"> </span><span class="n">tomcat</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">autoStart</span><span class="p">,</span><span class="w"> </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">shutdown</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Assert</span><span class="p">.</span><span class="na">notNull</span><span class="p">(</span><span class="n">tomcat</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Tomcat Server must not be null&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="na">tomcat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tomcat</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="na">autoStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">autoStart</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="na">gracefulShutdown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">shutdown</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Shutdown</span><span class="p">.</span><span class="na">GRACEFUL</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GracefulShutdown</span><span class="p">(</span><span class="n">tomcat</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">initialize</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// TomcatWebServer#initialize</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initialize</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">WebServerException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="na">tomcat</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Tomcat#start</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">LifecycleException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">getServer</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Âú®<code>server.start()</code> Ëøô‰∏ÄÊ≠•ÂºÄÂßã‰πãÂêéÂ∞±ÊòØÊàë‰ª¨ÂâçÈù¢ÂàÜÊûêËøáÁöÑtomcatÁöÑÂêØÂä®ÊµÅÁ®ã„ÄÇ</p>
<p><strong>Servlet ÁöÑÂä†ËΩΩ</strong></p>
<p>Êàë‰ª¨Áü•ÈÅìSpringboot Ê°ÜÊû∂Â∞±ÂåÖÂê´spring mvc, ÊâÄÊúâËØ∑Ê±ÇÂú®Âà∞ËæætomcatÂêéÔºå‰ºö‰∫§Áªô<code>DispathcerServlet</code> Êù•Â§ÑÁêÜÔºåDispatcherServlet ‰ºöÂÜçËøõ‰∏ÄÊ≠•ÂØπËØ∑Ê±ÇËøõË°åÂàÜÂèëÔºå‰∫§ÁªôÂêÑËá™handler/controllerÊù•Â§ÑÁêÜ„ÄÇ</p>
<p>![Tomcat and Spring](images/Tomcat and Spring.png)</p>
<p>ÈÇ£Ëøô‰∏™DispatcherServletÊòØ‰ªÄ‰πàÊó∂ÂÄôÂä†ËΩΩÁöÑÔºü</p>
<p><strong>DispatcherServletÁöÑÂÆû‰æãÂåñ</strong></p>
<p>Âú®spring ÂÆπÂô®ÊûÑÂª∫DispatcherServletRegistrationBeanÁöÑÊó∂ÂÄô‰ºöÂèëÁé∞ÂÆÉ‰æùËµñDispatcherServletÔºå ËøôÊó∂ÂÄôÂ∞±‰ºöÂéªÂÆû‰æãÂåñDispatcherServlet„ÄÇ</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227132941675.png"
	width="2794"
	height="1164"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227132941675_hu10989bcb33843bc4a74f26076deedbde_378475_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227132941675_hu10989bcb33843bc4a74f26076deedbde_378475_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240227132941675"
	
	
		class="gallery-image" 
		data-flex-grow="240"
		data-flex-basis="576px"
	
></p>
<p><strong>Wrapper ÁöÑÂàõÂª∫‰ª•ÂèäServlet Âíåwrapper ÁöÑÁªëÂÆö</strong></p>
<p>Âú®<code>StandaradContext#startInternal</code> ‰∏≠Êúâ‰∏ÄÊÆµ‰ª£Á†ÅÔºö</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">ServletContainerInitializer</span><span class="p">,</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;&gt;</span><span class="w"> </span><span class="n">initializers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">ServletContainerInitializer</span><span class="p">,</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;&gt;</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">initializers</span><span class="p">.</span><span class="na">entrySet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">entry</span><span class="p">.</span><span class="na">getKey</span><span class="p">().</span><span class="na">onStartup</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="na">getValue</span><span class="p">(),</span><span class="w"> </span><span class="n">getServletContext</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ServletException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">sm</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;standardContext.sciFail&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ServletContainerInitializerÊòØServlet 3.0 Êñ∞Â¢ûÁöÑ‰∏Ä‰∏™Êé•Âè£Ôºå‰∏ªË¶ÅÁî®‰∫éÂú®ÂÆπÂô®ÂêØÂä®Èò∂ÊÆµÈÄöËøáÁºñÁ®ãÈ£éÊ†ºÊ≥®ÂÜå<code>Filter</code>, <code>Servlet</code>‰ª•Âèä<code>Listener</code>Ôºå‰ª•Âèñ‰ª£ÈÄöËøá<code>web.xml</code>ÈÖçÁΩÆÊ≥®ÂÜå„ÄÇÂÆπÂô®ÂêØÂä®Èò∂ÊÆµ‰æùÊçÆjava spiËé∑ÂèñÂà∞ÊâÄÊúâ<code>ServletContainerInitializer</code>ÁöÑÂÆûÁé∞Á±ªÔºåÁÑ∂ÂêéÊâßË°åÂÖ∂<code>onStartup</code>ÊñπÊ≥ï.</p>
<p>ÂÖ∂‰∏≠Â∞±Êúâ‰∏Ä‰∏™springÂÆûÁé∞ÁöÑTomcatStarter</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227133714818.png"
	width="3188"
	height="1608"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227133714818_hu41da102d367e6dac05e949baab01af66_553506_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227133714818_hu41da102d367e6dac05e949baab01af66_553506_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240227133714818"
	
	
		class="gallery-image" 
		data-flex-grow="198"
		data-flex-basis="475px"
	
></p>
<p>ËÄåTomcatStarter Âèà‰ºöÊâßË°åÂÜÖÈÉ®Áª¥Êä§ÁöÑinitializersÁöÑonStartupÊñπÊ≥ï</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ServletContextInitializer</span><span class="w"> </span><span class="n">initializer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">initializers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">initializer</span><span class="p">.</span><span class="na">onStartup</span><span class="p">(</span><span class="n">servletContext</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Ëøô‰∏™ÂÜÖÈÉ®Áª¥Êä§ÁöÑinitializersÊòØÈÄöËøáÂ¶Ç‰∏ãÊñπÂºèÊ∑ªÂä†Ôºö</p>
<p><code>this.webServer = factory.getWebServer(getSelfInitializer());</code> ‚Äî&gt;<code>TomcatServletWebServerFactory#getWebServer</code> ‚Äî&gt;<code>TomcatServletWebServerFactory#prepareContext</code> ‚Äî&gt;<code>TomcatServletWebServerFactory#configureContext</code> ‚Äî&gt;<code>new TomcatStarter(initializers)</code></p>
<p>ÂÖ∂‰∏≠getSelfInitializerËøîÂõûÁöÑÊòØ‰∏Ä‰∏™LambaË°®ËææÂºèÔºö</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">boot</span><span class="p">.</span><span class="na">web</span><span class="p">.</span><span class="na">servlet</span><span class="p">.</span><span class="na">ServletContextInitializer</span><span class="w"> </span><span class="nf">getSelfInitializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">selfInitialize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">selfInitialize</span><span class="p">(</span><span class="n">ServletContext</span><span class="w"> </span><span class="n">servletContext</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">prepareWebApplicationContext</span><span class="p">(</span><span class="n">servletContext</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">registerApplicationScope</span><span class="p">(</span><span class="n">servletContext</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">WebApplicationContextUtils</span><span class="p">.</span><span class="na">registerEnvironmentBeans</span><span class="p">(</span><span class="n">getBeanFactory</span><span class="p">(),</span><span class="w"> </span><span class="n">servletContext</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ServletContextInitializer</span><span class="w"> </span><span class="n">beans</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">getServletContextInitializerBeans</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">beans</span><span class="p">.</span><span class="na">onStartup</span><span class="p">(</span><span class="n">servletContext</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ÊâÄ‰ª•ÊúÄÁªà‰ºöÊâßË°åÂà∞<code>ServletContextInitializerBeans</code> ÁöÑonStartupÊñπÊ≥ïÔºå</p>
<p><img src="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227135328783.png"
	width="1824"
	height="492"
	srcset="/posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227135328783_hua0fad7641191686a212bef44f756433b_174545_480x0_resize_box_3.png 480w, /posts/tomcat%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/images/image-20240227135328783_hua0fad7641191686a212bef44f756433b_174545_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="image-20240227135328783"
	
	
		class="gallery-image" 
		data-flex-grow="370"
		data-flex-basis="889px"
	
></p>
<p>ÂÖ∂‰∏≠Â∞±Êúâ‰∏Ä‰∏™<code>DispatcherServletRegistrationBean</code>, ÁÑ∂ÂêéÈÄöËøá‰ª•‰∏ãË∞ÉÁî®Èìæ</p>
<p><code>beans.onStartup(servletContext)</code> ‚Äî&gt; <code>DispatcherServletRegistrationBean#onStartup</code> ‚Äî&gt; <code>DynamicRegistrationBean#register</code> ‚Äî&gt; <code>ServletRegistrationBean#addRegistration</code> ‚Äî&gt; <code>ApplicationContextFacade#addServlet</code> ‚Äî&gt; <code>ApplicationContext#addServlet</code> ‚Äî&gt; <code>org.apache.catalina.core.ApplicationContext#addServlet</code></p>
<p>Âú®<code>ApplicationContext#addServlet</code>‰∏≠ÂèØ‰ª•ÁúãÂà∞‰ºöÂàõÂª∫wrapper,Âπ∂ÁªëÂÆöStandardContext Âíåwrapper ÔºåËã•servlet ‰∏ç‰∏∫Á©∫Âàô‰ºöÈÄöËøá<code>wrapper.setServlet(servlet);</code>Êù•ÁªëÂÆöservlet Âíå wrapper.</p>
<blockquote>
<p>Ëã•servlet ‰∏∫Á©∫ÔºåÂàôÂè™‰ºösetServletClassÔºå‰∏îloadClass , ÂÆû‰æãÂåñ‰∫§ÁªôÂêéÈù¢ÁöÑÊ≠•È™§ËøõË°å„ÄÇ</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">ServletRegistration</span><span class="p">.</span><span class="na">Dynamic</span><span class="w"> </span><span class="nf">addServlet</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">servletName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">servletClass</span><span class="p">,</span><span class="w"> </span><span class="n">Servlet</span><span class="w"> </span><span class="n">servlet</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">initParams</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">Wrapper</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Wrapper</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">findChild</span><span class="p">(</span><span class="n">servletName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// Assume a &#39;complete&#39; ServletRegistration is one that has a class and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// a name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wrapper</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">createWrapper</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">wrapper</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">servletName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">context</span><span class="p">.</span><span class="na">addChild</span><span class="p">(</span><span class="n">wrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wrapper</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wrapper</span><span class="p">.</span><span class="na">getServletClass</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wrapper</span><span class="p">.</span><span class="na">isOverridable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="n">wrapper</span><span class="p">.</span><span class="na">setOverridable</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">ServletSecurity</span><span class="w"> </span><span class="n">annotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">servlet</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">wrapper</span><span class="p">.</span><span class="na">setServletClass</span><span class="p">(</span><span class="n">servletClass</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Introspection</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">servletClass</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">annotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clazz</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">ServletSecurity</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">wrapper</span><span class="p">.</span><span class="na">setServletClass</span><span class="p">(</span><span class="n">servlet</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">wrapper</span><span class="p">.</span><span class="na">setServlet</span><span class="p">(</span><span class="n">servlet</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">wasCreatedDynamicServlet</span><span class="p">(</span><span class="n">servlet</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">annotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">servlet</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">ServletSecurity</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">initParams</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">initParam</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">initParams</span><span class="p">.</span><span class="na">entrySet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">wrapper</span><span class="p">.</span><span class="na">addInitParameter</span><span class="p">(</span><span class="n">initParam</span><span class="p">.</span><span class="na">getKey</span><span class="p">(),</span><span class="w"> </span><span class="n">initParam</span><span class="p">.</span><span class="na">getValue</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">ServletRegistration</span><span class="p">.</span><span class="na">Dynamic</span><span class="w"> </span><span class="n">registration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ApplicationServletRegistration</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">annotation</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">registration</span><span class="p">.</span><span class="na">setServletSecurity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ServletSecurityElement</span><span class="p">(</span><span class="n">annotation</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">registration</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Ëá≥Ê≠§Ôºåwrapper ‰πüÂ∞±ÂàõÂª∫ÂÆåÊàêÔºåÂπ∂Âú®tomcat ÂêØÂä®ÁöÑÊó∂ÂÄôÂ∞±‰ºöÂÆû‰æãÂåñÂá∫‰∫ÜServlet„ÄÇÂíåÂâçÈù¢ÂàÜÊûêÁöÑtomcat Êû∂ÊûÑÂÆåÁæéË°îÊé•ÔºåËá≥‰∫éËØ∑Ê±ÇÂà∞ËææDispatcherServletÂêéÊÄé‰πàÂàÜÂèë‰∫§ÁªôcontrollerÔºåÈÇ£Â∞±ÊòØÂè¶‰∏Ä‰∏™topic‰∫Ü„ÄÇ</p>
<blockquote>
<p>Â§ç‰π†ÂõûÈ°æÔºöËøôÈáåËØ¥ÁöÑwrapperÊåáÁöÑÊòØ‰ªÄ‰πàÔºü</p>
</blockquote>
</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 Ê∏ÖÈú≤Êô®ÊµÅ, Êñ∞Ê°êÂàùÂºï
    </section>
    










</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
